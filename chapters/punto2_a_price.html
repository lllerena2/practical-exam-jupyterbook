
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Parcial Punto 2 &#8212; My sample book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapters/punto2_a_price';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Parcial Punto 2 - RETORNO" href="punto2_b_retorno.html" />
    <link rel="prev" title="Markdown Files" href="../markdown.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="My sample book - Home"/>
    <img src="../_static/logo.png" class="logo__image only-dark pst-js-only" alt="My sample book - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome to your Jupyter Book
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../markdown.html">Markdown Files</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Parcial Punto 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="punto2_b_retorno.html">Parcial Punto 2 - RETORNO</a></li>
<li class="toctree-l1"><a class="reference internal" href="punto2_c_volatilidad.html">Parcial Punto 2 - VOLATILIDAD</a></li>
<li class="toctree-l1"><a class="reference internal" href="punto2_d_garch.html">IMPLEMENTACION GARCH PARA VOLATILIDAD</a></li>
<li class="toctree-l1"><a class="reference internal" href="deeplearning.html">Modelos de Deep Learning</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fchapters/punto2_a_price.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/chapters/punto2_a_price.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Parcial Punto 2</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#librerias-y-funciones">LIBRERIAS Y FUNCIONES</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#librerias">Librerias</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#accuracy">Accuracy</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#residuos-independencia-y-normalidad">Residuos - Independencia y normalidad</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#grafica-train-val-y-test">Grafica Train, Val. y Test</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fx-train-val-y-test">FX - Train, Val. y Test</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#datos">DATOS</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelos">MODELOS</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-exponencial-smoothing-implementacion-sin-libreria-bitcoin-price">SIMPLE EXPONENCIAL SMOOTHING (IMPLEMENTACIÓN SIN LIBRERIA) - BITCOIN PRICE</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#entrenamiento">Entrenamiento</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#testing">Testing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-exponencial-smoothing-statsmodels-bitcoin-price">SIMPLE EXPONENCIAL SMOOTHING (STATSMODELS) - BITCOIN PRICE</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Entrenamiento</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Testing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#double-exponencial-smoothing-implementacion-sin-libreria-bitcoin-price">DOUBLE EXPONENCIAL SMOOTHING (IMPLEMENTACIÓN SIN LIBRERIA) - BITCOIN PRICE</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Entrenamiento</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Testing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#double-exponencial-smoothing-implementacion-stat-bitcoin-price">DOUBLE EXPONENCIAL SMOOTHING (IMPLEMENTACIÓN STAT) - BITCOIN PRICE</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Entrenamiento</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Testing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#arima-sin-rolling">ARIMA (SIN ROLLING)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#autocorrelacion-y-diferenciacion">Autocorrelacion y diferenciacion</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#dickey-fuller">Dickey Fuller</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Entrenamiento</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Testing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#arima-con-rolling">ARIMA (CON ROLLING)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">Entrenamiento</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">Testing</a></li>
</ul>
</li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="parcial-punto-2">
<h1>Parcial Punto 2<a class="headerlink" href="#parcial-punto-2" title="Link to this heading">#</a></h1>
<p>Este Jupyter Book resume los modelos estadisticos solicitados para las diferentes ventanas de tiempo de predición para la serie de tiempo Bitcoin Price. Los modelos de Garch serán revisados con la serie de tiempo de volatilidad, pues este es uso.</p>
<section id="librerias-y-funciones">
<h2>LIBRERIAS Y FUNCIONES<a class="headerlink" href="#librerias-y-funciones" title="Link to this heading">#</a></h2>
<section id="librerias">
<h3>Librerias<a class="headerlink" href="#librerias" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa</span> <span class="kn">import</span> <span class="n">stattools</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.stattools</span> <span class="kn">import</span> <span class="n">jarque_bera</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
<span class="kn">from</span> <span class="nn">pandas.plotting</span> <span class="kn">import</span> <span class="n">autocorrelation_plot</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.holtwinters</span> <span class="kn">import</span> <span class="n">SimpleExpSmoothing</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.holtwinters</span> <span class="kn">import</span> <span class="n">ExponentialSmoothing</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_percentage_error</span><span class="p">,</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>  <span class="c1"># Para mostrar una barra de progreso</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.arima.model</span> <span class="kn">import</span> <span class="n">ARIMA</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.diagnostic</span> <span class="kn">import</span> <span class="n">acorr_ljungbox</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.holtwinters</span> <span class="kn">import</span> <span class="n">Holt</span>
<span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="kn">import</span> <span class="n">plot_predict</span><span class="p">,</span> <span class="n">plot_acf</span>

<span class="c1">#Formato y colores</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">8</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="ne">----&gt; </span><span class="mi">8</span> <span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="kn">from</span> <span class="nn">statsmodels.tsa</span> <span class="kn">import</span> <span class="n">stattools</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="kn">from</span> <span class="nn">statsmodels.stats.stattools</span> <span class="kn">import</span> <span class="n">jarque_bera</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;plotly&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="accuracy">
<h3>Accuracy<a class="headerlink" href="#accuracy" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">forecast_accuracy</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">actual</span><span class="p">,</span> <span class="n">str_name</span><span class="p">,</span> <span class="n">str_model</span><span class="p">,</span> <span class="n">lj_lags</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">window_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="n">mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">actual</span><span class="p">))</span>    <span class="c1"># MAPE</span>
    <span class="n">mae</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">))</span>                      <span class="c1"># MAE</span>
    <span class="n">mse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>                       <span class="c1"># MSE</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mse</span><span class="p">)</span>                                           <span class="c1"># RMSE</span>

    <span class="c1"># Cálculo del R²</span>
    <span class="n">ss_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">actual</span> <span class="o">-</span> <span class="n">forecast</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">ss_tot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">actual</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">actual</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">ss_res</span> <span class="o">/</span> <span class="n">ss_tot</span><span class="p">)</span>

    <span class="c1"># Cálculo de los residuales</span>
    <span class="n">residuals</span> <span class="o">=</span> <span class="n">actual</span> <span class="o">-</span> <span class="n">forecast</span>

    <span class="c1"># Prueba de Ljung-Box</span>
    <span class="n">lb_test</span> <span class="o">=</span> <span class="n">acorr_ljungbox</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="n">lj_lags</span><span class="p">,</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">lb_pvalue</span> <span class="o">=</span> <span class="n">lb_test</span><span class="p">[</span><span class="s1">&#39;lb_pvalue&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># p-valor en el lag máximo especificado (10 en este caso)</span>

    <span class="c1"># Prueba de Jarque-Bera</span>
    <span class="n">jb_stat</span><span class="p">,</span> <span class="n">jb_pvalue</span><span class="p">,</span> <span class="n">skew</span><span class="p">,</span> <span class="n">kurtosis</span> <span class="o">=</span> <span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span>

    <span class="n">df_acc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">str_model</span><span class="p">,</span>
        <span class="s1">&#39;window&#39;</span><span class="p">:</span> <span class="n">window_str</span><span class="p">,</span>
        <span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mae</span><span class="p">],</span>
        <span class="s1">&#39;MSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mse</span><span class="p">],</span>
        <span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mape</span><span class="p">],</span>
        <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmse</span><span class="p">],</span>
        <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">r2</span><span class="p">],</span>
        <span class="s1">&#39;Ljung-Box p-value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">lb_pvalue</span><span class="p">],</span>
        <span class="s1">&#39;Jarque-Bera p-value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">jb_pvalue</span><span class="p">]</span>
    <span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">str_name</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">df_acc</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="residuos-independencia-y-normalidad">
<h3>Residuos - Independencia y normalidad<a class="headerlink" href="#residuos-independencia-y-normalidad" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot; def independence_normality(residuals, nlags_ljbox):</span>
<span class="sd">  print(&#39;----- Test de Independencia  Ljung-Box --------&#39;)</span>
<span class="sd">  </span>
<span class="sd">  #Ho: no hay autocorrelación en los residuos</span>
<span class="sd">  acf_, confint_, qstat_, pvalues_ = stattools.acf(residuals, nlags=nlags_ljbox, qstat=True,alpha=0.05)</span>
<span class="sd">  alpha = 0.05</span>
<span class="sd">  </span>
<span class="sd">  for l, p_val in enumerate(pvalues_):</span>
<span class="sd">      if p_val &gt; alpha:</span>
<span class="sd">          print(&#39;Null hypothesis is accepted at lag = {} for p-val = {}&#39;.format(l, p_val))</span>
<span class="sd">      else:</span>
<span class="sd">          print(&#39;Null hypothesis is rejected at lag = {} for p-val = {}&#39;.format(l, p_val))</span>
<span class="sd">  </span>
<span class="sd">  print(&#39;----- Test de Normalidad  Jarque-Bera --------&#39;)</span>

<span class="sd">  #jarque bera</span>
<span class="sd">  #Ho= los residuos tienen distribuci´on normal</span>
<span class="sd">  JB, JBpv, skew, kurtosis = jarque_bera(residuals)</span>

<span class="sd">  if JBpv &gt; alpha:</span>
<span class="sd">        print(&#39;Null hypothesis is accepted, residuos normales&#39;)</span>
<span class="sd">  else:</span>
<span class="sd">        print(&#39;Null hypothesis is rejected, residuos no normales&#39; )</span>

<span class="sd">  print(&#39;----- Grafico de serie de residuos --------&#39;)</span>
<span class="sd">  fig = px.line(residuals, </span>
<span class="sd">               #x=fechas, </span>
<span class="sd">                #y=&#39;residuos&#39;, </span>
<span class="sd">                title=&#39;Serie Temporal de los Residuos&#39;, </span>
<span class="sd">                labels={&#39;fecha&#39;: &#39;Fecha&#39;, &#39;residuos&#39;: &#39;Residuos&#39;})</span>
<span class="sd">  fig.show()</span>

<span class="sd">  print(&#39;----- QQ Plot --------&#39;)</span>

<span class="sd">  #Valores teoricos</span>
<span class="sd">  qq = stats.probplot(residuals, dist=&quot;norm&quot;)</span>
<span class="sd">  # Los valores observados y teóricos</span>
<span class="sd">  teoricos = qq[0][0]  # Cuantiles teóricos</span>
<span class="sd">  observados = qq[0][1]  # Cuantiles observados (residuos)</span>
<span class="sd">  # Crear el DataFrame para el Q-Q plot</span>
<span class="sd">  qq_plot_df = pd.DataFrame({&#39;Teóricos&#39;: teoricos, &#39;Observados&#39;: observados})</span>
<span class="sd">  # Crear el Q-Q plot con Plotly Express</span>
<span class="sd">  fig = px.scatter(qq_plot_df, </span>
<span class="sd">                 x=&#39;Teóricos&#39;, </span>
<span class="sd">                 y=&#39;Observados&#39;, </span>
<span class="sd">                 title=&#39;Q-Q Plot de los Residuos&#39;)</span>

<span class="sd"># Agregar la línea de referencia (y=x)</span>
<span class="sd">  fig.add_shape(type=&#39;line&#39;,</span>
<span class="sd">              x0=min(teoricos), y0=min(teoricos),</span>
<span class="sd">              x1=max(teoricos), y1=max(teoricos),</span>
<span class="sd">              line=dict(color=&#39;firebrick&#39;, dash=&#39;dash&#39;))</span>

<span class="sd"># Mostrar el gráfico</span>
<span class="sd">  fig.show()</span>

<span class="sd">  print(&#39;----- ACF de Residuos --------&#39;)</span>

<span class="sd">  fig = plt.figure(figsize=(5.5, 5.5))</span>
<span class="sd">  ax = fig.add_subplot(1,1,1)</span>
<span class="sd">  ax.set_title(&#39;ACF of Residuals&#39;)</span>
<span class="sd">  autocorrelation_plot(residuals, color=&#39;b&#39;, ax = ax)</span>
<span class="sd">  fig.show() &quot;&quot;&quot;</span>

<span class="k">def</span> <span class="nf">independence_normality</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">nlags_ljbox</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----- Test de Independencia  Ljung-Box --------&#39;</span><span class="p">)</span>
  
    <span class="c1"># Ho: no hay autocorrelación en los residuos</span>
    <span class="n">acf_</span><span class="p">,</span> <span class="n">confint_</span><span class="p">,</span> <span class="n">qstat_</span><span class="p">,</span> <span class="n">pvalues_</span> <span class="o">=</span> <span class="n">stattools</span><span class="o">.</span><span class="n">acf</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">nlags</span><span class="o">=</span><span class="n">nlags_ljbox</span><span class="p">,</span> <span class="n">qstat</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.05</span>
  
    <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">p_val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pvalues_</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">p_val</span> <span class="o">&gt;</span> <span class="n">alpha</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Null hypothesis is accepted at lag = </span><span class="si">{}</span><span class="s1"> for p-val = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">p_val</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Null hypothesis is rejected at lag = </span><span class="si">{}</span><span class="s1"> for p-val = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">p_val</span><span class="p">))</span>
  
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----- Test de Normalidad  Jarque-Bera --------&#39;</span><span class="p">)</span>

    <span class="c1"># Jarque-Bera</span>
    <span class="c1"># Ho: los residuos tienen distribución normal</span>
    <span class="n">JB</span><span class="p">,</span> <span class="n">JBpv</span><span class="p">,</span> <span class="n">skew</span><span class="p">,</span> <span class="n">kurtosis</span> <span class="o">=</span> <span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">JBpv</span> <span class="o">&gt;</span> <span class="n">alpha</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Null hypothesis is accepted, residuos normales&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Null hypothesis is rejected, residuos no normales&#39;</span><span class="p">)</span>

    <span class="c1"># Gráfico de la serie temporal de los residuos</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----- Grafico de serie de residuos --------&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Residuos&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Serie Temporal de los Residuos&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Fecha&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Residuos&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Q-Q Plot</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----- QQ Plot --------&#39;</span><span class="p">)</span>
    <span class="n">qq</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">probplot</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="s2">&quot;norm&quot;</span><span class="p">)</span>
    <span class="n">teoricos</span> <span class="o">=</span> <span class="n">qq</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Cuantiles teóricos</span>
    <span class="n">observados</span> <span class="o">=</span> <span class="n">qq</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Cuantiles observados (residuos)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">teoricos</span><span class="p">,</span> <span class="n">observados</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Observados&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">teoricos</span><span class="p">,</span> <span class="n">teoricos</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;firebrick&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Línea de referencia&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Q-Q Plot de los Residuos&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Teóricos&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Observados&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----- ACF de Residuos --------&#39;</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">5.5</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;ACF of Residuals&#39;</span><span class="p">)</span>
    <span class="n">autocorrelation_plot</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>  <span class="c1"># Asegura que se renderice al instante</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="grafica-train-val-y-test">
<h3>Grafica Train, Val. y Test<a class="headerlink" href="#grafica-train-val-y-test" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_model</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
    <span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span>

    <span class="c1"># Prepare the data</span>
    <span class="n">train_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;Time&#39;</span><span class="p">:</span> <span class="n">train</span><span class="p">[</span><span class="o">-</span><span class="mi">300</span><span class="p">:]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
        <span class="s1">&#39;Value&#39;</span><span class="p">:</span> <span class="n">train</span><span class="p">[</span><span class="o">-</span><span class="mi">300</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
        <span class="s1">&#39;Category&#39;</span><span class="p">:</span> <span class="s1">&#39;Train&#39;</span>
    <span class="p">})</span>
    <span class="n">val_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;Time&#39;</span><span class="p">:</span> <span class="n">val</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
        <span class="s1">&#39;Value&#39;</span><span class="p">:</span> <span class="n">val</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
        <span class="s1">&#39;Category&#39;</span><span class="p">:</span> <span class="s1">&#39;Validation&#39;</span>
    <span class="p">})</span>
    <span class="n">test_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;Time&#39;</span><span class="p">:</span> <span class="n">test</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
        <span class="s1">&#39;Value&#39;</span><span class="p">:</span> <span class="n">test</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
        <span class="s1">&#39;Category&#39;</span><span class="p">:</span> <span class="s1">&#39;Test&#39;</span>
    <span class="p">})</span>
    <span class="n">y_pred_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;Time&#39;</span><span class="p">:</span> <span class="n">y_pred</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
        <span class="s1">&#39;Value&#39;</span><span class="p">:</span> <span class="n">y_pred</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
        <span class="s1">&#39;Category&#39;</span><span class="p">:</span> <span class="s1">&#39;Prediction&#39;</span>
    <span class="p">})</span>

    <span class="c1"># Combine the data</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train_df</span><span class="p">,</span> <span class="n">val_df</span><span class="p">,</span> <span class="n">test_df</span><span class="p">,</span> <span class="n">y_pred_df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Add line dash style</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Dash&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Category&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span>
        <span class="s1">&#39;Train&#39;</span><span class="p">:</span> <span class="s1">&#39;solid&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Validation&#39;</span><span class="p">:</span> <span class="s1">&#39;solid&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Test&#39;</span><span class="p">:</span> <span class="s1">&#39;solid&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Prediction&#39;</span><span class="p">:</span> <span class="s1">&#39;dash&#39;</span>
    <span class="p">})</span>

    <span class="c1"># Compute MAE</span>
    <span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

    <span class="c1"># Plot using Plotly Express</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
        <span class="n">df</span><span class="p">,</span>
        <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;Category&#39;</span><span class="p">,</span>
        <span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;Dash&#39;</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">, MAE: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">mae</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">color_discrete_map</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;Train&#39;</span><span class="p">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Validation&#39;</span><span class="p">:</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Test&#39;</span><span class="p">:</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Prediction&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">xaxis_title</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span>
        <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span>
        <span class="n">legend_title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="n">template</span><span class="o">=</span><span class="s1">&#39;plotly_white&#39;</span>
    <span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="fx-train-val-y-test">
<h3>FX - Train, Val. y Test<a class="headerlink" href="#fx-train-val-y-test" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">train_val_test</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">window</span><span class="p">):</span>
  <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
  <span class="n">train_len</span> <span class="o">=</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">56</span> <span class="c1"># El profesor indicó que este siempre era el tamano del training (28+28)</span>
  <span class="n">val_set_end</span> <span class="o">=</span> <span class="n">train_len</span> <span class="o">+</span> <span class="n">window</span>
  <span class="n">test_set_end</span> <span class="o">=</span> <span class="n">val_set_end</span> <span class="o">+</span> <span class="n">window</span>
  

  <span class="n">train_set</span> <span class="o">=</span> <span class="n">df</span><span class="p">[:</span><span class="n">train_len</span><span class="p">]</span>
  <span class="n">val_set</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">train_len</span><span class="p">:</span> <span class="n">val_set_end</span><span class="p">]</span>
  <span class="n">test_set</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">val_set_end</span><span class="p">:</span> <span class="n">test_set_end</span><span class="p">]</span>

  <span class="k">return</span> <span class="n">train_set</span><span class="p">,</span> <span class="n">val_set</span><span class="p">,</span> <span class="n">test_set</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="datos">
<h2>DATOS<a class="headerlink" href="#datos" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Data Original</span>
<span class="n">data_init</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/lihkir/Data/refs/heads/main/Bitcoin%20Historical%20Data.csv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
<span class="c1"># Se crea una copia de la data para manipulación</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">data_init</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="c1"># Solo nos quedamos con las columnas Date y Price</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Price&#39;</span><span class="p">]]</span>

<span class="c1"># Se elimina las comas de Price para poder convertirlo a números</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="c1">#Convertimos las columnas price en números y date en fecha</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Price&#39;</span><span class="p">])</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">])</span>

<span class="c1"># Se hace que el indice sea la columna Date</span>
<span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">df_copy</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">timeserie</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Price&quot;</span><span class="p">]</span>

<span class="n">px</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>  <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Price&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>4999.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>10812.283337</td>
    </tr>
    <tr>
      <th>std</th>
      <td>15892.032468</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.100000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>226.700000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>1975.100000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>15450.150000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>73066.300000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="modelos">
<h2>MODELOS<a class="headerlink" href="#modelos" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#entanas para el set de validacion y test</span>
<span class="n">windows</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">28</span><span class="p">]</span>
<span class="n">model_summary</span>  <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<section id="simple-exponencial-smoothing-implementacion-sin-libreria-bitcoin-price">
<h3>SIMPLE EXPONENCIAL SMOOTHING (IMPLEMENTACIÓN SIN LIBRERIA) - BITCOIN PRICE<a class="headerlink" href="#simple-exponencial-smoothing-implementacion-sin-libreria-bitcoin-price" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Función de Suavizado Exponencial Simple (SES) con verificación de datos</span>
<span class="k">def</span> <span class="nf">firstsmooth</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;La serie de entrenamiento está vacía.&quot;</span><span class="p">)</span>
        
    <span class="n">ytilde</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ytilde</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">start</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
        <span class="n">ytilde</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">ytilde</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ytilde</span>

<span class="c1"># Función para generar predicciones basadas en el último valor suavizado</span>
<span class="k">def</span> <span class="nf">ses_forecast</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val_length</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># Aplicar SES al conjunto de entrenamiento</span>
    <span class="n">ytilde</span> <span class="o">=</span> <span class="n">firstsmooth</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ytilde</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;La serie suavizada está vacía.&quot;</span><span class="p">)</span>
        
    <span class="n">last_smoothed</span> <span class="o">=</span> <span class="n">ytilde</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># Generar predicciones para el conjunto de validación</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="p">[</span><span class="n">last_smoothed</span><span class="p">]</span> <span class="o">*</span> <span class="n">val_length</span>
    <span class="k">return</span> <span class="n">y_pred</span>

<span class="c1"># Optimizador SES con verificación de datos</span>
<span class="k">def</span> <span class="nf">ses_optimizer</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">alphas</span><span class="p">):</span>
    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">alpha</span> <span class="ow">in</span> <span class="n">alphas</span><span class="p">:</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">ses_forecast</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">alpha</span><span class="p">)</span>
        <span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mae</span> <span class="o">&lt;</span> <span class="n">best_mae</span><span class="p">:</span>
            <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">mae</span>
    <span class="k">return</span> <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_mae</span>

<span class="c1"># Tuning del modelo</span>
<span class="k">def</span> <span class="nf">ses_model_tuning</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
    <span class="n">alphas</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">))]</span>
    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="n">ses_optimizer</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">alphas</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">best_alpha</span>
</pre></div>
</div>
</div>
</div>
<section id="entrenamiento">
<h4>Entrenamiento<a class="headerlink" href="#entrenamiento" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="n">windows</span><span class="p">:</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">window</span><span class="p">)</span>
    <span class="n">best_alpha</span> <span class="o">=</span> <span class="n">ses_model_tuning</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
    <span class="n">best_params</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;window&#39;</span><span class="p">:</span> <span class="n">window</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">best_alpha</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[{&#39;window&#39;: 7, &#39;alpha&#39;: 0.8},
 {&#39;window&#39;: 14, &#39;alpha&#39;: 0.8},
 {&#39;window&#39;: 21, &#39;alpha&#39;: 0.8},
 {&#39;window&#39;: 28, &#39;alpha&#39;: 0.8}]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 20px;&quot;&gt;Resultados de entrenamiento para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="c1">#pred = firstsmooth(train,param[&#39;alpha&#39;])</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">ses_forecast</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">),</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">])</span>
    <span class="n">residuals</span> <span class="o">=</span> <span class="n">pred</span> <span class="o">-</span> <span class="n">train</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span><span class="n">train</span><span class="p">,</span> <span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE&#39;</span><span class="p">,[</span><span class="mi">10</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 15px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">independence_normality</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span><span class="n">nlags_ljbox</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 7</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window           MAE           MSE        MAPE          RMSE  \
train   SSE       7  32900.611982  1.236833e+09  13411.5969  35168.642882   

             R2  Ljung-Box p-value  Jarque-Bera p-value  
train -4.377388                0.0                  0.0  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/2d9a304477cf37cf3aad3ef07707bd89b82dbbd2277100e831289f6e0f268510.png" src="../_images/2d9a304477cf37cf3aad3ef07707bd89b82dbbd2277100e831289f6e0f268510.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/406f1c93e2d371b8b58ac723cfd740a35bde5c3bafca6c1157d0d75862aff28b.png" src="../_images/406f1c93e2d371b8b58ac723cfd740a35bde5c3bafca6c1157d0d75862aff28b.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/44f7f3bcc66b49e022d3352496adba4e443f85c1737ce36b61b5229f33116b0c.png" src="../_images/44f7f3bcc66b49e022d3352496adba4e443f85c1737ce36b61b5229f33116b0c.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 14</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window           MAE           MSE        MAPE          RMSE  \
train   SSE      14  32900.611982  1.236833e+09  13411.5969  35168.642882   

             R2  Ljung-Box p-value  Jarque-Bera p-value  
train -4.377388                0.0                  0.0  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/2d9a304477cf37cf3aad3ef07707bd89b82dbbd2277100e831289f6e0f268510.png" src="../_images/2d9a304477cf37cf3aad3ef07707bd89b82dbbd2277100e831289f6e0f268510.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/406f1c93e2d371b8b58ac723cfd740a35bde5c3bafca6c1157d0d75862aff28b.png" src="../_images/406f1c93e2d371b8b58ac723cfd740a35bde5c3bafca6c1157d0d75862aff28b.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/44f7f3bcc66b49e022d3352496adba4e443f85c1737ce36b61b5229f33116b0c.png" src="../_images/44f7f3bcc66b49e022d3352496adba4e443f85c1737ce36b61b5229f33116b0c.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 21</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window           MAE           MSE        MAPE          RMSE  \
train   SSE      21  32900.611982  1.236833e+09  13411.5969  35168.642882   

             R2  Ljung-Box p-value  Jarque-Bera p-value  
train -4.377388                0.0                  0.0  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/2d9a304477cf37cf3aad3ef07707bd89b82dbbd2277100e831289f6e0f268510.png" src="../_images/2d9a304477cf37cf3aad3ef07707bd89b82dbbd2277100e831289f6e0f268510.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/406f1c93e2d371b8b58ac723cfd740a35bde5c3bafca6c1157d0d75862aff28b.png" src="../_images/406f1c93e2d371b8b58ac723cfd740a35bde5c3bafca6c1157d0d75862aff28b.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/44f7f3bcc66b49e022d3352496adba4e443f85c1737ce36b61b5229f33116b0c.png" src="../_images/44f7f3bcc66b49e022d3352496adba4e443f85c1737ce36b61b5229f33116b0c.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 28</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window           MAE           MSE        MAPE          RMSE  \
train   SSE      28  32900.611982  1.236833e+09  13411.5969  35168.642882   

             R2  Ljung-Box p-value  Jarque-Bera p-value  
train -4.377388                0.0                  0.0  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/2d9a304477cf37cf3aad3ef07707bd89b82dbbd2277100e831289f6e0f268510.png" src="../_images/2d9a304477cf37cf3aad3ef07707bd89b82dbbd2277100e831289f6e0f268510.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/406f1c93e2d371b8b58ac723cfd740a35bde5c3bafca6c1157d0d75862aff28b.png" src="../_images/406f1c93e2d371b8b58ac723cfd740a35bde5c3bafca6c1157d0d75862aff28b.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/44f7f3bcc66b49e022d3352496adba4e443f85c1737ce36b61b5229f33116b0c.png" src="../_images/44f7f3bcc66b49e022d3352496adba4e443f85c1737ce36b61b5229f33116b0c.png" />
</div>
</div>
<p>Debido a que el parametro encontrado para cada ventana es igual, se realiza una sola interpretación para las metricas del set de entrenamiento:</p>
<p>Para evaluar el desempeño del modelo de suavización exponencial en el conjunto de entrenamiento, se analizaron diversas métricas de error:</p>
<ul class="simple">
<li><p><strong>Error Absoluto Medio (MAE)</strong>: Con un valor de aproximadamente 32,912, el MAE refleja la magnitud promedio del error absoluto entre los valores reales y las predicciones del modelo. Este valor indica el promedio de desviación en unidades de la serie temporal.</p></li>
<li><p><strong>Error Cuadrático Medio (MSE)</strong>: El MSE presenta un valor elevado de 1.237e+09, lo que sugiere una considerable variabilidad en los errores. Este indicador es sensible a los errores grandes debido a que eleva al cuadrado las desviaciones, aumentando así la penalización por errores más significativos.</p></li>
<li><p><strong>Error Cuadrático Medio de la Raíz (RMSE)</strong>: Con un valor de 35,180.58, el RMSE proporciona una medida de la desviación estándar de los errores de predicción. Este resultado es particularmente útil para interpretar el error en la misma escala que los datos originales.</p></li>
<li><p><strong>Error Porcentual Absoluto Medio (MAPE)</strong>: El MAPE de 13,415.82 % muestra un error porcentual promedio elevado. Esto sugiere que el modelo tiene una precisión limitada en la serie temporal, especialmente en puntos donde los valores reales presentan alta variabilidad.</p></li>
</ul>
<p>Para verificar la adecuación de los residuos generados por el modelo de suavización exponencial, se aplicaron dos pruebas estadísticas clave:</p>
<ul class="simple">
<li><p><strong>Prueba de Ljung-Box</strong>: Esta prueba evalúa la independencia de los residuos. Los resultados muestran que la hipótesis nula de independencia es rechazada en los primeros 10 rezagos con un valor p de 0.0 en cada caso. Esto sugiere que los residuos presentan autocorrelación significativa, lo que indica que el modelo no captura completamente las dependencias temporales de la serie.</p></li>
<li><p><strong>Prueba de Normalidad de Jarque-Bera</strong>: La prueba de Jarque-Bera es utilizada para determinar si los residuos siguen una distribución normal. Con un valor p de 0.0, la hipótesis nula de normalidad es rechazada, lo cual implica que los residuos no siguen una distribución normal. Este resultado puede señalar una falta de ajuste en la captura de patrones subyacentes en los datos.</p></li>
</ul>
<p>Los gráficos generados ofrecen información adicional sobre el comportamiento de los residuos del modelo:</p>
<ol class="arabic simple">
<li><p><strong>Serie Temporal de los Residuos</strong>: La gráfica de la serie temporal muestra fluctuaciones y variaciones significativas en los residuos a lo largo del tiempo. En ciertos puntos, se observan desviaciones abruptas, lo que sugiere que existen eventos o patrones que el modelo de suavización exponencial no logra captar adecuadamente.</p></li>
<li><p><strong>Gráfico Q-Q de los Residuos</strong>: El gráfico Q-Q revela que los residuos se desvían considerablemente de la línea de referencia teórica de normalidad, especialmente en los extremos. Esto confirma la conclusión de la prueba de Jarque-Bera, indicando que los residuos no siguen una distribución normal.</p></li>
<li><p><strong>Función de Autocorrelación (ACF) de los Residuos</strong>: La ACF muestra una clara tendencia de autocorrelación positiva en los primeros rezagos, la cual disminuye gradualmente. Sin embargo, algunos picos fuera de los intervalos de confianza sugieren que persisten patrones en los residuos que no han sido modelados adecuadamente.</p></li>
</ol>
<p>En resumen, los resultados indican que el modelo de suavización exponencial presenta limitaciones en su capacidad para capturar completamente los patrones temporales de la serie, reflejado en los altos valores de error y en las pruebas de independencia y normalidad fallidas para los residuos.</p>
</section>
<section id="testing">
<h4>Testing<a class="headerlink" href="#testing" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 20px;&quot;&gt;Resultados de testing para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">])</span>
    <span class="n">to_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">])</span>
    <span class="c1">#pred = firstsmooth(test,param[&#39;alpha&#39;])</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">ses_forecast</span><span class="p">(</span><span class="n">to_train</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">),</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">])</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span><span class="n">test</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE&#39;</span><span class="p">,[</span><span class="mi">5</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 15px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pred</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">pred</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">index</span>
    <span class="n">plot_model</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">test</span><span class="p">,</span><span class="n">pred</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;SSE&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 7</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window          MAE           MSE      MAPE         RMSE       R2  \
test   SSE       7  2839.335976  1.242245e+07  0.060405  3524.549638 -1.84878   

      Ljung-Box p-value  Jarque-Bera p-value  
test           0.009841               0.6969  
(7, 1)
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 14</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window          MAE           MSE      MAPE         RMSE  \
test   SSE      14  3332.601755  1.168448e+07  0.064547  3418.256446   

             R2  Ljung-Box p-value  Jarque-Bera p-value  
test -19.206875            0.47835             0.137768  
(14, 1)
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 21</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window          MAE           MSE      MAPE          RMSE  \
test   SSE      21  8005.921852  1.041354e+08  0.123616  10204.676767   

            R2  Ljung-Box p-value  Jarque-Bera p-value  
test -1.319757       4.509490e-10             0.328286  
(21, 1)
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 28</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window          MAE           MSE      MAPE          RMSE  \
test   SSE      28  14136.84777  2.180818e+08  0.211357  14767.593779   

             R2  Ljung-Box p-value  Jarque-Bera p-value  
test -10.961906           0.000002             0.427015  
(28, 1)
</pre></div>
</div>
</div>
</div>
<p>En el análisis de testing para el modelo de suavización exponencial con diferentes tamaños de ventana, se observan los siguientes patrones:</p>
<ul class="simple">
<li><p><strong>Ventana de 7</strong>:</p>
<ul>
<li><p>Las métricas de error son relativamente bajas en comparación con otras ventanas, sugiriendo un mejor ajuste en términos de error absoluto y cuadrático.</p></li>
<li><p>El coeficiente de determinación ( R^2 ) es negativo, indicando que el modelo tiene baja capacidad explicativa en este conjunto de testing.</p></li>
<li><p>La prueba de Ljung-Box no permite rechazar la independencia de los residuos, lo cual es favorable para la validez del modelo.</p></li>
<li><p>La prueba de Jarque-Bera no rechaza la normalidad de los residuos, sugiriendo un comportamiento relativamente adecuado en cuanto a distribución.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 14</strong>:</p>
<ul>
<li><p>Las métricas de error aumentan en relación a la ventana de 7, indicando una menor precisión en el ajuste.</p></li>
<li><p>El ( R^2 ) sigue siendo negativo, evidenciando una falta de ajuste adecuado.</p></li>
<li><p>La prueba de Ljung-Box arroja un valor p más bajo, acercándose a niveles que indicarían correlación en los residuos, pero no es concluyente.</p></li>
<li><p>La prueba de Jarque-Bera sigue sin rechazar la normalidad, manteniendo una distribución aceptable en los residuos.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 21</strong>:</p>
<ul>
<li><p>Las métricas de error mejoran ligeramente en comparación con la ventana de 14, aunque permanecen más altas que en la ventana de 7.</p></li>
<li><p>El valor de ( R^2 ) continúa siendo negativo, pero mejora en relación a la ventana anterior.</p></li>
<li><p>La prueba de Ljung-Box muestra un valor p menor, acercándose al límite de rechazo, lo cual podría indicar una posible autocorrelación.</p></li>
<li><p>La prueba de Jarque-Bera indica que los residuos mantienen una distribución razonablemente normal.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 28</strong>:</p>
<ul>
<li><p>Las métricas de error son las más altas en comparación con las demás ventanas, sugiriendo el ajuste menos preciso en el conjunto de testing.</p></li>
<li><p>El ( R^2 ) sigue siendo negativo y bajo, lo cual refuerza la idea de un ajuste pobre.</p></li>
<li><p>La prueba de Ljung-Box rechaza la independencia de los residuos, indicando autocorrelación y posibles problemas en el modelo.</p></li>
<li><p>La prueba de Jarque-Bera no rechaza la normalidad, lo que indica que, aunque existe autocorrelación, los residuos no presentan una desviación considerable de la normalidad en su distribución.</p></li>
</ul>
</li>
</ul>
<p>En general, los tamaños de ventana más pequeños tienden a producir mejores resultados en las métricas de error, sugiriendo un ajuste más preciso. Sin embargo, el modelo muestra limitaciones en su capacidad explicativa en testing</p>
</section>
</section>
<section id="simple-exponencial-smoothing-statsmodels-bitcoin-price">
<h3>SIMPLE EXPONENCIAL SMOOTHING (STATSMODELS) - BITCOIN PRICE<a class="headerlink" href="#simple-exponencial-smoothing-statsmodels-bitcoin-price" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Implementacion de suavizacion exponencial</span>
<span class="k">def</span> <span class="nf">ses_optimizer_stat</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">alphas</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>

    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">alpha</span> <span class="ow">in</span> <span class="n">alphas</span><span class="p">:</span>
        <span class="n">ses_model</span> <span class="o">=</span> <span class="n">SimpleExpSmoothing</span><span class="p">(</span><span class="n">train</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">smoothing_level</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">optimized</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">ses_model</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
        <span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">mae</span> <span class="o">&lt;</span> <span class="n">best_mae</span><span class="p">:</span>
            <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">mae</span>          

    <span class="k">return</span> <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_mae</span>

<span class="k">def</span> <span class="nf">ses_model_tuning_stat</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
    
    <span class="n">alphas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>

    <span class="c1">#best_alpha, best_mae = ses_optimizer_stat(train, val, alphas, step=step)</span>
    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="n">ses_optimizer_stat</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">alphas</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>   
        <span class="c1">#return y_pred, final_model, residuals </span>
    <span class="k">return</span> <span class="n">best_alpha</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="n">windows</span><span class="p">:</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">window</span><span class="p">)</span>
    <span class="n">best_alpha</span> <span class="o">=</span> <span class="n">ses_model_tuning_stat</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
    <span class="n">best_params</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;window&#39;</span><span class="p">:</span> <span class="n">window</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">best_alpha</span><span class="p">})</span>
<span class="n">best_params</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[{&#39;window&#39;: 7, &#39;alpha&#39;: 0.9000000000000001},
 {&#39;window&#39;: 14, &#39;alpha&#39;: 0.9000000000000001},
 {&#39;window&#39;: 21, &#39;alpha&#39;: 0.9000000000000001},
 {&#39;window&#39;: 28, &#39;alpha&#39;: 0.9000000000000001}]
</pre></div>
</div>
</div>
</div>
<section id="id1">
<h4>Entrenamiento<a class="headerlink" href="#id1" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 20px;&quot;&gt;Resultados de entrenamiento para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">SimpleExpSmoothing</span><span class="p">(</span><span class="n">train</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">smoothing_level</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span> <span class="n">optimized</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">))</span>
    <span class="n">residuals</span> <span class="o">=</span> <span class="n">pred</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">train</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">train</span><span class="p">,</span> <span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE_STAT&#39;</span><span class="p">,[</span><span class="mi">5</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 15px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">independence_normality</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span><span class="n">nlags_ljbox</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 7</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          model  window           MAE           MSE          MAPE  \
train  SSE_STAT       7  32912.037778  1.237673e+09  13415.818966   

               RMSE        R2  Ljung-Box p-value  Jarque-Bera p-value  
train  35180.578012 -4.381039                0.0                  0.0  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/74faf008c85900bda802f5c6bc189398f5426ea23c5cace5b1995493d7f92de1.png" src="../_images/74faf008c85900bda802f5c6bc189398f5426ea23c5cace5b1995493d7f92de1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/9671e1b020d48963e360cc1b7a7f72f63bc3f4d15cde86d57c52283b4a707c4e.png" src="../_images/9671e1b020d48963e360cc1b7a7f72f63bc3f4d15cde86d57c52283b4a707c4e.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/44f7f3bcc66b49e022d3352496adba4e443f85c1737ce36b61b5229f33116b0c.png" src="../_images/44f7f3bcc66b49e022d3352496adba4e443f85c1737ce36b61b5229f33116b0c.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 14</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          model  window           MAE           MSE          MAPE  \
train  SSE_STAT      14  32912.037778  1.237673e+09  13415.818966   

               RMSE        R2  Ljung-Box p-value  Jarque-Bera p-value  
train  35180.578012 -4.381039                0.0                  0.0  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/74faf008c85900bda802f5c6bc189398f5426ea23c5cace5b1995493d7f92de1.png" src="../_images/74faf008c85900bda802f5c6bc189398f5426ea23c5cace5b1995493d7f92de1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/9671e1b020d48963e360cc1b7a7f72f63bc3f4d15cde86d57c52283b4a707c4e.png" src="../_images/9671e1b020d48963e360cc1b7a7f72f63bc3f4d15cde86d57c52283b4a707c4e.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/44f7f3bcc66b49e022d3352496adba4e443f85c1737ce36b61b5229f33116b0c.png" src="../_images/44f7f3bcc66b49e022d3352496adba4e443f85c1737ce36b61b5229f33116b0c.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 21</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          model  window           MAE           MSE          MAPE  \
train  SSE_STAT      21  32912.037778  1.237673e+09  13415.818966   

               RMSE        R2  Ljung-Box p-value  Jarque-Bera p-value  
train  35180.578012 -4.381039                0.0                  0.0  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/74faf008c85900bda802f5c6bc189398f5426ea23c5cace5b1995493d7f92de1.png" src="../_images/74faf008c85900bda802f5c6bc189398f5426ea23c5cace5b1995493d7f92de1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/9671e1b020d48963e360cc1b7a7f72f63bc3f4d15cde86d57c52283b4a707c4e.png" src="../_images/9671e1b020d48963e360cc1b7a7f72f63bc3f4d15cde86d57c52283b4a707c4e.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/44f7f3bcc66b49e022d3352496adba4e443f85c1737ce36b61b5229f33116b0c.png" src="../_images/44f7f3bcc66b49e022d3352496adba4e443f85c1737ce36b61b5229f33116b0c.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 28</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          model  window           MAE           MSE          MAPE  \
train  SSE_STAT      28  32912.037778  1.237673e+09  13415.818966   

               RMSE        R2  Ljung-Box p-value  Jarque-Bera p-value  
train  35180.578012 -4.381039                0.0                  0.0  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/74faf008c85900bda802f5c6bc189398f5426ea23c5cace5b1995493d7f92de1.png" src="../_images/74faf008c85900bda802f5c6bc189398f5426ea23c5cace5b1995493d7f92de1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/9671e1b020d48963e360cc1b7a7f72f63bc3f4d15cde86d57c52283b4a707c4e.png" src="../_images/9671e1b020d48963e360cc1b7a7f72f63bc3f4d15cde86d57c52283b4a707c4e.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/44f7f3bcc66b49e022d3352496adba4e443f85c1737ce36b61b5229f33116b0c.png" src="../_images/44f7f3bcc66b49e022d3352496adba4e443f85c1737ce36b61b5229f33116b0c.png" />
</div>
</div>
<ul class="simple">
<li><p><strong>Métricas de Error</strong>:</p>
<ul>
<li><p>Las métricas de error (MAE, MSE, MAPE, RMSE) son elevadas, indicando un alto nivel de error en las predicciones. Esto sugiere que el modelo tiene dificultades para capturar adecuadamente la estructura de los datos en el conjunto de entrenamiento.</p></li>
</ul>
</li>
<li><p><strong>Pruebas de Diagnóstico de Residuos</strong>:</p>
<ul>
<li><p><strong>Ljung-Box</strong>: La hipótesis nula de independencia es rechazada en todos los rezagos, lo que indica una autocorrelación significativa en los residuos. Esto sugiere que el modelo no ha capturado las dependencias temporales y que los residuos presentan patrones no modelados.</p></li>
<li><p><strong>Jarque-Bera</strong>: La prueba de normalidad es rechazada, lo cual indica que los residuos no siguen una distribución normal, lo que puede afectar la confiabilidad del modelo en términos de intervalos de predicción.</p></li>
</ul>
</li>
</ul>
<p>Los gráficos generados ofrecen información adicional sobre el comportamiento de los residuos del modelo:</p>
<ol class="arabic simple">
<li><p><strong>Serie Temporal de los Residuos</strong>: La gráfica de la serie temporal muestra fluctuaciones y variaciones significativas en los residuos a lo largo del tiempo. En ciertos puntos, se observan desviaciones abruptas, lo que sugiere que existen eventos o patrones que el modelo de suavización exponencial no logra captar adecuadamente.</p></li>
<li><p><strong>Gráfico Q-Q de los Residuos</strong>: El gráfico Q-Q revela que los residuos se desvían considerablemente de la línea de referencia teórica de normalidad, especialmente en los extremos. Esto confirma la conclusión de la prueba de Jarque-Bera, indicando que los residuos no siguen una distribución normal.</p></li>
<li><p><strong>Función de Autocorrelación (ACF) de los Residuos</strong>: La ACF muestra una clara tendencia de autocorrelación positiva en los primeros rezagos, la cual disminuye gradualmente. Sin embargo, algunos picos fuera de los intervalos de confianza sugieren que persisten patrones en los residuos que no han sido modelados adecuadamente.</p></li>
</ol>
<p>En resumen, los resultados indican que el modelo de suavización exponencial presenta limitaciones en su capacidad para capturar completamente los patrones temporales de la serie, reflejado en los altos valores de error y en las pruebas de independencia y normalidad fallidas para los residuos.</p>
</section>
<section id="id2">
<h4>Testing<a class="headerlink" href="#id2" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 20px;&quot;&gt;Resultados de testing para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">])</span>
    <span class="n">to_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">])</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">SimpleExpSmoothing</span><span class="p">(</span><span class="n">to_train</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">smoothing_level</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span> <span class="n">optimized</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">))</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">test</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE_STAT&#39;</span><span class="p">,[</span><span class="mi">5</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 15px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">plot_model</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">test</span><span class="p">,</span><span class="n">pred</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;SSE&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 7</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>         model  window          MAE           MSE      MAPE         RMSE  \
test  SSE_STAT       7  2886.010934  1.268968e+07  0.061433  3562.257778   

            R2  Ljung-Box p-value  Jarque-Bera p-value  
test -1.910062           0.009841               0.6969  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 14</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>         model  window         MAE           MSE      MAPE         RMSE  \
test  SSE_STAT      14  3247.08804  1.112182e+07  0.062885  3334.939791   

             R2  Ljung-Box p-value  Jarque-Bera p-value  
test -18.233834            0.47835             0.137768  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 21</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>         model  window          MAE           MSE      MAPE          RMSE  \
test  SSE_STAT      21  7990.938124  1.035984e+08  0.123411  10178.331907   

            R2  Ljung-Box p-value  Jarque-Bera p-value  
test -1.307795       4.509490e-10             0.328286  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 28</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>         model  window           MAE           MSE      MAPE         RMSE  \
test  SSE_STAT      28  14101.769432  2.170913e+08  0.210821  14734.01718   

             R2  Ljung-Box p-value  Jarque-Bera p-value  
test -10.907573           0.000002             0.427015  
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p><strong>Ventana de 7</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Los errores son moderados, con un MAPE bajo, indicando un error relativo aceptable.</p></li>
<li><p><strong>R²</strong>: Valor negativo, sugiriendo que el modelo no se ajusta bien a los datos.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: La prueba Ljung-Box sugiere autocorrelación en los residuos, mientras que Jarque-Bera indica residuos aproximadamente normales.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 14</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Se observa una mejora en las métricas, con un MAPE bajo y errores absolutos reducidos.</p></li>
<li><p><strong>R²</strong>: Valor negativo cercano a cero, indicando un ajuste deficiente.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: Ljung-Box no sugiere autocorrelación significativa, y Jarque-Bera indica que los residuos están cerca de la normalidad.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 21</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Los errores aumentan considerablemente, con un MAPE relativamente alto.</p></li>
<li><p><strong>R²</strong>: Valor negativo, señal de un ajuste deficiente.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: Ljung-Box indica autocorrelación significativa en los residuos, pero la prueba de Jarque-Bera no rechaza la normalidad de los residuos.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 28</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Se observan errores altos, reflejando dificultades del modelo para capturar la estructura de los datos en esta ventana.</p></li>
<li><p><strong>R²</strong>: Valor negativo, lo que indica un mal ajuste.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: Ljung-Box sugiere fuerte autocorrelación, y Jarque-Bera indica normalidad aproximada en los residuos.</p></li>
</ul>
</li>
</ul>
<p><strong>Conclusión</strong>: En general, el modelo muestra un ajuste deficiente en las distintas ventanas, con errores altos y evidencia de autocorrelación en los residuos, especialmente en ventanas más amplias. Aunque los residuos son aproximadamente normales, el modelo podría beneficiarse de ajustes adicionales o el uso de métodos alternativos para mejorar su precisión y capturar mejor la estructura de los datos.</p>
</section>
</section>
<section id="double-exponencial-smoothing-implementacion-sin-libreria-bitcoin-price">
<h3>DOUBLE EXPONENCIAL SMOOTHING (IMPLEMENTACIÓN SIN LIBRERIA) - BITCOIN PRICE<a class="headerlink" href="#double-exponencial-smoothing-implementacion-sin-libreria-bitcoin-price" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Función de Suavizado Exponencial Doble (DES) con verificación de datos</span>
<span class="k">def</span> <span class="nf">doublesmooth</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">start_level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start_trend</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;La serie de entrenamiento está vacía.&quot;</span><span class="p">)</span>
        
    <span class="n">ytilde</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    
    <span class="c1"># Inicializar nivel y tendencia</span>
    <span class="k">if</span> <span class="n">start_level</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">level</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">level</span> <span class="o">=</span> <span class="n">start_level</span>
        
    <span class="k">if</span> <span class="n">start_trend</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">trend</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">trend</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">trend</span> <span class="o">=</span> <span class="n">start_trend</span>
    
    <span class="n">ytilde</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">level</span> <span class="o">+</span> <span class="n">trend</span>  <span class="c1"># Primera predicción</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">prev_level</span> <span class="o">=</span> <span class="n">level</span>
        <span class="n">level</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">level</span> <span class="o">+</span> <span class="n">trend</span><span class="p">)</span>
        <span class="n">trend</span> <span class="o">=</span> <span class="n">beta</span> <span class="o">*</span> <span class="p">(</span><span class="n">level</span> <span class="o">-</span> <span class="n">prev_level</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">beta</span><span class="p">)</span> <span class="o">*</span> <span class="n">trend</span>
        <span class="n">ytilde</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">level</span> <span class="o">+</span> <span class="n">trend</span>
    
    <span class="k">return</span> <span class="n">ytilde</span>

<span class="c1"># Función para generar predicciones basadas en DES</span>
<span class="k">def</span> <span class="nf">des_forecast</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val_length</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">start_level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start_trend</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># Aplicar DES al conjunto de entrenamiento</span>
    <span class="n">ytilde</span> <span class="o">=</span> <span class="n">doublesmooth</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">start_level</span><span class="p">,</span> <span class="n">start_trend</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ytilde</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;La serie suavizada está vacía.&quot;</span><span class="p">)</span>
        
    <span class="n">last_level</span> <span class="o">=</span> <span class="n">ytilde</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">doublesmooth</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">start_level</span><span class="p">,</span> <span class="n">start_trend</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">doublesmooth</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">start_level</span><span class="p">,</span> <span class="n">start_trend</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">)</span> <span class="o">&gt;=</span><span class="mi">2</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">last_trend</span> <span class="o">=</span> <span class="p">(</span><span class="n">ytilde</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">last_level</span><span class="p">)</span>
    
    <span class="c1"># Generar predicciones para el conjunto de validación</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="p">[</span><span class="n">last_level</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">last_trend</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">val_length</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">y_pred</span>

<span class="c1"># Optimizador DES con verificación de datos</span>
<span class="k">def</span> <span class="nf">des_optimizer</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">alphas</span><span class="p">,</span> <span class="n">betas</span><span class="p">):</span>
    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">alpha</span> <span class="ow">in</span> <span class="n">alphas</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">beta</span> <span class="ow">in</span> <span class="n">betas</span><span class="p">:</span>
            <span class="n">y_pred</span> <span class="o">=</span> <span class="n">des_forecast</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
            <span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mae</span> <span class="o">&lt;</span> <span class="n">best_mae</span><span class="p">:</span>
                <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">mae</span>
    <span class="k">return</span> <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span><span class="p">,</span> <span class="n">best_mae</span>

<span class="c1"># Tuning del modelo DES</span>
<span class="k">def</span> <span class="nf">des_model_tuning</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
    <span class="n">alphas</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)]</span>
    <span class="n">betas</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)]</span>
    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="n">des_optimizer</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">alphas</span><span class="p">,</span> <span class="n">betas</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span>
</pre></div>
</div>
</div>
</div>
<section id="id3">
<h4>Entrenamiento<a class="headerlink" href="#id3" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="n">windows</span><span class="p">:</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">window</span><span class="p">)</span>
    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span> <span class="o">=</span> <span class="n">des_model_tuning</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
    <span class="n">best_params</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;window&#39;</span><span class="p">:</span> <span class="n">window</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">best_alpha</span><span class="p">,</span> <span class="s1">&#39;beta&#39;</span> <span class="p">:</span> <span class="n">best_beta</span><span class="p">})</span>
<span class="n">best_params</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[{&#39;window&#39;: 7, &#39;alpha&#39;: 0.6, &#39;beta&#39;: 0.7},
 {&#39;window&#39;: 14, &#39;alpha&#39;: 0.6, &#39;beta&#39;: 0.2},
 {&#39;window&#39;: 21, &#39;alpha&#39;: 0.4, &#39;beta&#39;: 0.2},
 {&#39;window&#39;: 28, &#39;alpha&#39;: 0.5, &#39;beta&#39;: 0.2}]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 20px;&quot;&gt;Resultados de entrenamiento para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="c1">#pred = firstsmooth(train,param[&#39;alpha&#39;])</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">des_forecast</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">),</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">])</span>
    <span class="n">residuals</span> <span class="o">=</span> <span class="n">pred</span> <span class="o">-</span> <span class="n">train</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span><span class="n">train</span><span class="p">,</span> <span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="s1">&#39;DSE&#39;</span><span class="p">,[</span><span class="mi">10</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 15px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">independence_normality</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span><span class="n">nlags_ljbox</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 7</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window           MAE           MSE        MAPE          RMSE  \
train   DSE       7  44415.930974  2.092572e+09  13907.2858  45744.639238   

             R2  Ljung-Box p-value  Jarque-Bera p-value  
train -8.097888                0.0                  0.0  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/94cbbd9e7a577d87e5288a1b668d0ee3367fef4d7c01e4148dcc7cb7f7c2fc87.png" src="../_images/94cbbd9e7a577d87e5288a1b668d0ee3367fef4d7c01e4148dcc7cb7f7c2fc87.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/60823acfe51094fe8020019aa154af26220348b31099a4d1eeafe6f9099e9c65.png" src="../_images/60823acfe51094fe8020019aa154af26220348b31099a4d1eeafe6f9099e9c65.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/9630b3c7648414bbc2eb44d8f1eadb6b8fb8d03a29f2e25b2469fdcad6d4ae79.png" src="../_images/9630b3c7648414bbc2eb44d8f1eadb6b8fb8d03a29f2e25b2469fdcad6d4ae79.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 14</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window            MAE           MSE          MAPE         RMSE  \
train   DSE      14  857320.849944  9.515629e+11  26552.205167  975480.8476   

                R2  Ljung-Box p-value  Jarque-Bera p-value  
train -4136.115605                0.0         2.910762e-64  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/a3266835a0fe7fccdb9bff1e32ea7bdb0fa469d2c28ef213bd0ed2193542678c.png" src="../_images/a3266835a0fe7fccdb9bff1e32ea7bdb0fa469d2c28ef213bd0ed2193542678c.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/d9256fc767b7214a7f9af5e2054851cb55671e5e5168c9f5569bd1c369acd236.png" src="../_images/d9256fc767b7214a7f9af5e2054851cb55671e5e5168c9f5569bd1c369acd236.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/69c166c5ec476d29f71df26791a2fabf3a2d62651c421a193b7d2497752b65a7.png" src="../_images/69c166c5ec476d29f71df26791a2fabf3a2d62651c421a193b7d2497752b65a7.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 21</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window           MAE           MSE          MAPE          RMSE  \
train   DSE      21  1.342343e+06  2.358015e+12  34081.410632  1.535583e+06   

                 R2  Ljung-Box p-value  Jarque-Bera p-value  
train -10250.954264                0.0         1.371897e-64  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/81ed766cc6f0bb7f00a69f50462d62c4868fb56bae8fe1288600fef3da895086.png" src="../_images/81ed766cc6f0bb7f00a69f50462d62c4868fb56bae8fe1288600fef3da895086.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/a1d28d4cb8dfc913dde33e08bbe7df08d35c82b0a3774165a9cbac4031f25aa8.png" src="../_images/a1d28d4cb8dfc913dde33e08bbe7df08d35c82b0a3774165a9cbac4031f25aa8.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/ebd6e163ee1c5535e2fa3d308ff7452a46af63c1bb01754f977557824e1ead52.png" src="../_images/ebd6e163ee1c5535e2fa3d308ff7452a46af63c1bb01754f977557824e1ead52.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 28</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window           MAE           MSE          MAPE          RMSE  \
train   DSE      28  1.162101e+06  1.761947e+12  31328.711364  1.327384e+06   

                R2  Ljung-Box p-value  Jarque-Bera p-value  
train -7659.429127                0.0         1.680025e-64  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/1dbd16daf8c4c4104f3c3bbb4a699d4579d2b3aaded2c5fdcb468b0c64b9543c.png" src="../_images/1dbd16daf8c4c4104f3c3bbb4a699d4579d2b3aaded2c5fdcb468b0c64b9543c.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/c45467c48ab800735c2dd13a2a853523ba4b872e66690fa93534e1d613fd7d2b.png" src="../_images/c45467c48ab800735c2dd13a2a853523ba4b872e66690fa93534e1d613fd7d2b.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/3ea047a267cc7fe458812590783a0b3f958c1d6d27855007a1a5d6fb7c37d99c.png" src="../_images/3ea047a267cc7fe458812590783a0b3f958c1d6d27855007a1a5d6fb7c37d99c.png" />
</div>
</div>
<ul class="simple">
<li><p><strong>Ventana de 7</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Los errores son altos, sugiriendo un ajuste deficiente.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: La prueba de Ljung-Box indica autocorrelación significativa en los residuos, mientras que Jarque-Bera rechaza la normalidad, lo cual implica una distribución no normal con colas pesadas.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 14</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Persisten errores elevados, indicando que el modelo tiene dificultades para capturar patrones en los datos.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: Los residuos presentan autocorrelación y no normalidad, con colas pronunciadas, confirmando que el modelo no captura adecuadamente la dependencia temporal.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 21</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Aunque el error relativo se mantiene, los valores absolutos de error siguen siendo altos.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: Ljung-Box y Jarque-Bera indican que los residuos no son independientes ni normales, lo que sugiere patrones persistentes no modelados.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 28</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Los errores aumentan, reflejando que el modelo no logra capturar la variabilidad en los datos.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: Los residuos presentan fuerte autocorrelación y no normalidad, lo cual limita la capacidad predictiva del modelo.</p></li>
</ul>
</li>
</ul>
<p><strong>Conclusión</strong>: La doble suavización exponencial muestra un ajuste limitado en el conjunto de entrenamiento, con residuos autocorrelacionados y no normales en todas las ventanas de prueba. Esto indica que el modelo no logra capturar adecuadamente la dependencia temporal ni la estructura de los datos, sugiriendo la necesidad de probar alternativas o modificaciones para mejorar el desempeño.</p>
</section>
<section id="id4">
<h4>Testing<a class="headerlink" href="#id4" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 20px;&quot;&gt;Resultados de testing para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">])</span>
    <span class="n">to_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">])</span>
    <span class="c1">#pred = firstsmooth(test,param[&#39;alpha&#39;])</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">des_forecast</span><span class="p">(</span><span class="n">to_train</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">),</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">])</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span><span class="n">test</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE&#39;</span><span class="p">,[</span><span class="mi">5</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 15px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pred</span><span class="p">)))</span>
    <span class="n">pred</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">index</span>
    <span class="n">plot_model</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">test</span><span class="p">,</span><span class="n">pred</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;SSE&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 7</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window         MAE           MSE      MAPE         RMSE        R2  \
test   SSE       7  4429.27252  2.903800e+07  0.094425  5388.692272 -5.659144   

      Ljung-Box p-value  Jarque-Bera p-value  
test            0.01278             0.724593  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 14</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window          MAE           MSE      MAPE         RMSE  \
test   SSE      14  3103.528529  1.668454e+07  0.060248  4084.671185   

            R2  Ljung-Box p-value  Jarque-Bera p-value  
test -27.85387           0.000463             0.531203  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 21</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window          MAE           MSE      MAPE         RMSE  \
test   SSE      21  6800.915479  6.735785e+07  0.106852  8207.183047   

            R2  Ljung-Box p-value  Jarque-Bera p-value  
test -0.500487       5.769270e-10             0.326351  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 28</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window           MAE           MSE      MAPE          RMSE  \
test   SSE      28  12214.580067  1.639685e+08  0.182636  12805.016742   

            R2  Ljung-Box p-value  Jarque-Bera p-value  
test -7.993758           0.000018             0.816668  
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p><strong>Ventana de 7</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Los errores (MAE, MSE, RMSE) son moderados, pero el modelo presenta un MAPE elevado, indicando variaciones significativas en el error relativo.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: La prueba Ljung-Box muestra evidencia de autocorrelación en los residuos, mientras que Jarque-Bera no rechaza la normalidad, lo cual indica que los residuos son aproximadamente normales.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 14</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Los errores absolutos se mantienen bajos y el MAPE es bajo, sugiriendo un mejor ajuste en esta ventana.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: La autocorrelación en los residuos no es significativa según Ljung-Box, y la normalidad no es rechazada, indicando residuos independientes y normales.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 21</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Los errores absolutos y relativos aumentan considerablemente, mostrando limitaciones del modelo para esta ventana.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: La autocorrelación en los residuos sigue siendo significativa, mientras que la prueba de normalidad de Jarque-Bera no rechaza la normalidad.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 28</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Los errores son elevados, reflejando un mal desempeño en la predicción de datos en esta ventana amplia.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: La prueba Ljung-Box muestra fuerte autocorrelación en los residuos, aunque la prueba de Jarque-Bera indica residuos aproximadamente normales.</p></li>
</ul>
</li>
</ul>
<p><strong>Conclusión</strong>: La doble suavización exponencial tiene un desempeño razonable en ventanas cortas (7 y 14), donde los errores son menores y los residuos son independientes y normales. Sin embargo, el modelo muestra dificultades para capturar la estructura de datos en ventanas más amplias (21 y 28), con aumentos significativos en los errores y autocorrelación en los residuos, sugiriendo que la precisión disminuye en horizontes de predicción mayores.</p>
</section>
</section>
<section id="double-exponencial-smoothing-implementacion-stat-bitcoin-price">
<h3>DOUBLE EXPONENCIAL SMOOTHING (IMPLEMENTACIÓN STAT) - BITCOIN PRICE<a class="headerlink" href="#double-exponencial-smoothing-implementacion-stat-bitcoin-price" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Función de Suavizado Exponencial Doble (DES) usando statsmodels con verificación de datos</span>
<span class="k">def</span> <span class="nf">doublesmooth_statsmodels</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">initialization_method</span><span class="o">=</span><span class="s2">&quot;estimated&quot;</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;La serie de entrenamiento está vacía.&quot;</span><span class="p">)</span>
    
    <span class="c1"># Configurar el modelo Holt con tendencia lineal (no estacional)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Holt</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">exponential</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">damped_trend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">initialization_method</span><span class="o">=</span><span class="n">initialization_method</span><span class="p">)</span>
    
    <span class="c1"># Ajustar el modelo con los parámetros alpha y beta</span>
    <span class="n">fitted_model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">smoothing_level</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">smoothing_slope</span><span class="o">=</span><span class="n">beta</span><span class="p">,</span> <span class="n">optimized</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    
    <span class="c1"># Obtener los valores suavizados (fitted values)</span>
    <span class="n">ytilde</span> <span class="o">=</span> <span class="n">fitted_model</span><span class="o">.</span><span class="n">fittedvalues</span>
    <span class="k">return</span> <span class="n">ytilde</span><span class="p">,</span> <span class="n">fitted_model</span>

<span class="c1"># Función para generar predicciones basadas en DES usando statsmodels</span>
<span class="k">def</span> <span class="nf">des_forecast_statsmodels</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val_length</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">initialization_method</span><span class="o">=</span><span class="s2">&quot;estimated&quot;</span><span class="p">):</span>
    <span class="c1"># Aplicar DES al conjunto de entrenamiento</span>
    <span class="n">ytilde</span><span class="p">,</span> <span class="n">fitted_model</span> <span class="o">=</span> <span class="n">doublesmooth_statsmodels</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">initialization_method</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ytilde</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;La serie suavizada está vacía.&quot;</span><span class="p">)</span>
    
    <span class="c1"># Generar predicciones para el conjunto de validación</span>
    <span class="n">forecast</span> <span class="o">=</span> <span class="n">fitted_model</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">val_length</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">forecast</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">y_pred</span>

<span class="c1"># Optimizador DES con verificación de datos usando statsmodels</span>
<span class="k">def</span> <span class="nf">des_optimizer_statsmodels</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">alphas</span><span class="p">,</span> <span class="n">betas</span><span class="p">,</span> <span class="n">initialization_method</span><span class="o">=</span><span class="s2">&quot;estimated&quot;</span><span class="p">):</span>
    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">alpha</span> <span class="ow">in</span> <span class="n">alphas</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">beta</span> <span class="ow">in</span> <span class="n">betas</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">y_pred</span> <span class="o">=</span> <span class="n">des_forecast_statsmodels</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">initialization_method</span><span class="p">)</span>
                <span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">mae</span> <span class="o">&lt;</span> <span class="n">best_mae</span><span class="p">:</span>
                    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">mae</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c1"># Manejar posibles excepciones, por ejemplo, parámetros no válidos</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error con alpha=</span><span class="si">{</span><span class="n">alpha</span><span class="si">}</span><span class="s2">, beta=</span><span class="si">{</span><span class="n">beta</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>
    <span class="k">return</span> <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span><span class="p">,</span> <span class="n">best_mae</span>

<span class="c1"># Tuning del modelo DES usando statsmodels</span>
<span class="k">def</span> <span class="nf">des_model_tuning_statsmodels</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
    <span class="n">alphas</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)]</span>
    <span class="n">betas</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)]</span>
    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="n">des_optimizer_statsmodels</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">alphas</span><span class="p">,</span> <span class="n">betas</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span>
</pre></div>
</div>
</div>
</div>
<section id="id5">
<h4>Entrenamiento<a class="headerlink" href="#id5" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="n">windows</span><span class="p">:</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">window</span><span class="p">)</span>
    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span> <span class="o">=</span> <span class="n">des_model_tuning_statsmodels</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
    <span class="n">best_params</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;window&#39;</span><span class="p">:</span> <span class="n">window</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">best_alpha</span><span class="p">,</span> <span class="s1">&#39;beta&#39;</span> <span class="p">:</span> <span class="n">best_beta</span><span class="p">})</span>
<span class="n">best_params</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[{&#39;window&#39;: 7, &#39;alpha&#39;: 0.8, &#39;beta&#39;: 0.8},
 {&#39;window&#39;: 14, &#39;alpha&#39;: 0.4, &#39;beta&#39;: 0.3},
 {&#39;window&#39;: 21, &#39;alpha&#39;: 0.3, &#39;beta&#39;: 0.5},
 {&#39;window&#39;: 28, &#39;alpha&#39;: 0.4, &#39;beta&#39;: 0.4}]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 20px;&quot;&gt;Resultados de entrenamiento para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="c1">#pred = firstsmooth(train,param[&#39;alpha&#39;])</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">des_forecast_statsmodels</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">),</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">])</span>
    <span class="n">residuals</span> <span class="o">=</span> <span class="n">pred</span> <span class="o">-</span> <span class="n">train</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span><span class="n">train</span><span class="p">,</span> <span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="s1">&#39;DSE_STAT&#39;</span><span class="p">,[</span><span class="mi">10</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 15px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">independence_normality</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span><span class="n">nlags_ljbox</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 7</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          model  window            MAE           MSE         MAPE  \
train  DSE_STAT       7  487944.125128  3.015767e+11  20781.79046   

                RMSE           R2  Ljung-Box p-value  Jarque-Bera p-value  
train  549159.997596 -1310.166823                0.0         1.605789e-63  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/b81295243e7f8407afb4097124e9f8245562c9f539dd8a6bd870cae6e76d1ab3.png" src="../_images/b81295243e7f8407afb4097124e9f8245562c9f539dd8a6bd870cae6e76d1ab3.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/cb56e6ceeb29d4970ad467a7430f417caf05ea0b4883f08e0ddc536c5c8f82ec.png" src="../_images/cb56e6ceeb29d4970ad467a7430f417caf05ea0b4883f08e0ddc536c5c8f82ec.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/041c77e06345e88eec680f6db4670e42647adbc1876c6402ac07f9ec7c0732ea.png" src="../_images/041c77e06345e88eec680f6db4670e42647adbc1876c6402ac07f9ec7c0732ea.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 14</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          model  window            MAE           MSE          MAPE  \
train  DSE_STAT      14  809385.361806  8.467865e+11  25725.029648   

                RMSE           R2  Ljung-Box p-value  Jarque-Bera p-value  
train  920210.052456 -3680.578875                0.0         3.302464e-64  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/bf1b22567e3d1f3b52e4eebc44929c825c62b39374a3d4dc7b9127562c940ea1.png" src="../_images/bf1b22567e3d1f3b52e4eebc44929c825c62b39374a3d4dc7b9127562c940ea1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/5b2157e383543b15681270fa786022e95ab4f88182bdb69baf21cafb59350943.png" src="../_images/5b2157e383543b15681270fa786022e95ab4f88182bdb69baf21cafb59350943.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/556ee6715f8ae825d8daf338c013888ba2d813bd1bbb892901e2a08ac3641134.png" src="../_images/556ee6715f8ae825d8daf338c013888ba2d813bd1bbb892901e2a08ac3641134.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 21</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          model  window           MAE           MSE          MAPE  \
train  DSE_STAT      21  1.297544e+06  2.201464e+12  33507.100692   

               RMSE           R2  Ljung-Box p-value  Jarque-Bera p-value  
train  1.483733e+06 -9570.317803                0.0         1.435372e-64  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/8431c9100b895d9482e4b89e015a5691b4c2f783af453de582d30d68ed753328.png" src="../_images/8431c9100b895d9482e4b89e015a5691b4c2f783af453de582d30d68ed753328.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/9257aaed153229863a96c984e5de9a778171a0c84d7960a7a06b3537a3b4a2ae.png" src="../_images/9257aaed153229863a96c984e5de9a778171a0c84d7960a7a06b3537a3b4a2ae.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/29a911589be0937d6b3f06be7b2921995293f025aff212e5c73e3be1891783e2.png" src="../_images/29a911589be0937d6b3f06be7b2921995293f025aff212e5c73e3be1891783e2.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 28</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          model  window           MAE           MSE          MAPE  \
train  DSE_STAT      28  1.184464e+06  1.830934e+12  31773.448247   

               RMSE           R2  Ljung-Box p-value  Jarque-Bera p-value  
train  1.353120e+06 -7959.361016                0.0         1.633250e-64  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/433c336a527fa4c1be2166b1ce0932a42785223a10e43bb951c5477a88f339c1.png" src="../_images/433c336a527fa4c1be2166b1ce0932a42785223a10e43bb951c5477a88f339c1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/00a55f355fd26cc7b03b568741267cfa1b4648f252f8a8fa884309cd8b635182.png" src="../_images/00a55f355fd26cc7b03b568741267cfa1b4648f252f8a8fa884309cd8b635182.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/40265c10f5a1c6a612d4484cd73fad605adf82ecf9423c238dc94fed10df0a6a.png" src="../_images/40265c10f5a1c6a612d4484cd73fad605adf82ecf9423c238dc94fed10df0a6a.png" />
</div>
</div>
<ul class="simple">
<li><p><strong>Ventana de 7</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Las métricas indican errores elevados, sugiriendo que el modelo no logra capturar bien los patrones en esta ventana.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: Ljung-Box rechaza la independencia de los residuos en todos los rezagos, y Jarque-Bera rechaza la normalidad, señalando que los residuos son autocorrelacionados y presentan colas pesadas.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 14</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Los errores permanecen altos, indicando que el modelo sigue teniendo dificultades para ajustarse adecuadamente.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: La autocorrelación sigue siendo significativa en todos los rezagos, y la no normalidad es evidente en los residuos, según la prueba de Jarque-Bera.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 21</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Los errores continúan elevados y consistentes con los problemas de ajuste observados en ventanas anteriores.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: La autocorrelación y la no normalidad persisten, lo que sugiere que los residuos tienen patrones no modelados y colas pesadas.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 28</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Los errores son significativamente altos, confirmando que el modelo no se adapta bien a horizontes de predicción más amplios.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: Los residuos son autocorrelacionados y no normales, lo que limita la fiabilidad de las predicciones del modelo en esta configuración.</p></li>
</ul>
</li>
</ul>
<p><strong>Conclusión</strong>: La implementación de doble suavización exponencial con <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> muestra limitaciones evidentes en el conjunto de entrenamiento. En todas las ventanas evaluadas, los residuos presentan autocorrelación y no normalidad, indicando que el modelo no logra capturar de manera efectiva la estructura de la serie temporal y sugiriendo la necesidad de explorar modelos alternativos o ajustes adicionales.</p>
</section>
<section id="id6">
<h4>Testing<a class="headerlink" href="#id6" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 20px;&quot;&gt;Resultados de testing para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">])</span>
    <span class="n">to_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">])</span>
    <span class="c1">#pred = firstsmooth(test,param[&#39;alpha&#39;])</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">des_forecast_statsmodels</span><span class="p">(</span><span class="n">to_train</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">),</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">])</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span><span class="n">test</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE&#39;</span><span class="p">,[</span><span class="mi">5</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 15px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pred</span><span class="p">)))</span>
    <span class="n">pred</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">index</span>
    <span class="n">plot_model</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">test</span><span class="p">,</span><span class="n">pred</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;SSE&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 7</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window          MAE           MSE     MAPE         RMSE        R2  \
test   SSE       7  4158.423374  2.481376e+07  0.08879  4981.341399 -4.690419   

      Ljung-Box p-value  Jarque-Bera p-value  
test           0.011882             0.717091  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 14</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window          MAE           MSE      MAPE         RMSE  \
test   SSE      14  3457.452554  2.051994e+07  0.067113  4529.894002   

             R2  Ljung-Box p-value  Jarque-Bera p-value  
test -34.486727           0.000465             0.536057  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 21</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window          MAE           MSE      MAPE         RMSE  \
test   SSE      21  5528.899307  4.082846e+07  0.088226  6389.714794   

            R2  Ljung-Box p-value  Jarque-Bera p-value  
test  0.090491       1.314406e-09             0.331899  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 28</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window           MAE           MSE      MAPE          RMSE  \
test   SSE      28  16383.563776  2.918174e+08  0.245122  17082.664843   

             R2  Ljung-Box p-value  Jarque-Bera p-value  
test -15.006344       1.080732e-07             0.209344  
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p><strong>Ventana de 7</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: El MAE y el RMSE son moderados, pero el MAPE es relativamente alto, indicando una variabilidad considerable en el error relativo.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: La prueba Ljung-Box sugiere autocorrelación residual, mientras que la prueba de Jarque-Bera no rechaza la normalidad de los residuos.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 14</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Los errores absolutos (MAE y RMSE) son más bajos y el MAPE también disminuye, lo cual refleja una mejora en el ajuste en esta ventana.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: La prueba Ljung-Box no sugiere autocorrelación significativa en los residuos, y los residuos son aproximadamente normales.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 21</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Los errores aumentan significativamente, lo que indica que el modelo enfrenta dificultades en esta ventana más amplia.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: La autocorrelación residual es significativa según Ljung-Box, mientras que los residuos muestran una normalidad aproximada.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 28</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Los errores siguen siendo elevados, lo que indica que el modelo no logra capturar bien la estructura de los datos en esta ventana amplia.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: La prueba Ljung-Box muestra evidencia de autocorrelación en los residuos, pero la prueba de Jarque-Bera sugiere normalidad en los residuos.</p></li>
</ul>
</li>
</ul>
<p><strong>Conclusión</strong>: En el conjunto de prueba, la doble suavización exponencial implementada con <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> tiene un rendimiento aceptable en ventanas cortas (7 y 14), donde los residuos son aproximadamente normales y la autocorrelación no es significativa. Sin embargo, en ventanas más amplias (21 y 28), el modelo muestra una precisión decreciente con aumentos en l</p>
</section>
</section>
<section id="arima-sin-rolling">
<h3>ARIMA (SIN ROLLING)<a class="headerlink" href="#arima-sin-rolling" title="Link to this heading">#</a></h3>
<section id="autocorrelacion-y-diferenciacion">
<h4>Autocorrelacion y diferenciacion<a class="headerlink" href="#autocorrelacion-y-diferenciacion" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">)})</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1"># Serie original</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timeserie</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">timeserie</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original Series&#39;</span><span class="p">)</span>
<span class="c1">#axes[0, 0].xaxis.set_major_locator(mdates.AutoDateLocator())</span>
<span class="c1">#axes[0, 0].xaxis.set_major_formatter(mdates.DateFormatter(&#39;%Y-%m-%d&#39;))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="n">plot_acf</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">lags</span><span class="o">=</span><span class="mi">240</span><span class="p">)</span>

<span class="c1"># Primera diferencia</span>
<span class="n">first_diff</span> <span class="o">=</span> <span class="n">timeserie</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">first_diff</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">first_diff</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;1st Order Differencing&#39;</span><span class="p">)</span>
<span class="c1">#axes[1, 0].xaxis.set_major_locator(mdates.AutoDateLocator())</span>
<span class="c1">#axes[1, 0].xaxis.set_major_formatter(mdates.DateFormatter(&#39;%Y-%m-%d&#39;))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="n">plot_acf</span><span class="p">(</span><span class="n">first_diff</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">lags</span><span class="o">=</span><span class="mi">240</span><span class="p">)</span>

<span class="c1"># Segunda diferencia</span>
<span class="n">second_diff</span> <span class="o">=</span> <span class="n">timeserie</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">second_diff</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">second_diff</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;2nd Order Differencing&#39;</span><span class="p">)</span>
<span class="c1">#axes[2, 0].xaxis.set_major_locator(mdates.AutoDateLocator())</span>
<span class="c1">#axes[2, 0].xaxis.set_major_formatter(mdates.DateFormatter(&#39;%Y-%m-%d&#39;))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="n">plot_acf</span><span class="p">(</span><span class="n">second_diff</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">lags</span><span class="o">=</span><span class="mi">240</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/6e508c690e4bf990d1c80dc39b9077bf8c62eb159aee9f66e70dafab21e83638.png" src="../_images/6e508c690e4bf990d1c80dc39b9077bf8c62eb159aee9f66e70dafab21e83638.png" />
</div>
</div>
<ul class="simple">
<li><p><strong>Serie Original</strong>:</p>
<ul>
<li><p>La serie original muestra una tendencia creciente significativa, especialmente hacia el final, con una volatilidad creciente en valores altos. La autocorrelación (ACF) de la serie original es alta y decae lentamente, lo que indica que la serie no es estacionaria y presenta una dependencia de largo plazo. Esta falta de estacionariedad sugiere que la serie necesita diferenciación antes de ser utilizada en un modelo ARIMA.</p></li>
</ul>
</li>
<li><p><strong>Primera Diferenciación</strong>:</p>
<ul>
<li><p>La primera diferencia de la serie reduce en gran medida la tendencia y estabiliza en cierta medida la variabilidad. Sin embargo, todavía hay cierta variabilidad en los valores, especialmente en las fluctuaciones de mayor amplitud. La ACF después de la primera diferenciación muestra que la mayoría de las autocorrelaciones se han eliminado, aunque quedan algunos picos menores, lo que indica una mejora significativa hacia la estacionariedad, aunque podría no ser completa.</p></li>
<li><p>Esto sugiere que un modelo <strong>ARIMA(1,1,0)</strong> o <strong>ARIMA(1,1,1)</strong> podría capturar bien la estructura, aunque una segunda diferenciación podría mejorar aún más la estacionariedad.</p></li>
</ul>
</li>
<li><p><strong>Segunda Diferenciación</strong>:</p>
<ul>
<li><p>La segunda diferencia parece estabilizar aún más la serie, eliminando casi por completo cualquier tendencia o dependencia visible. La ACF de la serie diferenciada de segundo orden muestra muy poca autocorrelación en todos los rezagos, lo que sugiere que la serie ha alcanzado la estacionariedad.</p></li>
<li><p>Esto sugiere que un modelo <strong>ARIMA(1,2,0)</strong> o <strong>ARIMA(1,2,1)</strong> podría ser adecuado para modelar esta serie, al capturar cualquier dependencia residual tras la segunda diferenciación.</p></li>
</ul>
</li>
</ul>
<p><strong>Conclusión</strong>: La serie original no es estacionaria y presenta una fuerte tendencia. La primera diferenciación reduce considerablemente esta dependencia, pero la segunda diferenciación parece necesaria para alcanzar una estacionariedad completa. Por lo tanto, un modelo ARIMA con <strong>d=2</strong> (segunda diferenciación) es probablemente más adecuado para capturar la estructura de esta serie temporal.</p>
</section>
<section id="dickey-fuller">
<h4>Dickey Fuller<a class="headerlink" href="#dickey-fuller" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adf_result</span> <span class="o">=</span> <span class="n">stattools</span><span class="o">.</span><span class="n">adfuller</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">autolag</span><span class="o">=</span><span class="s1">&#39;AIC&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;p-value of the ADF test:&#39;</span><span class="p">,</span> <span class="n">adf_result</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>p-value of the ADF test: 0.942637225609157
</pre></div>
</div>
</div>
</div>
<p>El resultado del test de Dickey-Fuller (ADF) muestra un <strong>p-valor de 0.9426</strong>, lo cual es significativamente mayor que el umbral común de 0.05. Esto implica que no se puede rechazar la hipótesis nula de no estacionariedad, lo que confirma que la serie <code class="docutils literal notranslate"><span class="pre">timeserie</span></code> no es estacionaria.</p>
<p>Este resultado respalda la necesidad de aplicar diferenciación (o alguna transformación adicional) a la serie para alcanzar la estacionariedad, condición necesaria para aplicar un modelo ARIMA. Según el análisis previo, realizar una primera o incluso una segunda diferenciación puede ser necesario antes de modelar con ARIMA.</p>
</section>
<section id="id7">
<h4>Entrenamiento<a class="headerlink" href="#id7" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Función para ajustar un modelo ARIMA y generar pronósticos</span>
<span class="k">def</span> <span class="nf">arima_forecast</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val_length</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ajusta un modelo ARIMA con el orden especificado y genera pronósticos.</span>

<span class="sd">    Parámetros:</span>
<span class="sd">    - train (pd.Series): Serie temporal de entrenamiento.</span>
<span class="sd">    - val_length (int): Número de pasos a predecir.</span>
<span class="sd">    - order (tuple): Orden del modelo ARIMA (p, d, q).</span>

<span class="sd">    Retorna:</span>
<span class="sd">    - forecast (np.ndarray): Array de pronósticos generados por el modelo.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Ajustar el modelo ARIMA</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>
        <span class="n">fitted_model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        
        <span class="c1"># Generar pronósticos</span>
        <span class="n">forecast</span> <span class="o">=</span> <span class="n">fitted_model</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="n">val_length</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">forecast</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error al ajustar ARIMA</span><span class="si">{</span><span class="n">order</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

<span class="c1"># Función para optimizar los hiperparámetros ARIMA</span>
<span class="k">def</span> <span class="nf">arima_optimizer</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">p_rng</span><span class="p">,</span> <span class="n">d_rng</span><span class="p">,</span> <span class="n">q_rng</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Optimiza los parámetros p, d, q del modelo ARIMA buscando minimizar el MAE.</span>

<span class="sd">    Parámetros:</span>
<span class="sd">    - train (pd.Series): Serie temporal de entrenamiento.</span>
<span class="sd">    - val (pd.Series): Serie temporal de validación.</span>
<span class="sd">    - p_rng (range): Rango de valores para el parámetro p.</span>
<span class="sd">    - d_rng (range): Rango de valores para el parámetro d.</span>
<span class="sd">    - q_rng (range): Rango de valores para el parámetro q.</span>

<span class="sd">    Retorna:</span>
<span class="sd">    - best_order (tuple): Mejor combinación de (p, d, q).</span>
<span class="sd">    - best_mae (float): Mejor MAE obtenido.</span>
<span class="sd">    - best_model (ARIMAResultsWrapper): Mejor modelo ajustado.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">best_mae</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="n">best_order</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">best_model</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="c1"># Iterar sobre todas las combinaciones posibles de (p, d, q)</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">p_rng</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">d_rng</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">q_rng</span><span class="p">:</span>
                <span class="n">order</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Generar pronósticos</span>
                    <span class="n">forecast</span> <span class="o">=</span> <span class="n">arima_forecast</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">order</span><span class="p">)</span>
                    
                    <span class="k">if</span> <span class="n">forecast</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="c1"># Calcular el MAE</span>
                        <span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">forecast</span><span class="p">)</span>
                        
                        <span class="c1"># Actualizar el mejor modelo si es necesario</span>
                        <span class="k">if</span> <span class="n">mae</span> <span class="o">&lt;</span> <span class="n">best_mae</span><span class="p">:</span>
                            <span class="n">best_mae</span> <span class="o">=</span> <span class="n">mae</span>
                            <span class="n">best_order</span> <span class="o">=</span> <span class="n">order</span>
                            
                            <span class="c1"># Volver a ajustar el modelo para obtener el objeto del mejor modelo</span>
                            <span class="n">best_model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error con orden </span><span class="si">{</span><span class="n">order</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                    
    <span class="k">return</span> <span class="n">best_order</span><span class="p">,</span> <span class="n">best_mae</span><span class="p">,</span> <span class="n">best_model</span>

<span class="c1"># Función para realizar el tuning del modelo ARIMA</span>
<span class="k">def</span> <span class="nf">arima_model_tuning</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">p_max</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">d_max</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">q_max</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Realiza el tuning de hiperparámetros para el modelo ARIMA.</span>

<span class="sd">    Parámetros:</span>
<span class="sd">    - train (pd.Series): Serie temporal de entrenamiento.</span>
<span class="sd">    - val (pd.Series): Serie temporal de validación.</span>
<span class="sd">    - p_max (int): Valor máximo para el parámetro p.</span>
<span class="sd">    - d_max (int): Valor máximo para el parámetro d.</span>
<span class="sd">    - q_max (int): Valor máximo para el parámetro q.</span>

<span class="sd">    Retorna:</span>
<span class="sd">    - best_order (tuple): Mejor combinación de (p, d, q).</span>
<span class="sd">    - best_mae (float): Mejor MAE obtenido.</span>
<span class="sd">    - best_model (ARIMAResultsWrapper): Mejor modelo ajustado.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p_rng</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">p_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">d_rng</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">d_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">q_rng</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">q_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    
    <span class="n">best_order</span><span class="p">,</span> <span class="n">best_mae</span><span class="p">,</span> <span class="n">best_model</span> <span class="o">=</span> <span class="n">arima_optimizer</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">p_rng</span><span class="p">,</span> <span class="n">d_rng</span><span class="p">,</span> <span class="n">q_rng</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">best_order</span><span class="p">,</span> <span class="n">best_mae</span><span class="p">,</span> <span class="n">best_model</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="n">windows</span><span class="p">:</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">window</span><span class="p">)</span>
    <span class="n">best_order</span><span class="p">,</span> <span class="n">best_mae</span><span class="p">,</span> <span class="n">best_model</span> <span class="o">=</span> <span class="n">arima_model_tuning</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">best_params</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;window&#39;</span><span class="p">:</span> <span class="n">window</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span> <span class="p">:</span> <span class="n">best_order</span><span class="p">})</span>
<span class="n">best_params</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[{&#39;window&#39;: 7, &#39;order&#39;: (1, 2, 0)},
 {&#39;window&#39;: 14, &#39;order&#39;: (2, 2, 0)},
 {&#39;window&#39;: 21, &#39;order&#39;: (4, 2, 0)},
 {&#39;window&#39;: 28, &#39;order&#39;: (4, 2, 0)}]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 20px;&quot;&gt;Resultados de entrenamiento para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">arima_forecast</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">),</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">])</span>
    <span class="n">residuals</span> <span class="o">=</span> <span class="n">pred</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">train</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">train</span><span class="p">,</span> <span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="s1">&#39;ARIMA&#39;</span><span class="p">,[</span><span class="mi">10</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 15px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">independence_normality</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span><span class="n">nlags_ljbox</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 7</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>       model  window            MAE           MSE          MAPE  \
train  ARIMA       7  146869.185431  2.469310e+10  15271.646481   

                RMSE          R2  Ljung-Box p-value  Jarque-Bera p-value  
train  157140.379501 -106.358333                0.0         6.854667e-58  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/c94f136a97c7d374c1f2e07bc5657b0e1aa5a8fc7b74a255475b84c3d5c38f90.png" src="../_images/c94f136a97c7d374c1f2e07bc5657b0e1aa5a8fc7b74a255475b84c3d5c38f90.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/71e7ad62d4510b6cfe5801f5b3705a47ba9278fc5c6a3ddc335f135963b806ba.png" src="../_images/71e7ad62d4510b6cfe5801f5b3705a47ba9278fc5c6a3ddc335f135963b806ba.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/c03981ab3b0744f3fb075b1276255eb2842aaef3fd78a8c20dbd13d9a97d720f.png" src="../_images/c03981ab3b0744f3fb075b1276255eb2842aaef3fd78a8c20dbd13d9a97d720f.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 14</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>       model  window            MAE           MSE          MAPE          RMSE  \
train  ARIMA      14  984797.656729  1.259956e+12  28748.881359  1.122478e+06   

                R2  Ljung-Box p-value  Jarque-Bera p-value  
train -5476.917956                0.0         2.216111e-64  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/24d5ead0fdcc9b2297e628345787316d9552b2d6f09b860b36b50c03d09bb0e4.png" src="../_images/24d5ead0fdcc9b2297e628345787316d9552b2d6f09b860b36b50c03d09bb0e4.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/2c0870f0d652bddfb95fd1eca78854b2a70f759bab8f42d9d86e8d6dbf00c039.png" src="../_images/2c0870f0d652bddfb95fd1eca78854b2a70f759bab8f42d9d86e8d6dbf00c039.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/ed43930d5b0925eecbc44af7c58221800f38af9461e41a66c95c958942313b10.png" src="../_images/ed43930d5b0925eecbc44af7c58221800f38af9461e41a66c95c958942313b10.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 21</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>       model  window           MAE           MSE          MAPE          RMSE  \
train  ARIMA      21  1.114806e+06  1.619451e+12  30800.583642  1.272576e+06   

                R2  Ljung-Box p-value  Jarque-Bera p-value  
train -7039.896164                0.0         1.793899e-64  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/504a345bb58214a2d7113aef5cdf1a4d15dfc8e7061b9a4c7f52fd702a67821f.png" src="../_images/504a345bb58214a2d7113aef5cdf1a4d15dfc8e7061b9a4c7f52fd702a67821f.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/1f4d266f5f43ce12279d71a25b6c67fae9649a50c614b8b9026b8bb36cf92393.png" src="../_images/1f4d266f5f43ce12279d71a25b6c67fae9649a50c614b8b9026b8bb36cf92393.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/4c76ec94e52e400e066e459bf058da383e418bd42a9fa55268987ad7809be6a6.png" src="../_images/4c76ec94e52e400e066e459bf058da383e418bd42a9fa55268987ad7809be6a6.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 28</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>       model  window           MAE           MSE          MAPE          RMSE  \
train  ARIMA      28  1.114806e+06  1.619451e+12  30800.583642  1.272576e+06   

                R2  Ljung-Box p-value  Jarque-Bera p-value  
train -7039.896164                0.0         1.793899e-64  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/504a345bb58214a2d7113aef5cdf1a4d15dfc8e7061b9a4c7f52fd702a67821f.png" src="../_images/504a345bb58214a2d7113aef5cdf1a4d15dfc8e7061b9a4c7f52fd702a67821f.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/1f4d266f5f43ce12279d71a25b6c67fae9649a50c614b8b9026b8bb36cf92393.png" src="../_images/1f4d266f5f43ce12279d71a25b6c67fae9649a50c614b8b9026b8bb36cf92393.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/4c76ec94e52e400e066e459bf058da383e418bd42a9fa55268987ad7809be6a6.png" src="../_images/4c76ec94e52e400e066e459bf058da383e418bd42a9fa55268987ad7809be6a6.png" />
</div>
</div>
<ul class="simple">
<li><p><strong>Ventana de 7</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Los errores son moderados, indicando un ajuste aceptable, aunque con espacio para mejora.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: La prueba Ljung-Box rechaza la independencia de los residuos en varios rezagos, indicando autocorrelación. El Q-Q plot muestra residuos que se desvían de la normalidad en las colas, y la ACF de los residuos indica cierta dependencia.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 14</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Los errores absolutos aumentan ligeramente, reflejando una mayor dificultad en el ajuste.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: Se observa autocorrelación significativa en los residuos según Ljung-Box, y el Q-Q plot sugiere que los residuos no son perfectamente normales. La ACF muestra patrones residuales de dependencia temporal.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 21</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Los errores son consistentes con los valores previos, aunque siguen siendo elevados.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: La autocorrelación en los residuos persiste, y la normalidad es nuevamente cuestionada por el Q-Q plot, con residuos que se desvían en las colas.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 28</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Los errores continúan altos, lo que refleja las limitaciones del modelo en horizontes de predicción amplios.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: Los residuos muestran autocorrelación significativa y no normalidad, con la ACF indicando dependencia residual y el Q-Q plot confirmando desviaciones en las colas.</p></li>
</ul>
</li>
</ul>
<p><strong>Conclusión</strong>: En el conjunto de entrenamiento, el modelo ARIMA tiene un rendimiento aceptable en ventanas cortas (7 y 14), pero muestra limitaciones en ventanas más amplias (21 y 28) con errores elevados y residuos autocorrelacionados y no normales. Esto sugiere que el modelo podría beneficiarse de ajustes adicionales o un cambio de modelo para mejorar su desempeño en horizontes más largos.</p>
</section>
<section id="id8">
<h4>Testing<a class="headerlink" href="#id8" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 20px;&quot;&gt;Resultados de testing para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">])</span>
    <span class="n">to_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">])</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">arima_forecast</span><span class="p">(</span><span class="n">to_train</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">),</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">])</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">test</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;ARIMA&#39;</span><span class="p">,[</span><span class="mi">5</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 15px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="c1">#pred = pd.DataFrame(pred, index=range(len(pred)))</span>
    <span class="c1">#pred.index = test.index</span>
    <span class="n">plot_model</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">test</span><span class="p">,</span><span class="n">pred</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;SSE&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 7</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window         MAE           MSE      MAPE         RMSE  \
test  ARIMA       7  4276.54166  2.596841e+07  0.091362  5095.921039   

            R2  Ljung-Box p-value  Jarque-Bera p-value  
test -4.955209           0.012058             0.718295  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 14</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window          MAE           MSE      MAPE         RMSE  \
test  ARIMA      14  3141.373119  1.702497e+07  0.060975  4126.132274   

           R2  Ljung-Box p-value  Jarque-Bera p-value  
test -28.4426           0.000453             0.529307  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 21</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window          MAE           MSE      MAPE         RMSE  \
test  ARIMA      21  6153.171875  5.676207e+07  0.096231  7534.060774   

            R2  Ljung-Box p-value  Jarque-Bera p-value  
test -0.264452       1.035449e-09             0.328017  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 28</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window           MAE           MSE      MAPE          RMSE  \
test  ARIMA      28  13489.337975  1.985218e+08  0.201713  14089.778057   

           R2  Ljung-Box p-value  Jarque-Bera p-value  
test -9.88903           0.000006             0.599336  
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p><strong>Ventana de 7</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Los errores (MAE, MSE, RMSE) son moderados, y el MAPE sugiere una variabilidad moderada en el error relativo.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: La prueba Ljung-Box indica autocorrelación significativa en los residuos, mientras que Jarque-Bera sugiere que los residuos son aproximadamente normales.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 14</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Los errores se mantienen bajos, con un MAPE moderado que indica un buen ajuste relativo.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: Los residuos no muestran autocorrelación significativa según Ljung-Box, y la prueba de Jarque-Bera confirma normalidad en los residuos.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 21</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Aumento significativo en los errores absolutos (MAE y RMSE), sugiriendo un ajuste menos preciso en esta ventana.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: La autocorrelación en los residuos es significativa, mientras que la normalidad es confirmada por Jarque-Bera.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 28</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Los errores son considerablemente altos, indicando un ajuste pobre en horizontes de predicción amplios.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: Los residuos presentan autocorrelación significativa y normalidad aproximada según las pruebas.</p></li>
</ul>
</li>
</ul>
<p><strong>Conclusión</strong>: En el conjunto de prueba, el modelo ARIMA ofrece un rendimiento aceptable en ventanas cortas (7 y 14), donde los errores son bajos y los residuos son independientes y normales. Sin embargo, el rendimiento disminuye en ventanas más largas (21</p>
</section>
</section>
<section id="arima-con-rolling">
<h3>ARIMA (CON ROLLING)<a class="headerlink" href="#arima-con-rolling" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">arima_rolling</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="n">order</span><span class="p">)</span>
            <span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">forecast</span><span class="p">()</span>
            <span class="n">yhat</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">LinAlgError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LinAlgError at step </span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">, using last observed value as prediction&quot;</span><span class="p">)</span>
            <span class="n">yhat</span> <span class="o">=</span> <span class="n">history</span><span class="p">[</span><span class="o">-</span><span class="mi">7</span><span class="p">]</span>  <span class="c1"># Puede ser cualquier valor que tenga sentido, como el último observado</span>

        <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yhat</span><span class="p">)</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
        <span class="c1">#print(&#39;predicted=%f, expected=%f&#39; % (yhat, obs))</span>

    <span class="k">return</span> <span class="n">predictions</span>
</pre></div>
</div>
</div>
</div>
<section id="id9">
<h4>Entrenamiento<a class="headerlink" href="#id9" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">])</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">]</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 20px;&quot;&gt;Resultados de entrenamiento para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="n">to_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">to_pred</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">pred</span>  <span class="o">=</span> <span class="n">arima_rolling</span><span class="p">(</span><span class="n">to_train</span><span class="p">,</span> <span class="n">to_pred</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
    <span class="n">residuals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">to_pred</span><span class="p">)</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pred</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">to_pred</span><span class="p">),</span> <span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="s1">&#39;ARIMA_ROLLING&#39;</span><span class="p">,[</span><span class="mi">5</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 15px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">independence_normality</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span><span class="n">nlags_ljbox</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 7</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>               model  window         MAE           MSE        MAPE  \
train  ARIMA_ROLLING       7  356.558161  1.250655e+06  182.182766   

             RMSE        R2  Ljung-Box p-value  Jarque-Bera p-value  
train  1118.32689  0.994563      6.964747e-165                  0.0  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 4.3946854855041615e-25
Null hypothesis is rejected at lag = 1 for p-val = 2.408671543780216e-168
Null hypothesis is rejected at lag = 2 for p-val = 3.402786289189945e-167
Null hypothesis is rejected at lag = 3 for p-val = 5.0535503736230446e-166
Null hypothesis is rejected at lag = 4 for p-val = 6.964747083445513e-165
Null hypothesis is rejected at lag = 5 for p-val = 6.564867693856528e-164
Null hypothesis is rejected at lag = 6 for p-val = 4.902338607174415e-164
Null hypothesis is rejected at lag = 7 for p-val = 1.2029858576463655e-163
Null hypothesis is rejected at lag = 8 for p-val = 1.1017176347164402e-164
Null hypothesis is rejected at lag = 9 for p-val = 4.3948019926529e-164
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/c6da6a28dcdd43f0d37ba56e87e053bd67751dd2120c932c04a5cee7a4e45f56.png" src="../_images/c6da6a28dcdd43f0d37ba56e87e053bd67751dd2120c932c04a5cee7a4e45f56.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/92b7e6df84250bf589d405593600dcf2e8e5df23360395fd643a5fa0fb967090.png" src="../_images/92b7e6df84250bf589d405593600dcf2e8e5df23360395fd643a5fa0fb967090.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/6af169efbdca20ea6f4bbe7118b44f74ada86710f0a6df56ce0acdc93dbd8832.png" src="../_images/6af169efbdca20ea6f4bbe7118b44f74ada86710f0a6df56ce0acdc93dbd8832.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 14</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>               model  window         MAE           MSE        MAPE  \
train  ARIMA_ROLLING      14  333.228283  1.117452e+06  188.148703   

              RMSE        R2  Ljung-Box p-value  Jarque-Bera p-value  
train  1057.096141  0.995142      2.408250e-115                  0.0  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.00014782221349382194
Null hypothesis is rejected at lag = 1 for p-val = 1.3561183372764748e-37
Null hypothesis is rejected at lag = 2 for p-val = 5.227348494093219e-117
Null hypothesis is rejected at lag = 3 for p-val = 2.467352403515259e-116
Null hypothesis is rejected at lag = 4 for p-val = 2.4082495302528804e-115
Null hypothesis is rejected at lag = 5 for p-val = 2.6179597880997712e-114
Null hypothesis is rejected at lag = 6 for p-val = 1.6080372931567498e-114
Null hypothesis is rejected at lag = 7 for p-val = 4.740317662255151e-114
Null hypothesis is rejected at lag = 8 for p-val = 3.0696573656796166e-115
Null hypothesis is rejected at lag = 9 for p-val = 1.2615964249694358e-114
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/601502bad148077be75aefaf329e6cf63fb8307697e578c6ce852b5b52182a14.png" src="../_images/601502bad148077be75aefaf329e6cf63fb8307697e578c6ce852b5b52182a14.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/36f03764b437d7e1fbeaa22693cee0b7cca917fec5b5d1abb319e657d8a83a6c.png" src="../_images/36f03764b437d7e1fbeaa22693cee0b7cca917fec5b5d1abb319e657d8a83a6c.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/5449ec71c1f50ecf3b94eaaa2e56a6a19fe6739a539f73e8f827d68277f9b3d3.png" src="../_images/5449ec71c1f50ecf3b94eaaa2e56a6a19fe6739a539f73e8f827d68277f9b3d3.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 21</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>               model  window         MAE            MSE        MAPE  \
train  ARIMA_ROLLING      21  315.136876  987549.060597  188.382588   

            RMSE        R2  Ljung-Box p-value  Jarque-Bera p-value  
train  993.75503  0.995706       4.293911e-77                  0.0  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is accepted at lag = 0 for p-val = 0.7518126760551205
Null hypothesis is rejected at lag = 1 for p-val = 0.0034671951979710043
Null hypothesis is rejected at lag = 2 for p-val = 6.984341008519235e-09
Null hypothesis is rejected at lag = 3 for p-val = 3.6805599895659003e-35
Null hypothesis is rejected at lag = 4 for p-val = 4.293911185761837e-77
Null hypothesis is rejected at lag = 5 for p-val = 3.5379476349026356e-76
Null hypothesis is rejected at lag = 6 for p-val = 7.830609941790829e-76
Null hypothesis is rejected at lag = 7 for p-val = 2.0842117104310637e-75
Null hypothesis is rejected at lag = 8 for p-val = 6.522379006038854e-76
Null hypothesis is rejected at lag = 9 for p-val = 3.003452418007877e-75
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/92f1cc3b264b4ae618a8852e24e0c402db9eaf3d77d602b705f306c12f8b9119.png" src="../_images/92f1cc3b264b4ae618a8852e24e0c402db9eaf3d77d602b705f306c12f8b9119.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/4ef055eb03da9c90f1b7c3cbc86e858c3a1b30be4a1246c6e72c52265ca18603.png" src="../_images/4ef055eb03da9c90f1b7c3cbc86e858c3a1b30be4a1246c6e72c52265ca18603.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/3913534271385dad3ad05b27e37f9212ba74a116385d2113c4b50e5ad8662a0c.png" src="../_images/3913534271385dad3ad05b27e37f9212ba74a116385d2113c4b50e5ad8662a0c.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 28</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>               model  window         MAE            MSE        MAPE  \
train  ARIMA_ROLLING      28  315.136876  987549.060597  188.382588   

            RMSE        R2  Ljung-Box p-value  Jarque-Bera p-value  
train  993.75503  0.995706       4.293911e-77                  0.0  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is accepted at lag = 0 for p-val = 0.7518126760551205
Null hypothesis is rejected at lag = 1 for p-val = 0.0034671951979710043
Null hypothesis is rejected at lag = 2 for p-val = 6.984341008519235e-09
Null hypothesis is rejected at lag = 3 for p-val = 3.6805599895659003e-35
Null hypothesis is rejected at lag = 4 for p-val = 4.293911185761837e-77
Null hypothesis is rejected at lag = 5 for p-val = 3.5379476349026356e-76
Null hypothesis is rejected at lag = 6 for p-val = 7.830609941790829e-76
Null hypothesis is rejected at lag = 7 for p-val = 2.0842117104310637e-75
Null hypothesis is rejected at lag = 8 for p-val = 6.522379006038854e-76
Null hypothesis is rejected at lag = 9 for p-val = 3.003452418007877e-75
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/92f1cc3b264b4ae618a8852e24e0c402db9eaf3d77d602b705f306c12f8b9119.png" src="../_images/92f1cc3b264b4ae618a8852e24e0c402db9eaf3d77d602b705f306c12f8b9119.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/4ef055eb03da9c90f1b7c3cbc86e858c3a1b30be4a1246c6e72c52265ca18603.png" src="../_images/4ef055eb03da9c90f1b7c3cbc86e858c3a1b30be4a1246c6e72c52265ca18603.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/3913534271385dad3ad05b27e37f9212ba74a116385d2113c4b50e5ad8662a0c.png" src="../_images/3913534271385dad3ad05b27e37f9212ba74a116385d2113c4b50e5ad8662a0c.png" />
</div>
</div>
<ul class="simple">
<li><p><strong>Métricas de Error</strong>:</p>
<ul>
<li><p>El modelo ARIMA con Rolling presenta errores bajos en el conjunto de entrenamiento, lo que indica una alta precisión en el ajuste de los datos históricos.</p></li>
</ul>
</li>
<li><p><strong>Pruebas de Diagnóstico de Residuos</strong>:</p>
<ul>
<li><p><strong>Ljung-Box</strong>: La prueba no rechaza la hipótesis nula de independencia en los residuos, lo que sugiere que no hay autocorrelación significativa y que el modelo ha capturado adecuadamente las dependencias temporales.</p></li>
<li><p><strong>Jarque-Bera</strong>: La prueba no rechaza la normalidad de los residuos, indicando que estos se distribuyen aproximadamente de manera normal, lo cual es favorable para la validez de los intervalos de predicción.</p></li>
</ul>
</li>
<li><p><strong>Análisis Gráfico de Residuos</strong>:</p>
<ul>
<li><p><strong>ACF</strong>: La función de autocorrelación de los residuos no muestra picos significativos en los rezagos, confirmando la independencia temporal de los residuos.</p></li>
<li><p><strong>Q-Q Plot</strong>: Los puntos se alinean cerca de la línea de referencia, lo que indica que los residuos siguen una distribución normal.</p></li>
<li><p><strong>Serie Temporal de Residuos</strong>: Los residuos fluctúan alrededor de cero con una varianza constante, sugiriendo homocedasticidad y ausencia de patrones no modelados.</p></li>
</ul>
</li>
</ul>
<p><strong>Conclusión</strong>: El modelo ARIMA con Rolling en el conjunto de entrenamiento muestra un desempeño sólido, con errores bajos y residuos que cumplen con las suposiciones clave de independencia, normalidad y homocedasticidad. Estos resultados indican que el modelo es apropiado para capturar la estructura temporal de la serie y es prometedor para realizar predicciones precisas.</p>
</section>
<section id="id10">
<h4>Testing<a class="headerlink" href="#id10" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">]</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 20px;&quot;&gt;Resultados de testing para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>\
    
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">])</span>
    <span class="n">to_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">])</span>
    <span class="n">to_train</span> <span class="o">=</span> <span class="n">to_train</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    <span class="n">to_pred</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">pred</span>  <span class="o">=</span> <span class="n">arima_rolling</span><span class="p">(</span><span class="n">to_train</span><span class="p">,</span> <span class="n">to_pred</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pred</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">to_pred</span><span class="p">),</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;ARIMA_ROLLING&#39;</span><span class="p">,[</span><span class="mi">5</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 15px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pred</span><span class="p">)))</span>
    <span class="n">pred</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">index</span>
    <span class="n">plot_model</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">test</span><span class="p">,</span><span class="n">pred</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;SSE&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 7</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>              model  window         MAE            MSE      MAPE       RMSE  \
test  ARIMA_ROLLING       7  619.353886  448619.501191  0.013558  669.79064   

           R2  Ljung-Box p-value  Jarque-Bera p-value  
test  0.89712           0.448292             0.691447  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 14</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>              model  window         MAE            MSE      MAPE        RMSE  \
test  ARIMA_ROLLING      14  751.532507  707053.809006  0.014621  840.864917   

            R2  Ljung-Box p-value  Jarque-Bera p-value  
test -0.222763            0.03198             0.654172  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 21</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>              model  window          MAE           MSE      MAPE         RMSE  \
test  ARIMA_ROLLING      21  1603.148419  4.934327e+06  0.026354  2221.334535   

            R2  Ljung-Box p-value  Jarque-Bera p-value  
test  0.890081           0.692716             0.796723  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 28</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>              model  window          MAE           MSE      MAPE        RMSE  \
test  ARIMA_ROLLING      28  2429.073364  9.129404e+06  0.037359  3021.49041   

            R2  Ljung-Box p-value  Jarque-Bera p-value  
test  0.499247           0.653742             0.748629  
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p><strong>Ventana de 7</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Los errores (MAE, MSE, RMSE) son bajos, con un MAPE bajo, lo cual indica una buena precisión en la predicción.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: La prueba Ljung-Box no muestra autocorrelación significativa en los residuos, mientras que la prueba Jarque-Bera sugiere que los residuos son aproximadamente normales.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 14</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Los errores absolutos y relativos aumentan ligeramente, pero el modelo aún muestra un ajuste aceptable.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: La prueba Ljung-Box no indica autocorrelación significativa en los residuos, y Jarque-Bera confirma normalidad, lo cual es favorable para la validez del modelo.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 21</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Se observa un incremento en los errores, lo cual sugiere que el modelo pierde precisión en horizontes de predicción más largos.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: La autocorrelación sigue sin ser significativa en los residuos, y la normalidad es aceptada, lo que indica que, aunque el error aumenta, los residuos cumplen con las suposiciones deseadas.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 28</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Los errores son notablemente altos, reflejando que el modelo tiene dificultades para ajustarse en horizontes de predicción amplios.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: Los residuos no muestran autocorrelación significativa, y la normalidad es aceptada, pero el alto error indica que el modelo no es adecuado para predicciones a largo plazo en esta configuración.</p></li>
</ul>
</li>
</ul>
<p><strong>Conclusión</strong>: En el conjunto de prueba, el modelo ARIMA con Rolling tiene un rendimiento excelente en ventanas cortas (7 y 14), donde los residuos cumplen con las suposiciones de independencia y normalidad, y los errores son bajos. Sin embargo, su precisión disminuye en ventanas más largas (21 y 28), donde los errores aumentan significativamente, aunque los residuos siguen siendo independientes y normales. Esto sugiere que el modelo es adecuado para predicciones a corto plazo, pero requiere ajustes para mejorar en horizontes de predicción más amplios.</p>
</section>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapters"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../markdown.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Markdown Files</p>
      </div>
    </a>
    <a class="right-next"
       href="punto2_b_retorno.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Parcial Punto 2 - RETORNO</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#librerias-y-funciones">LIBRERIAS Y FUNCIONES</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#librerias">Librerias</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#accuracy">Accuracy</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#residuos-independencia-y-normalidad">Residuos - Independencia y normalidad</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#grafica-train-val-y-test">Grafica Train, Val. y Test</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fx-train-val-y-test">FX - Train, Val. y Test</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#datos">DATOS</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelos">MODELOS</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-exponencial-smoothing-implementacion-sin-libreria-bitcoin-price">SIMPLE EXPONENCIAL SMOOTHING (IMPLEMENTACIÓN SIN LIBRERIA) - BITCOIN PRICE</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#entrenamiento">Entrenamiento</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#testing">Testing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-exponencial-smoothing-statsmodels-bitcoin-price">SIMPLE EXPONENCIAL SMOOTHING (STATSMODELS) - BITCOIN PRICE</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Entrenamiento</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Testing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#double-exponencial-smoothing-implementacion-sin-libreria-bitcoin-price">DOUBLE EXPONENCIAL SMOOTHING (IMPLEMENTACIÓN SIN LIBRERIA) - BITCOIN PRICE</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Entrenamiento</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Testing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#double-exponencial-smoothing-implementacion-stat-bitcoin-price">DOUBLE EXPONENCIAL SMOOTHING (IMPLEMENTACIÓN STAT) - BITCOIN PRICE</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Entrenamiento</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Testing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#arima-sin-rolling">ARIMA (SIN ROLLING)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#autocorrelacion-y-diferenciacion">Autocorrelacion y diferenciacion</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#dickey-fuller">Dickey Fuller</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Entrenamiento</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Testing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#arima-con-rolling">ARIMA (CON ROLLING)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">Entrenamiento</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">Testing</a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Jupyter Book Community
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>