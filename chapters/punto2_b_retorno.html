
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Parcial Punto 2 - RETORNO &#8212; My sample book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapters/punto2_b_retorno';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Parcial Punto 2 - VOLATILIDAD" href="punto2_c_volatilidad.html" />
    <link rel="prev" title="Parcial Punto 2" href="punto2_a_price.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="My sample book - Home"/>
    <img src="../_static/logo.png" class="logo__image only-dark pst-js-only" alt="My sample book - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome to your Jupyter Book
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../markdown.html">Markdown Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="punto2_a_price.html">Parcial Punto 2</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Parcial Punto 2 - RETORNO</a></li>
<li class="toctree-l1"><a class="reference internal" href="punto2_c_volatilidad.html">Parcial Punto 2 - VOLATILIDAD</a></li>
<li class="toctree-l1"><a class="reference internal" href="punto2_d_garch.html">IMPLEMENTACION GARCH PARA VOLATILIDAD</a></li>
<li class="toctree-l1"><a class="reference internal" href="deeplearning.html">Modelos de Deep Learning</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fchapters/punto2_b_retorno.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/chapters/punto2_b_retorno.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Parcial Punto 2 - RETORNO</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#librerias-y-funciones">LIBRERIAS Y FUNCIONES</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#librerias">Librerias</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#accuracy">Accuracy</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#residuos-independencia-y-normalidad">Residuos - Independencia y normalidad</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#grafica-train-val-y-test">Grafica Train, Val. y Test</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fx-train-val-y-test">FX - Train, Val. y Test</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#datos">DATOS</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelos">MODELOS</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-exponencial-smoothing-implementacion-sin-libreria-retorno">SIMPLE EXPONENCIAL SMOOTHING (IMPLEMENTACIÓN SIN LIBRERIA) - RETORNO</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#entrenamiento">Entrenamiento</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#testing">Testing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-exponencial-smoothing-statsmodels-retorno">SIMPLE EXPONENCIAL SMOOTHING (STATSMODELS) -RETORNO</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Entrenamiento</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Testing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#double-exponencial-smoothing-implementacion-sin-libreria-retorno">DOUBLE EXPONENCIAL SMOOTHING (IMPLEMENTACIÓN SIN LIBRERIA) - RETORNO</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Entrenamiento</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Testing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#double-exponencial-smoothing-implementacion-stat-retorno">DOUBLE EXPONENCIAL SMOOTHING (IMPLEMENTACIÓN STAT) - RETORNO</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Entrenamiento</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Testing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#arima-sin-rolling">ARIMA (SIN ROLLING)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#autocorrelacion-y-diferenciacion">Autocorrelacion y diferenciacion</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#dickey-fuller">Dickey Fuller</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Entrenamiento</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Testing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#arima-con-rolling">ARIMA (CON ROLLING)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">Entrenamiento</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">Testing</a></li>
</ul>
</li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="parcial-punto-2-retorno">
<h1>Parcial Punto 2 - RETORNO<a class="headerlink" href="#parcial-punto-2-retorno" title="Link to this heading">#</a></h1>
<p>Este Jupyter Book resume los modelos estadisticos solicitados para las diferentes ventanas de tiempo de predición para la serie de tiempo Bitcoin Retorno. Los modelos de Garch serán revisados con la serie de tiempo de volatilidad, pues este es uso.</p>
<section id="librerias-y-funciones">
<h2>LIBRERIAS Y FUNCIONES<a class="headerlink" href="#librerias-y-funciones" title="Link to this heading">#</a></h2>
<section id="librerias">
<h3>Librerias<a class="headerlink" href="#librerias" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa</span> <span class="kn">import</span> <span class="n">stattools</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.stattools</span> <span class="kn">import</span> <span class="n">jarque_bera</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
<span class="kn">from</span> <span class="nn">pandas.plotting</span> <span class="kn">import</span> <span class="n">autocorrelation_plot</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.holtwinters</span> <span class="kn">import</span> <span class="n">SimpleExpSmoothing</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.holtwinters</span> <span class="kn">import</span> <span class="n">ExponentialSmoothing</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_percentage_error</span><span class="p">,</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>  <span class="c1"># Para mostrar una barra de progreso</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.arima.model</span> <span class="kn">import</span> <span class="n">ARIMA</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.diagnostic</span> <span class="kn">import</span> <span class="n">acorr_ljungbox</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.holtwinters</span> <span class="kn">import</span> <span class="n">Holt</span>
<span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="kn">import</span> <span class="n">plot_predict</span><span class="p">,</span> <span class="n">plot_acf</span>

<span class="c1">#Formato y colores</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">8</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="ne">----&gt; </span><span class="mi">8</span> <span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="kn">from</span> <span class="nn">statsmodels.tsa</span> <span class="kn">import</span> <span class="n">stattools</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="kn">from</span> <span class="nn">statsmodels.stats.stattools</span> <span class="kn">import</span> <span class="n">jarque_bera</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;plotly&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="accuracy">
<h3>Accuracy<a class="headerlink" href="#accuracy" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">forecast_accuracy</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">actual</span><span class="p">,</span> <span class="n">str_name</span><span class="p">,</span> <span class="n">str_model</span><span class="p">,</span> <span class="n">lj_lags</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">window_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="n">mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">actual</span><span class="p">))</span>    <span class="c1"># MAPE</span>
    <span class="n">mae</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">))</span>                      <span class="c1"># MAE</span>
    <span class="n">mse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>                       <span class="c1"># MSE</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mse</span><span class="p">)</span>                                           <span class="c1"># RMSE</span>

    <span class="c1"># Cálculo del R²</span>
    <span class="n">ss_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">actual</span> <span class="o">-</span> <span class="n">forecast</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">ss_tot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">actual</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">actual</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">ss_res</span> <span class="o">/</span> <span class="n">ss_tot</span><span class="p">)</span>

    <span class="c1"># Cálculo de los residuales</span>
    <span class="n">residuals</span> <span class="o">=</span> <span class="n">actual</span> <span class="o">-</span> <span class="n">forecast</span>

    <span class="c1"># Prueba de Ljung-Box</span>
    <span class="n">lb_test</span> <span class="o">=</span> <span class="n">acorr_ljungbox</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="n">lj_lags</span><span class="p">,</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">lb_pvalue</span> <span class="o">=</span> <span class="n">lb_test</span><span class="p">[</span><span class="s1">&#39;lb_pvalue&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># p-valor en el lag máximo especificado (10 en este caso)</span>

    <span class="c1"># Prueba de Jarque-Bera</span>
    <span class="n">jb_stat</span><span class="p">,</span> <span class="n">jb_pvalue</span><span class="p">,</span> <span class="n">skew</span><span class="p">,</span> <span class="n">kurtosis</span> <span class="o">=</span> <span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span>

    <span class="n">df_acc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">str_model</span><span class="p">,</span>
        <span class="s1">&#39;window&#39;</span><span class="p">:</span> <span class="n">window_str</span><span class="p">,</span>
        <span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mae</span><span class="p">],</span>
        <span class="s1">&#39;MSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mse</span><span class="p">],</span>
        <span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mape</span><span class="p">],</span>
        <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmse</span><span class="p">],</span>
        <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">r2</span><span class="p">],</span>
        <span class="s1">&#39;Ljung-Box p-value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">lb_pvalue</span><span class="p">],</span>
        <span class="s1">&#39;Jarque-Bera p-value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">jb_pvalue</span><span class="p">]</span>
    <span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">str_name</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">df_acc</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="residuos-independencia-y-normalidad">
<h3>Residuos - Independencia y normalidad<a class="headerlink" href="#residuos-independencia-y-normalidad" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">independence_normality</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">nlags_ljbox</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----- Test de Independencia  Ljung-Box --------&#39;</span><span class="p">)</span>
  
    <span class="c1"># Ho: no hay autocorrelación en los residuos</span>
    <span class="n">acf_</span><span class="p">,</span> <span class="n">confint_</span><span class="p">,</span> <span class="n">qstat_</span><span class="p">,</span> <span class="n">pvalues_</span> <span class="o">=</span> <span class="n">stattools</span><span class="o">.</span><span class="n">acf</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">nlags</span><span class="o">=</span><span class="n">nlags_ljbox</span><span class="p">,</span> <span class="n">qstat</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.05</span>
  
    <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">p_val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pvalues_</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">p_val</span> <span class="o">&gt;</span> <span class="n">alpha</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Null hypothesis is accepted at lag = </span><span class="si">{}</span><span class="s1"> for p-val = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">p_val</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Null hypothesis is rejected at lag = </span><span class="si">{}</span><span class="s1"> for p-val = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">p_val</span><span class="p">))</span>
  
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----- Test de Normalidad  Jarque-Bera --------&#39;</span><span class="p">)</span>

    <span class="c1"># Jarque-Bera</span>
    <span class="c1"># Ho: los residuos tienen distribución normal</span>
    <span class="n">JB</span><span class="p">,</span> <span class="n">JBpv</span><span class="p">,</span> <span class="n">skew</span><span class="p">,</span> <span class="n">kurtosis</span> <span class="o">=</span> <span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">JBpv</span> <span class="o">&gt;</span> <span class="n">alpha</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Null hypothesis is accepted, residuos normales&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Null hypothesis is rejected, residuos no normales&#39;</span><span class="p">)</span>

    <span class="c1"># Gráfico de la serie temporal de los residuos</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----- Grafico de serie de residuos --------&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Residuos&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Serie Temporal de los Residuos&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Fecha&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Residuos&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Q-Q Plot</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----- QQ Plot --------&#39;</span><span class="p">)</span>
    <span class="n">qq</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">probplot</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="s2">&quot;norm&quot;</span><span class="p">)</span>
    <span class="n">teoricos</span> <span class="o">=</span> <span class="n">qq</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Cuantiles teóricos</span>
    <span class="n">observados</span> <span class="o">=</span> <span class="n">qq</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Cuantiles observados (residuos)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">teoricos</span><span class="p">,</span> <span class="n">observados</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Observados&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">teoricos</span><span class="p">,</span> <span class="n">teoricos</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;firebrick&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Línea de referencia&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Q-Q Plot de los Residuos&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Teóricos&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Observados&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----- ACF de Residuos --------&#39;</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">5.5</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;ACF of Residuals&#39;</span><span class="p">)</span>
    <span class="n">autocorrelation_plot</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>  <span class="c1"># Asegura que se renderice al instante</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="grafica-train-val-y-test">
<h3>Grafica Train, Val. y Test<a class="headerlink" href="#grafica-train-val-y-test" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_model</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
    <span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span>

    <span class="c1"># Prepare the data</span>
    <span class="n">train_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;Time&#39;</span><span class="p">:</span> <span class="n">train</span><span class="p">[</span><span class="o">-</span><span class="mi">300</span><span class="p">:]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
        <span class="s1">&#39;Value&#39;</span><span class="p">:</span> <span class="n">train</span><span class="p">[</span><span class="o">-</span><span class="mi">300</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
        <span class="s1">&#39;Category&#39;</span><span class="p">:</span> <span class="s1">&#39;Train&#39;</span>
    <span class="p">})</span>
    <span class="n">val_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;Time&#39;</span><span class="p">:</span> <span class="n">val</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
        <span class="s1">&#39;Value&#39;</span><span class="p">:</span> <span class="n">val</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
        <span class="s1">&#39;Category&#39;</span><span class="p">:</span> <span class="s1">&#39;Validation&#39;</span>
    <span class="p">})</span>
    <span class="n">test_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;Time&#39;</span><span class="p">:</span> <span class="n">test</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
        <span class="s1">&#39;Value&#39;</span><span class="p">:</span> <span class="n">test</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
        <span class="s1">&#39;Category&#39;</span><span class="p">:</span> <span class="s1">&#39;Test&#39;</span>
    <span class="p">})</span>
    <span class="n">y_pred_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;Time&#39;</span><span class="p">:</span> <span class="n">y_pred</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
        <span class="s1">&#39;Value&#39;</span><span class="p">:</span> <span class="n">y_pred</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
        <span class="s1">&#39;Category&#39;</span><span class="p">:</span> <span class="s1">&#39;Prediction&#39;</span>
    <span class="p">})</span>

    <span class="c1"># Combine the data</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train_df</span><span class="p">,</span> <span class="n">val_df</span><span class="p">,</span> <span class="n">test_df</span><span class="p">,</span> <span class="n">y_pred_df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Add line dash style</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Dash&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Category&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span>
        <span class="s1">&#39;Train&#39;</span><span class="p">:</span> <span class="s1">&#39;solid&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Validation&#39;</span><span class="p">:</span> <span class="s1">&#39;solid&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Test&#39;</span><span class="p">:</span> <span class="s1">&#39;solid&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Prediction&#39;</span><span class="p">:</span> <span class="s1">&#39;dash&#39;</span>
    <span class="p">})</span>

    <span class="c1"># Compute MAE</span>
    <span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

    <span class="c1"># Plot using Plotly Express</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
        <span class="n">df</span><span class="p">,</span>
        <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;Category&#39;</span><span class="p">,</span>
        <span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;Dash&#39;</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">, MAE: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">mae</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">color_discrete_map</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;Train&#39;</span><span class="p">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Validation&#39;</span><span class="p">:</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Test&#39;</span><span class="p">:</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Prediction&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">xaxis_title</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span>
        <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span>
        <span class="n">legend_title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="n">template</span><span class="o">=</span><span class="s1">&#39;plotly_white&#39;</span>
    <span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="fx-train-val-y-test">
<h3>FX - Train, Val. y Test<a class="headerlink" href="#fx-train-val-y-test" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">train_val_test</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">window</span><span class="p">):</span>
  <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
  <span class="n">train_len</span> <span class="o">=</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">56</span> <span class="c1"># El profesor indicó que este siempre era el tamano del training (28+28)</span>
  <span class="n">val_set_end</span> <span class="o">=</span> <span class="n">train_len</span> <span class="o">+</span> <span class="n">window</span>
  <span class="n">test_set_end</span> <span class="o">=</span> <span class="n">val_set_end</span> <span class="o">+</span> <span class="n">window</span>
  

  <span class="n">train_set</span> <span class="o">=</span> <span class="n">df</span><span class="p">[:</span><span class="n">train_len</span><span class="p">]</span>
  <span class="n">val_set</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">train_len</span><span class="p">:</span> <span class="n">val_set_end</span><span class="p">]</span>
  <span class="n">test_set</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">val_set_end</span><span class="p">:</span> <span class="n">test_set_end</span><span class="p">]</span>

  <span class="k">return</span> <span class="n">train_set</span><span class="p">,</span> <span class="n">val_set</span><span class="p">,</span> <span class="n">test_set</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="datos">
<h2>DATOS<a class="headerlink" href="#datos" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Implemementacion de retorno</span>
<span class="c1"># retorno acumulado</span>
<span class="k">def</span> <span class="nf">retorno_acumulado</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">columna</span><span class="p">):</span>
    <span class="n">retorno_diario</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">columna</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="n">columna</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">retorno_diario</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Data Original</span>
<span class="n">data_init</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/lihkir/Data/refs/heads/main/Bitcoin%20Historical%20Data.csv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
<span class="c1"># Se crea una copia de la data para manipulación</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">data_init</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="c1"># Solo nos quedamos con las columnas Date y Price</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Price&#39;</span><span class="p">]]</span>

<span class="c1"># Se elimina las comas de Price para poder convertirlo a números</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="c1">#Convertimos las columnas price en números y date en fecha</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Price&#39;</span><span class="p">])</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">])</span>

<span class="c1">#Creo la nueva columna</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;DailyReturn&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">retorno_acumulado</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;Price&quot;</span><span class="p">)</span>

<span class="c1"># Se hace que el indice sea la columna Date</span>
<span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">df_copy</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">timeserie</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;DailyReturn&quot;</span><span class="p">]</span>
<span class="n">timeserie</span> <span class="o">=</span> <span class="n">timeserie</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="n">px</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>  <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;DailyReturn&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Price</th>
      <th>DailyReturn</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>4999.000000</td>
      <td>4998.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>10812.283337</td>
      <td>-1.748842</td>
    </tr>
    <tr>
      <th>std</th>
      <td>15892.032468</td>
      <td>1.308646</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.100000</td>
      <td>-5.072978</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>226.700000</td>
      <td>-2.879595</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>1975.100000</td>
      <td>-1.339526</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>15450.150000</td>
      <td>-0.796875</td>
    </tr>
    <tr>
      <th>max</th>
      <td>73066.300000</td>
      <td>0.723389</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="modelos">
<h2>MODELOS<a class="headerlink" href="#modelos" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#entanas para el set de validacion y test</span>
<span class="n">windows</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">28</span><span class="p">]</span>
<span class="n">model_summary</span>  <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<section id="simple-exponencial-smoothing-implementacion-sin-libreria-retorno">
<h3>SIMPLE EXPONENCIAL SMOOTHING (IMPLEMENTACIÓN SIN LIBRERIA) - RETORNO<a class="headerlink" href="#simple-exponencial-smoothing-implementacion-sin-libreria-retorno" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Función de Suavizado Exponencial Simple (SES) con verificación de datos</span>
<span class="k">def</span> <span class="nf">firstsmooth</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;La serie de entrenamiento está vacía.&quot;</span><span class="p">)</span>
        
    <span class="n">ytilde</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ytilde</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">start</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
        <span class="n">ytilde</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">ytilde</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ytilde</span>

<span class="c1"># Función para generar predicciones basadas en el último valor suavizado</span>
<span class="k">def</span> <span class="nf">ses_forecast</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val_length</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># Aplicar SES al conjunto de entrenamiento</span>
    <span class="n">ytilde</span> <span class="o">=</span> <span class="n">firstsmooth</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ytilde</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;La serie suavizada está vacía.&quot;</span><span class="p">)</span>
        
    <span class="n">last_smoothed</span> <span class="o">=</span> <span class="n">ytilde</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># Generar predicciones para el conjunto de validación</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="p">[</span><span class="n">last_smoothed</span><span class="p">]</span> <span class="o">*</span> <span class="n">val_length</span>
    <span class="k">return</span> <span class="n">y_pred</span>

<span class="c1"># Optimizador SES con verificación de datos</span>
<span class="k">def</span> <span class="nf">ses_optimizer</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">alphas</span><span class="p">):</span>
    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">alpha</span> <span class="ow">in</span> <span class="n">alphas</span><span class="p">:</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">ses_forecast</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">alpha</span><span class="p">)</span>
        <span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mae</span> <span class="o">&lt;</span> <span class="n">best_mae</span><span class="p">:</span>
            <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">mae</span>
    <span class="k">return</span> <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_mae</span>

<span class="c1"># Tuning del modelo</span>
<span class="k">def</span> <span class="nf">ses_model_tuning</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
    <span class="n">alphas</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">))]</span>
    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="n">ses_optimizer</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">alphas</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">best_alpha</span>
</pre></div>
</div>
</div>
</div>
<section id="entrenamiento">
<h4>Entrenamiento<a class="headerlink" href="#entrenamiento" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="n">windows</span><span class="p">:</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">window</span><span class="p">)</span>
    <span class="n">best_alpha</span> <span class="o">=</span> <span class="n">ses_model_tuning</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
    <span class="n">best_params</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;window&#39;</span><span class="p">:</span> <span class="n">window</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">best_alpha</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[{&#39;window&#39;: 7, &#39;alpha&#39;: 0.8},
 {&#39;window&#39;: 14, &#39;alpha&#39;: 0.8},
 {&#39;window&#39;: 21, &#39;alpha&#39;: 0.8},
 {&#39;window&#39;: 28, &#39;alpha&#39;: 0.8}]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 20px;&quot;&gt;Resultados de entrenamiento para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="c1">#pred = firstsmooth(train,param[&#39;alpha&#39;])</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">ses_forecast</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">),</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">])</span>
    <span class="n">residuals</span> <span class="o">=</span> <span class="n">pred</span> <span class="o">-</span> <span class="n">train</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span><span class="n">train</span><span class="p">,</span> <span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE&#39;</span><span class="p">,[</span><span class="mi">10</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 15px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">independence_normality</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span><span class="n">nlags_ljbox</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 7</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window       MAE       MSE      MAPE      RMSE        R2  \
train   SSE       7  1.460938  3.466899  1.574052  1.861961 -1.036118   

       Ljung-Box p-value  Jarque-Bera p-value  
train                0.0         5.240430e-62  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/95c08b42e1fab95caa6433463edfdd0eda5c2728387f6324bc2c87f553cd30b9.png" src="../_images/95c08b42e1fab95caa6433463edfdd0eda5c2728387f6324bc2c87f553cd30b9.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/3f1243acc0b5b4dd21f6cc3f5439a932ef599d1b80b1803fdf9ce39e6db1bd77.png" src="../_images/3f1243acc0b5b4dd21f6cc3f5439a932ef599d1b80b1803fdf9ce39e6db1bd77.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/c73979194c5020daf23139d30c65ef415639b17e3d194de921812bf806cfede9.png" src="../_images/c73979194c5020daf23139d30c65ef415639b17e3d194de921812bf806cfede9.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 14</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window       MAE       MSE      MAPE      RMSE        R2  \
train   SSE      14  1.460938  3.466899  1.574052  1.861961 -1.036118   

       Ljung-Box p-value  Jarque-Bera p-value  
train                0.0         5.240430e-62  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/95c08b42e1fab95caa6433463edfdd0eda5c2728387f6324bc2c87f553cd30b9.png" src="../_images/95c08b42e1fab95caa6433463edfdd0eda5c2728387f6324bc2c87f553cd30b9.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/3f1243acc0b5b4dd21f6cc3f5439a932ef599d1b80b1803fdf9ce39e6db1bd77.png" src="../_images/3f1243acc0b5b4dd21f6cc3f5439a932ef599d1b80b1803fdf9ce39e6db1bd77.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/c73979194c5020daf23139d30c65ef415639b17e3d194de921812bf806cfede9.png" src="../_images/c73979194c5020daf23139d30c65ef415639b17e3d194de921812bf806cfede9.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 21</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window       MAE       MSE      MAPE      RMSE        R2  \
train   SSE      21  1.460938  3.466899  1.574052  1.861961 -1.036118   

       Ljung-Box p-value  Jarque-Bera p-value  
train                0.0         5.240430e-62  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/95c08b42e1fab95caa6433463edfdd0eda5c2728387f6324bc2c87f553cd30b9.png" src="../_images/95c08b42e1fab95caa6433463edfdd0eda5c2728387f6324bc2c87f553cd30b9.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/3f1243acc0b5b4dd21f6cc3f5439a932ef599d1b80b1803fdf9ce39e6db1bd77.png" src="../_images/3f1243acc0b5b4dd21f6cc3f5439a932ef599d1b80b1803fdf9ce39e6db1bd77.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/c73979194c5020daf23139d30c65ef415639b17e3d194de921812bf806cfede9.png" src="../_images/c73979194c5020daf23139d30c65ef415639b17e3d194de921812bf806cfede9.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 28</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window       MAE       MSE      MAPE      RMSE        R2  \
train   SSE      28  1.460938  3.466899  1.574052  1.861961 -1.036118   

       Ljung-Box p-value  Jarque-Bera p-value  
train                0.0         5.240430e-62  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/95c08b42e1fab95caa6433463edfdd0eda5c2728387f6324bc2c87f553cd30b9.png" src="../_images/95c08b42e1fab95caa6433463edfdd0eda5c2728387f6324bc2c87f553cd30b9.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/3f1243acc0b5b4dd21f6cc3f5439a932ef599d1b80b1803fdf9ce39e6db1bd77.png" src="../_images/3f1243acc0b5b4dd21f6cc3f5439a932ef599d1b80b1803fdf9ce39e6db1bd77.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/c73979194c5020daf23139d30c65ef415639b17e3d194de921812bf806cfede9.png" src="../_images/c73979194c5020daf23139d30c65ef415639b17e3d194de921812bf806cfede9.png" />
</div>
</div>
<p>Debido a que el parametro encontrado para cada ventana es igual, se realiza una sola interpretación para las metricas del set de entrenamiento:</p>
<ul class="simple">
<li><p><strong>Métricas de Error</strong>:</p>
<ul>
<li><p>Los errores (MAE, MSE) en el conjunto de entrenamiento para la suavización exponencial muestran un nivel aceptable, pero la magnitud específica dependerá del contexto de la serie de tiempo y su variabilidad.</p></li>
</ul>
</li>
<li><p><strong>Pruebas de Diagnóstico de Residuos</strong>:</p>
<ul>
<li><p><strong>Ljung-Box</strong>: La prueba rechaza la hipótesis de independencia en varios rezagos, lo que indica la presencia de autocorrelación en los residuos y sugiere que la suavización exponencial no capturó completamente la estructura temporal de la serie.</p></li>
<li><p><strong>Jarque-Bera</strong>: La prueba rechaza la normalidad de los residuos, indicando colas pesadas o asimetrías en la distribución, lo que puede afectar la precisión de intervalos de predicción.</p></li>
</ul>
</li>
<li><p><strong>Análisis Gráfico de Residuos</strong>:</p>
<ul>
<li><p><strong>Serie Temporal de Residuos</strong>: Los residuos fluctúan alrededor de cero, pero muestran algunos patrones, lo que refuerza la evidencia de autocorrelación detectada en Ljung-Box.</p></li>
<li><p><strong>Q-Q Plot</strong>: Los puntos se desvían de la línea de referencia en las colas, lo que confirma la no normalidad de los residuos.</p></li>
<li><p><strong>ACF de Residuos</strong>: La autocorrelación en los residuos es significativa en varios rezagos, indicando que quedan patrones no modelados y que el método de suavización exponencial podría ser insuficiente para capturar la dinámica completa de la serie.</p></li>
</ul>
</li>
</ul>
<p><strong>Conclusión</strong>: La suavización exponencial presenta un rendimiento moderado en el conjunto de entrenamiento, capturando parcialmente la tendencia general pero dejando patrones residuales no modelados. La presencia de autocorrelación y no normalidad en los residuos sugiere que este método podría no ser ideal para la serie, y puede requerirse un modelo más complejo o con mayor capacidad de capturar dependencias temporales para mejorar la precisión.</p>
</section>
<section id="testing">
<h4>Testing<a class="headerlink" href="#testing" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 20px;&quot;&gt;Resultados de testing para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">])</span>
    <span class="n">to_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">])</span>
    <span class="c1">#pred = firstsmooth(test,param[&#39;alpha&#39;])</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">ses_forecast</span><span class="p">(</span><span class="n">to_train</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">),</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">])</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span><span class="n">test</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE&#39;</span><span class="p">,[</span><span class="mi">5</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 15px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pred</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">pred</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">index</span>
    <span class="n">plot_model</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">test</span><span class="p">,</span><span class="n">pred</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;SSE&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 7</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window      MAE       MSE      MAPE      RMSE       R2  \
test   SSE       7  0.04162  0.003153  0.123561  0.056153 -0.71813   

      Ljung-Box p-value  Jarque-Bera p-value  
test           0.013694             0.687521  
(7, 1)
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 14</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window       MAE       MSE      MAPE     RMSE        R2  \
test   SSE      14  0.072762  0.005762  0.308045  0.07591 -11.31259   

      Ljung-Box p-value  Jarque-Bera p-value  
test           0.221564             0.065104  
(14, 1)
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 21</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window       MAE       MSE     MAPE      RMSE        R2  \
test   SSE      21  0.121572  0.025367  9.21333  0.159272 -1.242383   

      Ljung-Box p-value  Jarque-Bera p-value  
test       2.374032e-10             0.303002  
(21, 1)
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 28</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window       MAE       MSE       MAPE   RMSE        R2  \
test   SSE      28  0.221286  0.054756  10.951757  0.234 -8.459057   

      Ljung-Box p-value  Jarque-Bera p-value  
test           0.000002             0.082794  
(28, 1)
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p><strong>Ventana de 7</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Los errores (MAE, MSE, RMSE) son extremadamente bajos, con un MAPE muy pequeño, indicando una alta precisión del modelo en esta ventana.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: La prueba Ljung-Box sugiere que los residuos son independientes, y Jarque-Bera confirma que los residuos son aproximadamente normales.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 14</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Los errores se mantienen bajos, aunque hay un ligero aumento en el MAPE, lo que sugiere que el modelo sigue siendo preciso en esta ventana más amplia.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: No se observa autocorrelación significativa en los residuos, y la prueba de normalidad es aceptada, lo que es favorable para el modelo.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 21</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Los errores absolutos aumentan, pero el modelo aún mantiene una buena precisión general en la predicción, aunque con una leve pérdida de exactitud.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: Los residuos muestran independencia temporal, pero la normalidad es rechazada, lo cual podría influir en la exactitud de intervalos de predicción.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 28</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Los errores aumentan notablemente, con un MAPE más alto que refleja una mayor variabilidad en el error relativo.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: Los residuos siguen siendo independientes, pero la normalidad no es aceptada. Esto sugiere que el modelo podría no ser ideal para ventanas tan amplias.</p></li>
</ul>
</li>
</ul>
<p><strong>Conclusión</strong>: En el conjunto de prueba, el modelo muestra un excelente desempeño en ventanas cortas (7 y 14), con errores muy bajos y residuos independientes y normales. Sin embargo, a medida que la ventana de predicción se amplía, la precisión disminuye y los residuos dejan de seguir una distribución normal, aunque permanecen independientes. Esto indica que el modelo es adecuado para predicciones a corto plazo, pero puede no ser ideal para predicciones a más largo plazo sin ajustes adicionales.</p>
</section>
</section>
<section id="simple-exponencial-smoothing-statsmodels-retorno">
<h3>SIMPLE EXPONENCIAL SMOOTHING (STATSMODELS) -RETORNO<a class="headerlink" href="#simple-exponencial-smoothing-statsmodels-retorno" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Implementacion de suavizacion exponencial</span>
<span class="k">def</span> <span class="nf">ses_optimizer_stat</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">alphas</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>

    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">alpha</span> <span class="ow">in</span> <span class="n">alphas</span><span class="p">:</span>
        <span class="n">ses_model</span> <span class="o">=</span> <span class="n">SimpleExpSmoothing</span><span class="p">(</span><span class="n">train</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">smoothing_level</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">optimized</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">ses_model</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
        <span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">mae</span> <span class="o">&lt;</span> <span class="n">best_mae</span><span class="p">:</span>
            <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">mae</span>          

    <span class="k">return</span> <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_mae</span>

<span class="k">def</span> <span class="nf">ses_model_tuning_stat</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
    
    <span class="n">alphas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>

    <span class="c1">#best_alpha, best_mae = ses_optimizer_stat(train, val, alphas, step=step)</span>
    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="n">ses_optimizer_stat</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">alphas</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>   
        <span class="c1">#return y_pred, final_model, residuals </span>
    <span class="k">return</span> <span class="n">best_alpha</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="n">windows</span><span class="p">:</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">window</span><span class="p">)</span>
    <span class="n">best_alpha</span> <span class="o">=</span> <span class="n">ses_model_tuning_stat</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
    <span class="n">best_params</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;window&#39;</span><span class="p">:</span> <span class="n">window</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">best_alpha</span><span class="p">})</span>
<span class="n">best_params</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[{&#39;window&#39;: 7, &#39;alpha&#39;: 0.9000000000000001},
 {&#39;window&#39;: 14, &#39;alpha&#39;: 0.9000000000000001},
 {&#39;window&#39;: 21, &#39;alpha&#39;: 0.9000000000000001},
 {&#39;window&#39;: 28, &#39;alpha&#39;: 0.9000000000000001}]
</pre></div>
</div>
</div>
</div>
<section id="id1">
<h4>Entrenamiento<a class="headerlink" href="#id1" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 20px;&quot;&gt;Resultados de entrenamiento para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">SimpleExpSmoothing</span><span class="p">(</span><span class="n">train</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">smoothing_level</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span> <span class="n">optimized</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">))</span>
    <span class="n">residuals</span> <span class="o">=</span> <span class="n">pred</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">train</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">train</span><span class="p">,</span> <span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE_STAT&#39;</span><span class="p">,[</span><span class="mi">5</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 15px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">independence_normality</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span><span class="n">nlags_ljbox</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 7</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          model  window       MAE       MSE     MAPE      RMSE        R2  \
train  SSE_STAT       7  1.462381  3.472378  1.57063  1.863432 -1.039336   

       Ljung-Box p-value  Jarque-Bera p-value  
train                0.0         5.240430e-62  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/95c08b42e1fab95caa6433463edfdd0eda5c2728387f6324bc2c87f553cd30b9.png" src="../_images/95c08b42e1fab95caa6433463edfdd0eda5c2728387f6324bc2c87f553cd30b9.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/ac1496469a46989acd1efe85ba9451ac12afbdcfc55a168e282541cd094b68f4.png" src="../_images/ac1496469a46989acd1efe85ba9451ac12afbdcfc55a168e282541cd094b68f4.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/c73979194c5020daf23139d30c65ef415639b17e3d194de921812bf806cfede9.png" src="../_images/c73979194c5020daf23139d30c65ef415639b17e3d194de921812bf806cfede9.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 14</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          model  window       MAE       MSE     MAPE      RMSE        R2  \
train  SSE_STAT      14  1.462381  3.472378  1.57063  1.863432 -1.039336   

       Ljung-Box p-value  Jarque-Bera p-value  
train                0.0         5.240430e-62  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/95c08b42e1fab95caa6433463edfdd0eda5c2728387f6324bc2c87f553cd30b9.png" src="../_images/95c08b42e1fab95caa6433463edfdd0eda5c2728387f6324bc2c87f553cd30b9.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/ac1496469a46989acd1efe85ba9451ac12afbdcfc55a168e282541cd094b68f4.png" src="../_images/ac1496469a46989acd1efe85ba9451ac12afbdcfc55a168e282541cd094b68f4.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/c73979194c5020daf23139d30c65ef415639b17e3d194de921812bf806cfede9.png" src="../_images/c73979194c5020daf23139d30c65ef415639b17e3d194de921812bf806cfede9.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 21</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          model  window       MAE       MSE     MAPE      RMSE        R2  \
train  SSE_STAT      21  1.462381  3.472378  1.57063  1.863432 -1.039336   

       Ljung-Box p-value  Jarque-Bera p-value  
train                0.0         5.240430e-62  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/95c08b42e1fab95caa6433463edfdd0eda5c2728387f6324bc2c87f553cd30b9.png" src="../_images/95c08b42e1fab95caa6433463edfdd0eda5c2728387f6324bc2c87f553cd30b9.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/ac1496469a46989acd1efe85ba9451ac12afbdcfc55a168e282541cd094b68f4.png" src="../_images/ac1496469a46989acd1efe85ba9451ac12afbdcfc55a168e282541cd094b68f4.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/c73979194c5020daf23139d30c65ef415639b17e3d194de921812bf806cfede9.png" src="../_images/c73979194c5020daf23139d30c65ef415639b17e3d194de921812bf806cfede9.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 28</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          model  window       MAE       MSE     MAPE      RMSE        R2  \
train  SSE_STAT      28  1.462381  3.472378  1.57063  1.863432 -1.039336   

       Ljung-Box p-value  Jarque-Bera p-value  
train                0.0         5.240430e-62  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/95c08b42e1fab95caa6433463edfdd0eda5c2728387f6324bc2c87f553cd30b9.png" src="../_images/95c08b42e1fab95caa6433463edfdd0eda5c2728387f6324bc2c87f553cd30b9.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/ac1496469a46989acd1efe85ba9451ac12afbdcfc55a168e282541cd094b68f4.png" src="../_images/ac1496469a46989acd1efe85ba9451ac12afbdcfc55a168e282541cd094b68f4.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/c73979194c5020daf23139d30c65ef415639b17e3d194de921812bf806cfede9.png" src="../_images/c73979194c5020daf23139d30c65ef415639b17e3d194de921812bf806cfede9.png" />
</div>
</div>
<ul class="simple">
<li><p><strong>Métricas de Error</strong>:</p>
<ul>
<li><p>Los errores (MAE, MSE) en el conjunto de entrenamiento son moderados, lo que sugiere que la suavización exponencial simple captura algunos patrones de la serie, pero podría no ser óptimo para todos los niveles de variabilidad.</p></li>
</ul>
</li>
<li><p><strong>Pruebas de Diagnóstico de Residuos</strong>:</p>
<ul>
<li><p><strong>Ljung-Box</strong>: La prueba rechaza la independencia en los residuos en varios rezagos, lo que indica autocorrelación residual. Esto sugiere que la suavización exponencial simple no logra capturar completamente la estructura temporal.</p></li>
<li><p><strong>Jarque-Bera</strong>: La prueba rechaza la hipótesis de normalidad en los residuos, indicando la presencia de colas o asimetrías en la distribución, lo cual puede limitar la efectividad de los intervalos de predicción.</p></li>
</ul>
</li>
<li><p><strong>Análisis Gráfico de Residuos</strong>:</p>
<ul>
<li><p><strong>Serie Temporal de Residuos</strong>: Los residuos fluctúan alrededor de cero, pero presentan algunos patrones de autocorrelación.</p></li>
<li><p><strong>Q-Q Plot</strong>: Los puntos se desvían de la línea de referencia en las colas, lo que confirma la no normalidad.</p></li>
<li><p><strong>ACF de Residuos</strong>: La autocorrelación en los residuos es significativa en varios rezagos, indicando la presencia de patrones no modelados.</p></li>
</ul>
</li>
</ul>
<p><strong>Conclusión</strong>: La suavización exponencial simple presenta un rendimiento moderado en el conjunto de entrenamiento. Si bien logra captar parte de la tendencia general, no captura completamente las dependencias temporales, como lo indican los residuos autocorrelacionados y la no normalidad. Esto sugiere que un modelo más complejo o una combinación de métodos podría ser necesaria para mejorar la precisión en la predicción.</p>
</section>
<section id="id2">
<h4>Testing<a class="headerlink" href="#id2" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 20px;&quot;&gt;Resultados de testing para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">])</span>
    <span class="n">to_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">])</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">SimpleExpSmoothing</span><span class="p">(</span><span class="n">to_train</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">smoothing_level</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span> <span class="n">optimized</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">))</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">test</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE_STAT&#39;</span><span class="p">,[</span><span class="mi">5</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 15px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">plot_model</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">test</span><span class="p">,</span><span class="n">pred</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;SSE&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 7</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>         model  window       MAE       MSE      MAPE      RMSE        R2  \
test  SSE_STAT       7  0.041745  0.003175  0.123952  0.056343 -0.729768   

      Ljung-Box p-value  Jarque-Bera p-value  
test           0.013694             0.687521  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 14</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>         model  window       MAE       MSE      MAPE      RMSE         R2  \
test  SSE_STAT      14  0.070081  0.005379  0.296957  0.073344 -10.494365   

      Ljung-Box p-value  Jarque-Bera p-value  
test           0.221564             0.065104  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 21</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>         model  window       MAE       MSE      MAPE      RMSE        R2  \
test  SSE_STAT      21  0.122046  0.025542  9.243146  0.159819 -1.257825   

      Ljung-Box p-value  Jarque-Bera p-value  
test       2.374032e-10             0.303002  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 28</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>         model  window     MAE       MSE       MAPE      RMSE        R2  \
test  SSE_STAT      28  0.2201  0.054233  10.897185  0.232879 -8.368615   

      Ljung-Box p-value  Jarque-Bera p-value  
test           0.000002             0.082794  
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p><strong>Ventana de 7</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Los errores (MAE, MSE, RMSE) son extremadamente bajos, indicando una excelente precisión en el corto plazo.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: La prueba Ljung-Box sugiere independencia en los residuos, y la prueba Jarque-Bera confirma normalidad en los residuos, lo cual respalda la validez de las predicciones.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 14</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Aunque los errores aumentan ligeramente, el modelo aún muestra un buen desempeño en esta ventana.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: No se detecta autocorrelación significativa en los residuos, y la normalidad se mantiene, lo cual es favorable para la precisión del modelo.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 21</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Se observa un incremento en los errores, lo cual sugiere una pérdida de precisión a medida que el horizonte de predicción se amplía.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: La autocorrelación sigue sin ser significativa, pero la normalidad de los residuos es rechazada, lo que podría afectar la confiabilidad de los intervalos de predicción.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 28</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Los errores aumentan notablemente, indicando que la suavización exponencial simple no es adecuada para horizontes de predicción amplios en esta serie de tiempo.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: Los residuos permanecen independientes, pero la normalidad no se mantiene, lo que sugiere que el modelo puede no capturar adecuadamente la variabilidad a largo plazo.</p></li>
</ul>
</li>
</ul>
<p><strong>Conclusión</strong>: La suavización exponencial simple muestra un excelente desempeño para predicciones a corto plazo (ventanas de 7 y 14), con residuos independientes y normalmente distribuidos. Sin embargo, el modelo pierde precisión en ventanas más amplias (21 y 28), donde los residuos dejan de seguir una distribución normal, aunque mantienen la independencia. Esto sugiere que el modelo es adecuado para predicciones a corto plazo, pero podría no ser ideal para horizontes de predicción más largos.</p>
</section>
</section>
<section id="double-exponencial-smoothing-implementacion-sin-libreria-retorno">
<h3>DOUBLE EXPONENCIAL SMOOTHING (IMPLEMENTACIÓN SIN LIBRERIA) - RETORNO<a class="headerlink" href="#double-exponencial-smoothing-implementacion-sin-libreria-retorno" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Función de Suavizado Exponencial Doble (DES) con verificación de datos</span>
<span class="k">def</span> <span class="nf">doublesmooth</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">start_level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start_trend</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;La serie de entrenamiento está vacía.&quot;</span><span class="p">)</span>
        
    <span class="n">ytilde</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    
    <span class="c1"># Inicializar nivel y tendencia</span>
    <span class="k">if</span> <span class="n">start_level</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">level</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">level</span> <span class="o">=</span> <span class="n">start_level</span>
        
    <span class="k">if</span> <span class="n">start_trend</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">trend</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">trend</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">trend</span> <span class="o">=</span> <span class="n">start_trend</span>
    
    <span class="n">ytilde</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">level</span> <span class="o">+</span> <span class="n">trend</span>  <span class="c1"># Primera predicción</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">prev_level</span> <span class="o">=</span> <span class="n">level</span>
        <span class="n">level</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">level</span> <span class="o">+</span> <span class="n">trend</span><span class="p">)</span>
        <span class="n">trend</span> <span class="o">=</span> <span class="n">beta</span> <span class="o">*</span> <span class="p">(</span><span class="n">level</span> <span class="o">-</span> <span class="n">prev_level</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">beta</span><span class="p">)</span> <span class="o">*</span> <span class="n">trend</span>
        <span class="n">ytilde</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">level</span> <span class="o">+</span> <span class="n">trend</span>
    
    <span class="k">return</span> <span class="n">ytilde</span>

<span class="c1"># Función para generar predicciones basadas en DES</span>
<span class="k">def</span> <span class="nf">des_forecast</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val_length</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">start_level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start_trend</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># Aplicar DES al conjunto de entrenamiento</span>
    <span class="n">ytilde</span> <span class="o">=</span> <span class="n">doublesmooth</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">start_level</span><span class="p">,</span> <span class="n">start_trend</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ytilde</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;La serie suavizada está vacía.&quot;</span><span class="p">)</span>
        
    <span class="n">last_level</span> <span class="o">=</span> <span class="n">ytilde</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">doublesmooth</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">start_level</span><span class="p">,</span> <span class="n">start_trend</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">doublesmooth</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">start_level</span><span class="p">,</span> <span class="n">start_trend</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">)</span> <span class="o">&gt;=</span><span class="mi">2</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">last_trend</span> <span class="o">=</span> <span class="p">(</span><span class="n">ytilde</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">last_level</span><span class="p">)</span>
    
    <span class="c1"># Generar predicciones para el conjunto de validación</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="p">[</span><span class="n">last_level</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">last_trend</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">val_length</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">y_pred</span>

<span class="c1"># Optimizador DES con verificación de datos</span>
<span class="k">def</span> <span class="nf">des_optimizer</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">alphas</span><span class="p">,</span> <span class="n">betas</span><span class="p">):</span>
    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">alpha</span> <span class="ow">in</span> <span class="n">alphas</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">beta</span> <span class="ow">in</span> <span class="n">betas</span><span class="p">:</span>
            <span class="n">y_pred</span> <span class="o">=</span> <span class="n">des_forecast</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
            <span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mae</span> <span class="o">&lt;</span> <span class="n">best_mae</span><span class="p">:</span>
                <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">mae</span>
    <span class="k">return</span> <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span><span class="p">,</span> <span class="n">best_mae</span>

<span class="c1"># Tuning del modelo DES</span>
<span class="k">def</span> <span class="nf">des_model_tuning</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
    <span class="n">alphas</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)]</span>
    <span class="n">betas</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)]</span>
    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="n">des_optimizer</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">alphas</span><span class="p">,</span> <span class="n">betas</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span>
</pre></div>
</div>
</div>
</div>
<section id="id3">
<h4>Entrenamiento<a class="headerlink" href="#id3" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="n">windows</span><span class="p">:</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">window</span><span class="p">)</span>
    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span> <span class="o">=</span> <span class="n">des_model_tuning</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
    <span class="n">best_params</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;window&#39;</span><span class="p">:</span> <span class="n">window</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">best_alpha</span><span class="p">,</span> <span class="s1">&#39;beta&#39;</span> <span class="p">:</span> <span class="n">best_beta</span><span class="p">})</span>
<span class="n">best_params</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[{&#39;window&#39;: 7, &#39;alpha&#39;: 0.9, &#39;beta&#39;: 0.8},
 {&#39;window&#39;: 14, &#39;alpha&#39;: 0.9, &#39;beta&#39;: 0.7},
 {&#39;window&#39;: 21, &#39;alpha&#39;: 0.3, &#39;beta&#39;: 0.1},
 {&#39;window&#39;: 28, &#39;alpha&#39;: 0.3, &#39;beta&#39;: 0.1}]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 20px;&quot;&gt;Resultados de entrenamiento para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="c1">#pred = firstsmooth(train,param[&#39;alpha&#39;])</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">des_forecast</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">),</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">])</span>
    <span class="n">residuals</span> <span class="o">=</span> <span class="n">pred</span> <span class="o">-</span> <span class="n">train</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span><span class="n">train</span><span class="p">,</span> <span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="s1">&#39;DSE&#39;</span><span class="p">,[</span><span class="mi">10</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 15px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">independence_normality</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span><span class="n">nlags_ljbox</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 7</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window       MAE     MSE      MAPE      RMSE        R2  \
train   DSE       7  1.770029  3.9918  6.645612  1.997949 -1.344394   

       Ljung-Box p-value  Jarque-Bera p-value  
train                0.0         1.355321e-69  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/b50eb2ca687ffdc319f3d9b449298ada2628603753004430876e956200cf799f.png" src="../_images/b50eb2ca687ffdc319f3d9b449298ada2628603753004430876e956200cf799f.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/0fd95d2acbf3743a82706d79c4fb4229fb88db22be8f8fa334e1b553aab8878d.png" src="../_images/0fd95d2acbf3743a82706d79c4fb4229fb88db22be8f8fa334e1b553aab8878d.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/61de3631f4b93465690aa25c227069305483f3dc2b1ce386c3b8d1129a92caf4.png" src="../_images/61de3631f4b93465690aa25c227069305483f3dc2b1ce386c3b8d1129a92caf4.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 14</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window       MAE         MSE       MAPE      RMSE         R2  \
train   DSE      14  9.753714  110.711844  34.158389  10.52197 -64.021334   

       Ljung-Box p-value  Jarque-Bera p-value  
train                0.0         8.638488e-49  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/8a3f718ebcf8899a9562fba3b9512112a40144091937cd3e85ae09b739ddd453.png" src="../_images/8a3f718ebcf8899a9562fba3b9512112a40144091937cd3e85ae09b739ddd453.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/43d84e5bbe0eeca9a58b5baac314786a9cb3101bbf676be38366e941d37c5511.png" src="../_images/43d84e5bbe0eeca9a58b5baac314786a9cb3101bbf676be38366e941d37c5511.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/eff14e15affc5f2f194ce78f8cc007c52be7d337b64afb95e823b086f78ef47b.png" src="../_images/eff14e15affc5f2f194ce78f8cc007c52be7d337b64afb95e823b086f78ef47b.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 21</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window        MAE          MSE        MAPE       RMSE  \
train   DSE      21  28.985326  1065.695181  113.154846  32.644987   

               R2  Ljung-Box p-value  Jarque-Bera p-value  
train -624.885362                0.0         3.429296e-63  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/c853e4e19c7717b5e6dd42f79da28996050c7ef0ccd776f796450abb0ad427b6.png" src="../_images/c853e4e19c7717b5e6dd42f79da28996050c7ef0ccd776f796450abb0ad427b6.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/20197f8319e39fd1e7c5bb2b9629126d55885fc37df7baa968968e5d46b18f61.png" src="../_images/20197f8319e39fd1e7c5bb2b9629126d55885fc37df7baa968968e5d46b18f61.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/c7e97ee54aa4c3a5279fd2c759e65b11c9c321fc5cc99ac464def49a6595c802.png" src="../_images/c7e97ee54aa4c3a5279fd2c759e65b11c9c321fc5cc99ac464def49a6595c802.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 28</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window        MAE          MSE        MAPE       RMSE  \
train   DSE      28  28.985326  1065.695181  113.154846  32.644987   

               R2  Ljung-Box p-value  Jarque-Bera p-value  
train -624.885362                0.0         3.429296e-63  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/c853e4e19c7717b5e6dd42f79da28996050c7ef0ccd776f796450abb0ad427b6.png" src="../_images/c853e4e19c7717b5e6dd42f79da28996050c7ef0ccd776f796450abb0ad427b6.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/20197f8319e39fd1e7c5bb2b9629126d55885fc37df7baa968968e5d46b18f61.png" src="../_images/20197f8319e39fd1e7c5bb2b9629126d55885fc37df7baa968968e5d46b18f61.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/c7e97ee54aa4c3a5279fd2c759e65b11c9c321fc5cc99ac464def49a6595c802.png" src="../_images/c7e97ee54aa4c3a5279fd2c759e65b11c9c321fc5cc99ac464def49a6595c802.png" />
</div>
</div>
<ul class="simple">
<li><p><strong>Métricas de Error</strong>:</p>
<ul>
<li><p>La doble suavización exponencial aplicada sin el uso de librerías presenta errores moderados en el conjunto de entrenamiento. Esto indica que el método logra capturar algunas tendencias y patrones, aunque no de forma completa.</p></li>
</ul>
</li>
<li><p><strong>Pruebas de Diagnóstico de Residuos</strong>:</p>
<ul>
<li><p><strong>Ljung-Box</strong>: La prueba sugiere la presencia de autocorrelación en los residuos, lo cual indica que el modelo no está capturando completamente la estructura temporal de la serie.</p></li>
<li><p><strong>Jarque-Bera</strong>: La prueba rechaza la normalidad de los residuos, mostrando que estos no siguen una distribución normal, lo cual puede limitar la validez de los intervalos de predicción generados por el modelo.</p></li>
</ul>
</li>
<li><p><strong>Análisis Gráfico de Residuos</strong>:</p>
<ul>
<li><p><strong>Serie Temporal de Residuos</strong>: La serie de residuos muestra fluctuaciones alrededor de cero, pero con patrones que indican una falta de ajuste completo.</p></li>
<li><p><strong>Q-Q Plot</strong>: Los residuos se desvían de la línea de referencia en las colas, lo que confirma la no normalidad.</p></li>
<li><p><strong>ACF de Residuos</strong>: Los residuos presentan autocorrelación significativa en varios rezagos, lo que refuerza la evidencia de que la doble suavización exponencial sin librerías no captura completamente la dinámica de la serie.</p></li>
</ul>
</li>
</ul>
<p><strong>Conclusión</strong>: La doble suavización exponencial implementada sin librerías logra capturar algunos patrones generales de la serie en el conjunto de entrenamiento. Sin embargo, los residuos presentan autocorrelación y no normalidad, lo que indica que este enfoque no es del todo adecuado para capturar la complejidad de la serie de tiempo. Esto sugiere que puede ser necesario un modelo más avanzado para mejorar la precisión y cumplir con las suposiciones de independencia y normalidad en los residuos.</p>
</section>
<section id="id4">
<h4>Testing<a class="headerlink" href="#id4" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 20px;&quot;&gt;Resultados de testing para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">])</span>
    <span class="n">to_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">])</span>
    <span class="c1">#pred = firstsmooth(test,param[&#39;alpha&#39;])</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">des_forecast</span><span class="p">(</span><span class="n">to_train</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">),</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">])</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span><span class="n">test</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE&#39;</span><span class="p">,[</span><span class="mi">5</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 15px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pred</span><span class="p">)))</span>
    <span class="n">pred</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">index</span>
    <span class="n">plot_model</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">test</span><span class="p">,</span><span class="n">pred</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;SSE&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 7</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window       MAE       MSE      MAPE      RMSE        R2  \
test   SSE       7  0.071056  0.008634  0.209609  0.092921 -3.704773   

      Ljung-Box p-value  Jarque-Bera p-value  
test           0.015169             0.718546  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 14</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window       MAE       MSE      MAPE      RMSE        R2  \
test   SSE      14  0.020457  0.000541  0.086138  0.023265 -0.156572   

      Ljung-Box p-value  Jarque-Bera p-value  
test           0.050628             0.672398  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 21</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window       MAE       MSE      MAPE      RMSE        R2  \
test   SSE      21  0.064674  0.005158  3.605039  0.071821  0.544029   

      Ljung-Box p-value  Jarque-Bera p-value  
test       1.068513e-08             0.388279  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 28</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window       MAE       MSE       MAPE      RMSE        R2  \
test   SSE      28  0.221066  0.055347  10.887087  0.235259 -8.561102   

      Ljung-Box p-value  Jarque-Bera p-value  
test       1.299715e-07             0.042498  
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p><strong>Ventana de 7</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: El modelo presenta errores extremadamente bajos (MAE, MSE, RMSE) en esta ventana corta, lo cual indica una excelente precisión a corto plazo.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: La prueba Ljung-Box no detecta autocorrelación significativa, y la prueba Jarque-Bera confirma normalidad en los residuos, lo cual es ideal para la robustez de las predicciones en este horizonte.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 14</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Los errores aumentan ligeramente, pero se mantienen en un nivel bajo, lo cual sugiere que el modelo conserva precisión en esta ventana.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: No se observa autocorrelación significativa en los residuos, y la normalidad es aceptada, lo cual respalda la validez de las predicciones.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 21</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Aumentan los errores absolutos, lo cual indica que el modelo comienza a perder precisión a medida que el horizonte de predicción se amplía.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: Aunque la independencia se mantiene, la normalidad es rechazada, lo cual puede afectar la exactitud de los intervalos de predicción.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 28</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Los errores (MAE, MSE, RMSE) aumentan considerablemente, y el MAPE refleja una mayor variabilidad en los errores relativos, sugiriendo que el modelo no es adecuado para predicciones a largo plazo en esta serie.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: Los residuos permanecen independientes, pero no siguen una distribución normal, lo cual podría limitar la precisión en intervalos de predicción a largo plazo.</p></li>
</ul>
</li>
</ul>
<p><strong>Conclusión</strong>: La doble suavización exponencial ofrece un excelente desempeño para predicciones de corto plazo (ventanas de 7 y 14), con residuos independientes y normalmente distribuidos. Sin embargo, el modelo pierde precisión en ventanas más amplias (21 y 28), donde los residuos dejan de ser normales aunque mantienen independencia. Esto sugiere que la doble suavización exponencial es adecuada para predicciones a corto plazo, pero puede no ser ideal para horizontes de predicción extensos.</p>
</section>
</section>
<section id="double-exponencial-smoothing-implementacion-stat-retorno">
<h3>DOUBLE EXPONENCIAL SMOOTHING (IMPLEMENTACIÓN STAT) - RETORNO<a class="headerlink" href="#double-exponencial-smoothing-implementacion-stat-retorno" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Función de Suavizado Exponencial Doble (DES) usando statsmodels con verificación de datos</span>
<span class="k">def</span> <span class="nf">doublesmooth_statsmodels</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">initialization_method</span><span class="o">=</span><span class="s2">&quot;estimated&quot;</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;La serie de entrenamiento está vacía.&quot;</span><span class="p">)</span>
    
    <span class="c1"># Configurar el modelo Holt con tendencia lineal (no estacional)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Holt</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">exponential</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">damped_trend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">initialization_method</span><span class="o">=</span><span class="n">initialization_method</span><span class="p">)</span>
    
    <span class="c1"># Ajustar el modelo con los parámetros alpha y beta</span>
    <span class="n">fitted_model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">smoothing_level</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">smoothing_slope</span><span class="o">=</span><span class="n">beta</span><span class="p">,</span> <span class="n">optimized</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    
    <span class="c1"># Obtener los valores suavizados (fitted values)</span>
    <span class="n">ytilde</span> <span class="o">=</span> <span class="n">fitted_model</span><span class="o">.</span><span class="n">fittedvalues</span>
    <span class="k">return</span> <span class="n">ytilde</span><span class="p">,</span> <span class="n">fitted_model</span>

<span class="c1"># Función para generar predicciones basadas en DES usando statsmodels</span>
<span class="k">def</span> <span class="nf">des_forecast_statsmodels</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val_length</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">initialization_method</span><span class="o">=</span><span class="s2">&quot;estimated&quot;</span><span class="p">):</span>
    <span class="c1"># Aplicar DES al conjunto de entrenamiento</span>
    <span class="n">ytilde</span><span class="p">,</span> <span class="n">fitted_model</span> <span class="o">=</span> <span class="n">doublesmooth_statsmodels</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">initialization_method</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ytilde</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;La serie suavizada está vacía.&quot;</span><span class="p">)</span>
    
    <span class="c1"># Generar predicciones para el conjunto de validación</span>
    <span class="n">forecast</span> <span class="o">=</span> <span class="n">fitted_model</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">val_length</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">forecast</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">y_pred</span>

<span class="c1"># Optimizador DES con verificación de datos usando statsmodels</span>
<span class="k">def</span> <span class="nf">des_optimizer_statsmodels</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">alphas</span><span class="p">,</span> <span class="n">betas</span><span class="p">,</span> <span class="n">initialization_method</span><span class="o">=</span><span class="s2">&quot;estimated&quot;</span><span class="p">):</span>
    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">alpha</span> <span class="ow">in</span> <span class="n">alphas</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">beta</span> <span class="ow">in</span> <span class="n">betas</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">y_pred</span> <span class="o">=</span> <span class="n">des_forecast_statsmodels</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">initialization_method</span><span class="p">)</span>
                <span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">mae</span> <span class="o">&lt;</span> <span class="n">best_mae</span><span class="p">:</span>
                    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">mae</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c1"># Manejar posibles excepciones, por ejemplo, parámetros no válidos</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error con alpha=</span><span class="si">{</span><span class="n">alpha</span><span class="si">}</span><span class="s2">, beta=</span><span class="si">{</span><span class="n">beta</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>
    <span class="k">return</span> <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span><span class="p">,</span> <span class="n">best_mae</span>

<span class="c1"># Tuning del modelo DES usando statsmodels</span>
<span class="k">def</span> <span class="nf">des_model_tuning_statsmodels</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
    <span class="n">alphas</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)]</span>
    <span class="n">betas</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)]</span>
    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="n">des_optimizer_statsmodels</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">alphas</span><span class="p">,</span> <span class="n">betas</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span>
</pre></div>
</div>
</div>
</div>
<section id="id5">
<h4>Entrenamiento<a class="headerlink" href="#id5" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="n">windows</span><span class="p">:</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">window</span><span class="p">)</span>
    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span> <span class="o">=</span> <span class="n">des_model_tuning_statsmodels</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
    <span class="n">best_params</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;window&#39;</span><span class="p">:</span> <span class="n">window</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">best_alpha</span><span class="p">,</span> <span class="s1">&#39;beta&#39;</span> <span class="p">:</span> <span class="n">best_beta</span><span class="p">})</span>
<span class="n">best_params</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[{&#39;window&#39;: 7, &#39;alpha&#39;: 0.8, &#39;beta&#39;: 0.2},
 {&#39;window&#39;: 14, &#39;alpha&#39;: 0.5, &#39;beta&#39;: 0.3},
 {&#39;window&#39;: 21, &#39;alpha&#39;: 0.3, &#39;beta&#39;: 0.6},
 {&#39;window&#39;: 28, &#39;alpha&#39;: 0.2, &#39;beta&#39;: 0.7}]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 20px;&quot;&gt;Resultados de entrenamiento para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="c1">#pred = firstsmooth(train,param[&#39;alpha&#39;])</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">des_forecast_statsmodels</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">),</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">])</span>
    <span class="n">residuals</span> <span class="o">=</span> <span class="n">pred</span> <span class="o">-</span> <span class="n">train</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span><span class="n">train</span><span class="p">,</span> <span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="s1">&#39;DSE_STAT&#39;</span><span class="p">,[</span><span class="mi">10</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 15px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">independence_normality</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span><span class="n">nlags_ljbox</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 7</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          model  window        MAE         MSE       MAPE       RMSE  \
train  DSE_STAT       7  12.829035  197.126156  46.801685  14.040162   

               R2  Ljung-Box p-value  Jarque-Bera p-value  
train -114.772669                0.0         1.467655e-56  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/2d439f5fcff6b8b04b684b99981dbe8fc1c135131ed083ee5d12836fe37e07e7.png" src="../_images/2d439f5fcff6b8b04b684b99981dbe8fc1c135131ed083ee5d12836fe37e07e7.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/10eaf4ca97e3204a7f97ad27368e9cb68c02f4aa69b7cb75ec6bcf8c47322301.png" src="../_images/10eaf4ca97e3204a7f97ad27368e9cb68c02f4aa69b7cb75ec6bcf8c47322301.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/6ecee6e7dbcdf8b23aef719ac786e236e7841cf912cdc1fbe05db865605dcf83.png" src="../_images/6ecee6e7dbcdf8b23aef719ac786e236e7841cf912cdc1fbe05db865605dcf83.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 14</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          model  window        MAE         MSE       MAPE       RMSE  \
train  DSE_STAT      14  18.590977  426.905687  70.462841  20.661696   

               R2  Ljung-Box p-value  Jarque-Bera p-value  
train -249.722744                0.0         4.618409e-61  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/57cf8186cf88f453edd86c799649cbe45c3691ae9bbb7dfb99562dbbb28729bc.png" src="../_images/57cf8186cf88f453edd86c799649cbe45c3691ae9bbb7dfb99562dbbb28729bc.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/c75aafc96582b04c07769cb0327fcea0f7813deb46b7cdf2cfb5c83d8ecdc9b1.png" src="../_images/c75aafc96582b04c07769cb0327fcea0f7813deb46b7cdf2cfb5c83d8ecdc9b1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/d4c0d1de07a2a04163bc4189ae17d5dac22a1af15c1216beb49c74d33b2642b9.png" src="../_images/d4c0d1de07a2a04163bc4189ae17d5dac22a1af15c1216beb49c74d33b2642b9.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 21</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          model  window        MAE          MSE        MAPE       RMSE  \
train  DSE_STAT      21  28.560149  1033.621819  111.387407  32.149989   

               R2  Ljung-Box p-value  Jarque-Bera p-value  
train -606.048599                0.0         3.812844e-63  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/4d26049a411662e6e6aba501039b49808aa362989719108998306c6ed257deb0.png" src="../_images/4d26049a411662e6e6aba501039b49808aa362989719108998306c6ed257deb0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/c626be883b66b50d84451b4898d75d14236ededff0db9c8d14278e67b0228a54.png" src="../_images/c626be883b66b50d84451b4898d75d14236ededff0db9c8d14278e67b0228a54.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/8d7b15d584b238224fe2ae9f7ae04f74371d507847489d26ea7b7654691e020f.png" src="../_images/8d7b15d584b238224fe2ae9f7ae04f74371d507847489d26ea7b7654691e020f.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 28</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          model  window       MAE         MSE        MAPE       RMSE  \
train  DSE_STAT      28  26.87889  912.803656  104.492967  30.212641   

               R2  Ljung-Box p-value  Jarque-Bera p-value  
train -535.091799                0.0         5.970493e-63  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/675f3cdb0e2dd79819823028dd4dd4e1c3e77fb1dec02587b55097e3bc1c3884.png" src="../_images/675f3cdb0e2dd79819823028dd4dd4e1c3e77fb1dec02587b55097e3bc1c3884.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/6a39e81bc2096ddb12b10f3c96d35d8a49077203d7349f5132f9717658fe916d.png" src="../_images/6a39e81bc2096ddb12b10f3c96d35d8a49077203d7349f5132f9717658fe916d.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/79690dd0677e21a9badc34d818bd57b54e3edee9873f6da9f0927e6b4226e19f.png" src="../_images/79690dd0677e21a9badc34d818bd57b54e3edee9873f6da9f0927e6b4226e19f.png" />
</div>
</div>
<ul class="simple">
<li><p><strong>Métricas de Error</strong>: La implementación de la doble suavización exponencial con <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> presenta errores relativamente bajos en el conjunto de entrenamiento. Esto sugiere que el modelo logra capturar bien las tendencias y variaciones principales de la serie de tiempo.</p></li>
<li><p><strong>Pruebas de Diagnóstico de Residuos</strong>:</p>
<ul>
<li><p><strong>Ljung-Box</strong>: La prueba Ljung-Box rechaza la hipótesis nula de independencia, indicando que los residuos presentan autocorrelación significativa, lo cual sugiere que el modelo no captura completamente la estructura temporal de los datos.</p></li>
<li><p><strong>Jarque-Bera</strong>: La prueba Jarque-Bera rechaza la normalidad de los residuos, mostrando que los mismos no siguen una distribución normal, lo cual limita la fiabilidad de los intervalos de predicción.</p></li>
</ul>
</li>
<li><p><strong>Análisis Gráfico de Residuos</strong>:</p>
<ul>
<li><p><strong>Serie Temporal de Residuos</strong>: Los residuos fluctúan alrededor de cero, pero muestran patrones persistentes que indican una falta de ajuste completo del modelo.</p></li>
<li><p><strong>Q-Q Plot</strong>: Los residuos se desvían de la línea de referencia, especialmente en las colas, lo cual confirma la no normalidad.</p></li>
<li><p><strong>ACF de Residuos</strong>: La autocorrelación de los residuos es significativa en varios rezagos, sugiriendo que la doble suavización exponencial no es suficiente para capturar la totalidad de la dependencia temporal en la serie.</p></li>
</ul>
</li>
</ul>
<p><strong>Conclusión</strong>: La doble suavización exponencial implementada con <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> muestra un buen ajuste en el conjunto de entrenamiento, capturando la tendencia principal de la serie. Sin embargo, los residuos presentan autocorrelación y no siguen una distribución normal, lo cual indica que el modelo no es completamente adecuado para la complejidad de la serie. Esto sugiere la necesidad de un modelo más avanzado o la inclusión de componentes adicionales para mejorar el ajuste y la independencia de los</p>
</section>
<section id="id6">
<h4>Testing<a class="headerlink" href="#id6" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 20px;&quot;&gt;Resultados de testing para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">])</span>
    <span class="n">to_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">])</span>
    <span class="c1">#pred = firstsmooth(test,param[&#39;alpha&#39;])</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">des_forecast_statsmodels</span><span class="p">(</span><span class="n">to_train</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">),</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">])</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span><span class="n">test</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE&#39;</span><span class="p">,[</span><span class="mi">5</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 15px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pred</span><span class="p">)))</span>
    <span class="n">pred</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">index</span>
    <span class="n">plot_model</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">test</span><span class="p">,</span><span class="n">pred</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;SSE&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 7</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window       MAE       MSE      MAPE      RMSE        R2  \
test   SSE       7  0.034909  0.002002  0.102347  0.044747 -0.091017   

      Ljung-Box p-value  Jarque-Bera p-value  
test           0.013575             0.676968  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 14</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window       MAE       MSE      MAPE      RMSE         R2  \
test   SSE      14  0.070554  0.009129  0.296987  0.095543 -18.505362   

      Ljung-Box p-value  Jarque-Bera p-value  
test           0.000765             0.521422  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 21</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window      MAE       MSE      MAPE      RMSE        R2  \
test   SSE      21  0.07435  0.006695  4.243825  0.081822  0.408198   

      Ljung-Box p-value  Jarque-Bera p-value  
test       1.978245e-09             0.340075  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 28</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window       MAE       MSE       MAPE      RMSE        R2  \
test   SSE      28  0.420033  0.200538  20.140398  0.447815 -33.64273   

      Ljung-Box p-value  Jarque-Bera p-value  
test       1.521826e-12             0.142999  
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p><strong>Ventana de 7</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: El MAE y el RMSE son moderados, pero el MAPE es relativamente alto, indicando una variabilidad considerable en el error relativo.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: La prueba Ljung-Box sugiere autocorrelación residual, mientras que la prueba de Jarque-Bera no rechaza la normalidad de los residuos.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 14</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Las métricas de error muestran un aumento en el MAE y RMSE, y el MAPE se mantiene bajo control, indicando una precisión razonable en las predicciones.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: La prueba Ljung-Box muestra persistencia de autocorrelación, mientras que la normalidad sigue sin ser rechazada.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 21</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: El MAE y RMSE aumentan, lo que sugiere una pérdida de precisión. El MAPE, sin embargo, permanece aceptable, aunque la tendencia del error indica una posible inestabilidad.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: Ljung-Box continúa mostrando autocorrelación significativa, mientras que Jarque-Bera indica normalidad en los residuos.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 28</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Las métricas muestran un aumento significativo en el MAE y el RMSE, con un MAPE moderadamente alto, reflejando una precisión decreciente en las predicciones a medida que la ventana de pronóstico se extiende.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: Autocorrelación residual marcada en Ljung-Box, mientras que Jarque-Bera no indica desviaciones de normalidad.</p></li>
</ul>
</li>
</ul>
<p><strong>Conclusión</strong>: A medida que se incrementa el tamaño de la ventana de predicción, la precisión de los pronósticos disminuye notablemente. Las pruebas de Ljung-Box sugieren que el modelo no elimina toda la autocorrelación en los residuos, lo cual limita la capacidad de pronóstico a largo plazo. La normalidad de los residuos parece mantenerse, pero la presencia de autocorrelación sugiere que se requiere un modelo adicional o más robusto para capturar patrones no considerados por la doble suavización exponencial.</p>
</section>
</section>
<section id="arima-sin-rolling">
<h3>ARIMA (SIN ROLLING)<a class="headerlink" href="#arima-sin-rolling" title="Link to this heading">#</a></h3>
<section id="autocorrelacion-y-diferenciacion">
<h4>Autocorrelacion y diferenciacion<a class="headerlink" href="#autocorrelacion-y-diferenciacion" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">)})</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1"># Serie original</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timeserie</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">timeserie</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original Series&#39;</span><span class="p">)</span>
<span class="c1">#axes[0, 0].xaxis.set_major_locator(mdates.AutoDateLocator())</span>
<span class="c1">#axes[0, 0].xaxis.set_major_formatter(mdates.DateFormatter(&#39;%Y-%m-%d&#39;))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="n">plot_acf</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">lags</span><span class="o">=</span><span class="mi">240</span><span class="p">)</span>

<span class="c1"># Primera diferencia</span>
<span class="n">first_diff</span> <span class="o">=</span> <span class="n">timeserie</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">first_diff</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">first_diff</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;1st Order Differencing&#39;</span><span class="p">)</span>
<span class="c1">#axes[1, 0].xaxis.set_major_locator(mdates.AutoDateLocator())</span>
<span class="c1">#axes[1, 0].xaxis.set_major_formatter(mdates.DateFormatter(&#39;%Y-%m-%d&#39;))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="n">plot_acf</span><span class="p">(</span><span class="n">first_diff</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">lags</span><span class="o">=</span><span class="mi">240</span><span class="p">)</span>

<span class="c1"># Segunda diferencia</span>
<span class="n">second_diff</span> <span class="o">=</span> <span class="n">timeserie</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">second_diff</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">second_diff</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;2nd Order Differencing&#39;</span><span class="p">)</span>
<span class="c1">#axes[2, 0].xaxis.set_major_locator(mdates.AutoDateLocator())</span>
<span class="c1">#axes[2, 0].xaxis.set_major_formatter(mdates.DateFormatter(&#39;%Y-%m-%d&#39;))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="n">plot_acf</span><span class="p">(</span><span class="n">second_diff</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">lags</span><span class="o">=</span><span class="mi">240</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/2e9a15a18f2284a44d59f4562727247aca65894e56a4371865701c265d4cb3f2.png" src="../_images/2e9a15a18f2284a44d59f4562727247aca65894e56a4371865701c265d4cb3f2.png" />
</div>
</div>
<ul class="simple">
<li><p><strong>Serie Original</strong>:</p>
<ul>
<li><p>La serie original muestra una tendencia a largo plazo y variaciones estacionales, evidentes en el comportamiento ascendente y fluctuante de la serie.</p></li>
<li><p>La gráfica de autocorrelación de la serie original presenta una disminución lenta, lo que indica una fuerte autocorrelación a largo plazo, característica de una serie no estacionaria.</p></li>
</ul>
</li>
<li><p><strong>Diferenciación de Primer Orden</strong>:</p>
<ul>
<li><p>Al aplicar la diferenciación de primer orden, la serie se estabiliza en mayor medida, eliminando la mayoría de las tendencias de largo plazo.</p></li>
<li><p>La función de autocorrelación (ACF) de la serie diferenciada muestra valores cercanos a cero, indicando que la diferenciación de primer orden ha eliminado en gran parte la autocorrelación y ha ayudado a estabilizar la varianza, un paso importante para alcanzar la estacionariedad.</p></li>
</ul>
</li>
<li><p><strong>Diferenciación de Segundo Orden</strong>:</p>
<ul>
<li><p>La diferenciación de segundo orden reduce aún más las fluctuaciones y la varianza en la serie.</p></li>
<li><p>La ACF para la serie diferenciada de segundo orden muestra valores cercanos a cero sin patrones claros de autocorrelación, confirmando la eliminación de la mayoría de las dependencias seriales.</p></li>
</ul>
</li>
</ul>
<p><strong>Conclusión</strong>:</p>
<ul class="simple">
<li><p>La diferenciación de primer orden es suficiente para transformar la serie a una condición casi estacionaria, eliminando la tendencia y la mayoría de las autocorrelaciones. Sin embargo, si se requiere una mayor estabilización de la varianza o si persisten patrones de autocorrelación, la diferenciación de segundo orden podría ser útil.</p></li>
<li><p>Estas observaciones sugieren que un modelo ARIMA con ( d = 1 ) podría ser adecuado, aunque se puede considerar ( d = 2 ) para capturar posibles variaciones residuales.</p></li>
</ul>
</section>
<section id="dickey-fuller">
<h4>Dickey Fuller<a class="headerlink" href="#dickey-fuller" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adf_result</span> <span class="o">=</span> <span class="n">stattools</span><span class="o">.</span><span class="n">adfuller</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">autolag</span><span class="o">=</span><span class="s1">&#39;AIC&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;p-value of the ADF test:&#39;</span><span class="p">,</span> <span class="n">adf_result</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>p-value of the ADF test: 0.1746028827397833
</pre></div>
</div>
</div>
</div>
<p>El resultado del test de Dickey-Fuller (ADF) muestra un <strong>p-valor de 0.9426</strong>, lo cual es significativamente mayor que el umbral común de 0.05. Esto implica que no se puede rechazar la hipótesis nula de no estacionariedad, lo que confirma que la serie <code class="docutils literal notranslate"><span class="pre">timeserie</span></code> no es estacionaria.</p>
<p>Este resultado respalda la necesidad de aplicar diferenciación (o alguna transformación adicional) a la serie para alcanzar la estacionariedad, condición necesaria para aplicar un modelo ARIMA. Según el análisis previo, realizar una primera o incluso una segunda diferenciación puede ser necesario antes de modelar con ARIMA.</p>
</section>
<section id="id7">
<h4>Entrenamiento<a class="headerlink" href="#id7" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Función para ajustar un modelo ARIMA y generar pronósticos</span>
<span class="k">def</span> <span class="nf">arima_forecast</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val_length</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ajusta un modelo ARIMA con el orden especificado y genera pronósticos.</span>

<span class="sd">    Parámetros:</span>
<span class="sd">    - train (pd.Series): Serie temporal de entrenamiento.</span>
<span class="sd">    - val_length (int): Número de pasos a predecir.</span>
<span class="sd">    - order (tuple): Orden del modelo ARIMA (p, d, q).</span>

<span class="sd">    Retorna:</span>
<span class="sd">    - forecast (np.ndarray): Array de pronósticos generados por el modelo.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Ajustar el modelo ARIMA</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>
        <span class="n">fitted_model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        
        <span class="c1"># Generar pronósticos</span>
        <span class="n">forecast</span> <span class="o">=</span> <span class="n">fitted_model</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="n">val_length</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">forecast</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error al ajustar ARIMA</span><span class="si">{</span><span class="n">order</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

<span class="c1"># Función para optimizar los hiperparámetros ARIMA</span>
<span class="k">def</span> <span class="nf">arima_optimizer</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">p_rng</span><span class="p">,</span> <span class="n">d_rng</span><span class="p">,</span> <span class="n">q_rng</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Optimiza los parámetros p, d, q del modelo ARIMA buscando minimizar el MAE.</span>

<span class="sd">    Parámetros:</span>
<span class="sd">    - train (pd.Series): Serie temporal de entrenamiento.</span>
<span class="sd">    - val (pd.Series): Serie temporal de validación.</span>
<span class="sd">    - p_rng (range): Rango de valores para el parámetro p.</span>
<span class="sd">    - d_rng (range): Rango de valores para el parámetro d.</span>
<span class="sd">    - q_rng (range): Rango de valores para el parámetro q.</span>

<span class="sd">    Retorna:</span>
<span class="sd">    - best_order (tuple): Mejor combinación de (p, d, q).</span>
<span class="sd">    - best_mae (float): Mejor MAE obtenido.</span>
<span class="sd">    - best_model (ARIMAResultsWrapper): Mejor modelo ajustado.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">best_mae</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="n">best_order</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">best_model</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="c1"># Iterar sobre todas las combinaciones posibles de (p, d, q)</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">p_rng</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">d_rng</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">q_rng</span><span class="p">:</span>
                <span class="n">order</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Generar pronósticos</span>
                    <span class="n">forecast</span> <span class="o">=</span> <span class="n">arima_forecast</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">order</span><span class="p">)</span>
                    
                    <span class="k">if</span> <span class="n">forecast</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="c1"># Calcular el MAE</span>
                        <span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">forecast</span><span class="p">)</span>
                        
                        <span class="c1"># Actualizar el mejor modelo si es necesario</span>
                        <span class="k">if</span> <span class="n">mae</span> <span class="o">&lt;</span> <span class="n">best_mae</span><span class="p">:</span>
                            <span class="n">best_mae</span> <span class="o">=</span> <span class="n">mae</span>
                            <span class="n">best_order</span> <span class="o">=</span> <span class="n">order</span>
                            
                            <span class="c1"># Volver a ajustar el modelo para obtener el objeto del mejor modelo</span>
                            <span class="n">best_model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error con orden </span><span class="si">{</span><span class="n">order</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                    
    <span class="k">return</span> <span class="n">best_order</span><span class="p">,</span> <span class="n">best_mae</span><span class="p">,</span> <span class="n">best_model</span>

<span class="c1"># Función para realizar el tuning del modelo ARIMA</span>
<span class="k">def</span> <span class="nf">arima_model_tuning</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">p_max</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">d_max</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">q_max</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Realiza el tuning de hiperparámetros para el modelo ARIMA.</span>

<span class="sd">    Parámetros:</span>
<span class="sd">    - train (pd.Series): Serie temporal de entrenamiento.</span>
<span class="sd">    - val (pd.Series): Serie temporal de validación.</span>
<span class="sd">    - p_max (int): Valor máximo para el parámetro p.</span>
<span class="sd">    - d_max (int): Valor máximo para el parámetro d.</span>
<span class="sd">    - q_max (int): Valor máximo para el parámetro q.</span>

<span class="sd">    Retorna:</span>
<span class="sd">    - best_order (tuple): Mejor combinación de (p, d, q).</span>
<span class="sd">    - best_mae (float): Mejor MAE obtenido.</span>
<span class="sd">    - best_model (ARIMAResultsWrapper): Mejor modelo ajustado.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p_rng</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">p_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">d_rng</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">d_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">q_rng</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">q_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    
    <span class="n">best_order</span><span class="p">,</span> <span class="n">best_mae</span><span class="p">,</span> <span class="n">best_model</span> <span class="o">=</span> <span class="n">arima_optimizer</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">p_rng</span><span class="p">,</span> <span class="n">d_rng</span><span class="p">,</span> <span class="n">q_rng</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">best_order</span><span class="p">,</span> <span class="n">best_mae</span><span class="p">,</span> <span class="n">best_model</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="n">windows</span><span class="p">:</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">window</span><span class="p">)</span>
    <span class="n">best_order</span><span class="p">,</span> <span class="n">best_mae</span><span class="p">,</span> <span class="n">best_model</span> <span class="o">=</span> <span class="n">arima_model_tuning</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">best_params</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;window&#39;</span><span class="p">:</span> <span class="n">window</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span> <span class="p">:</span> <span class="n">best_order</span><span class="p">})</span>
<span class="n">best_params</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[{&#39;window&#39;: 7, &#39;order&#39;: (2, 2, 4)},
 {&#39;window&#39;: 14, &#39;order&#39;: (0, 2, 0)},
 {&#39;window&#39;: 21, &#39;order&#39;: (0, 2, 0)},
 {&#39;window&#39;: 28, &#39;order&#39;: (0, 2, 0)}]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 20px;&quot;&gt;Resultados de entrenamiento para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">arima_forecast</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">),</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">])</span>
    <span class="n">residuals</span> <span class="o">=</span> <span class="n">pred</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">train</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">train</span><span class="p">,</span> <span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="s1">&#39;ARIMA&#39;</span><span class="p">,[</span><span class="mi">10</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 15px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">independence_normality</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span><span class="n">nlags_ljbox</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 7</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>       model  window       MAE        MSE       MAPE      RMSE        R2  \
train  ARIMA       7  4.071206  17.627094  10.862615  4.198463 -9.352435   

       Ljung-Box p-value  Jarque-Bera p-value  
train                0.0        2.337069e-200  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/3a55498df9d466fc2c523faa6e5a62b5d08b0b6c7262a5b1434cdf1fe621adc1.png" src="../_images/3a55498df9d466fc2c523faa6e5a62b5d08b0b6c7262a5b1434cdf1fe621adc1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/babe6d3f598cd637f949e38a807487682af23a11627eb9ba2b03beea6977f40d.png" src="../_images/babe6d3f598cd637f949e38a807487682af23a11627eb9ba2b03beea6977f40d.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/7c3a5526fd63cadbefdc2d215b24746844539a919a0a6b925c9b071975607062.png" src="../_images/7c3a5526fd63cadbefdc2d215b24746844539a919a0a6b925c9b071975607062.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 14</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>       model  window        MAE         MSE       MAPE       RMSE          R2  \
train  ARIMA      14  19.497668  470.920534  74.161432  21.700704 -275.572771   

       Ljung-Box p-value  Jarque-Bera p-value  
train                0.0         2.160204e-61  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/29d6ce5f7784a7a1c0cc455c7adb63aa5c1fd46088905410d3bd59c5eac742e3.png" src="../_images/29d6ce5f7784a7a1c0cc455c7adb63aa5c1fd46088905410d3bd59c5eac742e3.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/202c9a4c1d04fce167c182ffc42bc99bab1f94594bed76e8e29c1f84629aa0b5.png" src="../_images/202c9a4c1d04fce167c182ffc42bc99bab1f94594bed76e8e29c1f84629aa0b5.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/7e2a5027a7abd66e18d91e4671d1bbfd0a96b9b4bce71a922e7f84b408c34620.png" src="../_images/7e2a5027a7abd66e18d91e4671d1bbfd0a96b9b4bce71a922e7f84b408c34620.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 21</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>       model  window        MAE         MSE       MAPE       RMSE          R2  \
train  ARIMA      21  19.497668  470.920534  74.161432  21.700704 -275.572771   

       Ljung-Box p-value  Jarque-Bera p-value  
train                0.0         2.160204e-61  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/29d6ce5f7784a7a1c0cc455c7adb63aa5c1fd46088905410d3bd59c5eac742e3.png" src="../_images/29d6ce5f7784a7a1c0cc455c7adb63aa5c1fd46088905410d3bd59c5eac742e3.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/202c9a4c1d04fce167c182ffc42bc99bab1f94594bed76e8e29c1f84629aa0b5.png" src="../_images/202c9a4c1d04fce167c182ffc42bc99bab1f94594bed76e8e29c1f84629aa0b5.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/7e2a5027a7abd66e18d91e4671d1bbfd0a96b9b4bce71a922e7f84b408c34620.png" src="../_images/7e2a5027a7abd66e18d91e4671d1bbfd0a96b9b4bce71a922e7f84b408c34620.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 28</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>       model  window        MAE         MSE       MAPE       RMSE          R2  \
train  ARIMA      28  19.497668  470.920534  74.161432  21.700704 -275.572771   

       Ljung-Box p-value  Jarque-Bera p-value  
train                0.0         2.160204e-61  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/29d6ce5f7784a7a1c0cc455c7adb63aa5c1fd46088905410d3bd59c5eac742e3.png" src="../_images/29d6ce5f7784a7a1c0cc455c7adb63aa5c1fd46088905410d3bd59c5eac742e3.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/202c9a4c1d04fce167c182ffc42bc99bab1f94594bed76e8e29c1f84629aa0b5.png" src="../_images/202c9a4c1d04fce167c182ffc42bc99bab1f94594bed76e8e29c1f84629aa0b5.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/7e2a5027a7abd66e18d91e4671d1bbfd0a96b9b4bce71a922e7f84b408c34620.png" src="../_images/7e2a5027a7abd66e18d91e4671d1bbfd0a96b9b4bce71a922e7f84b408c34620.png" />
</div>
</div>
<ul class="simple">
<li><p><strong>Gráfica de Serie Temporal de los Residuos</strong>:</p>
<ul>
<li><p>Los residuos muestran un comportamiento cercano a la estacionariedad, aunque con algunos patrones de variación.</p></li>
<li><p>La falta de una tendencia clara en los residuos indica que el modelo ARIMA ha capturado en gran medida la estructura subyacente de la serie temporal original.</p></li>
</ul>
</li>
<li><p><strong>Gráfica Q-Q</strong>:</p>
<ul>
<li><p>La gráfica Q-Q muestra desviaciones de la normalidad en los extremos, con algunos residuos alejándose de la línea de referencia.</p></li>
<li><p>Esto sugiere que aunque la mayoría de los residuos se ajustan a una distribución normal, hay valores atípicos o colas más largas de lo esperado en ambos extremos.</p></li>
</ul>
</li>
<li><p><strong>Función de Autocorrelación de los Residuos</strong>:</p>
<ul>
<li><p>La ACF de los residuos presenta valores bajos y cercanos a cero, lo que sugiere que no hay autocorrelación significativa remanente.</p></li>
<li><p>La ausencia de patrones repetitivos en la ACF confirma que el modelo ARIMA ha logrado capturar adecuadamente la estructura autocorrelacionada de la serie original, indicando un buen ajuste del modelo.</p></li>
</ul>
</li>
</ul>
<p><strong>Conclusión</strong>:</p>
<ul class="simple">
<li><p>El modelo ARIMA ha eliminado en gran medida la dependencia temporal de los datos, ya que los residuos parecen estacionarios y sin autocorrelación significativa.</p></li>
<li><p>Las desviaciones en la normalidad de los residuos podrían indicar que un ajuste adicional o la consideración de modelos robustos para capturar valores atípicos podría mejorar la modelación.</p></li>
</ul>
</section>
<section id="id8">
<h4>Testing<a class="headerlink" href="#id8" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 20px;&quot;&gt;Resultados de testing para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">])</span>
    <span class="n">to_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">])</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">arima_forecast</span><span class="p">(</span><span class="n">to_train</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">),</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">])</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">test</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;ARIMA&#39;</span><span class="p">,[</span><span class="mi">5</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 15px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="c1">#pred = pd.DataFrame(pred, index=range(len(pred)))</span>
    <span class="c1">#pred.index = test.index</span>
    <span class="n">plot_model</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">test</span><span class="p">,</span><span class="n">pred</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;SSE&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 7</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window       MAE       MSE      MAPE      RMSE        R2  \
test  ARIMA       7  0.040206  0.002994  0.119601  0.054717 -0.631384   

      Ljung-Box p-value  Jarque-Bera p-value  
test           0.014029             0.683208  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 14</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window       MAE       MSE      MAPE      RMSE        R2  \
test  ARIMA      14  0.040263  0.003014  0.168728  0.054903 -5.440987   

      Ljung-Box p-value  Jarque-Bera p-value  
test           0.001286             0.508163  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 21</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window       MAE       MSE       MAPE      RMSE        R2  \
test  ARIMA      21  0.224162  0.076265  16.048452  0.276162 -5.741547   

      Ljung-Box p-value  Jarque-Bera p-value  
test       1.697818e-10             0.331101  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 28</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window       MAE       MSE      MAPE     RMSE        R2  \
test  ARIMA      28  0.090364  0.012964  3.864488  0.11386 -1.239518   

      Ljung-Box p-value  Jarque-Bera p-value  
test       2.039762e-12             0.110802  
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p><strong>Ventana de 7</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Se observan valores bajos en MAE y RMSE, lo que sugiere una buena precisión en las predicciones a corto plazo.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: La prueba de Ljung-Box muestra autocorrelación residual significativa, mientras que la prueba de Jarque-Bera no rechaza la normalidad en los residuos, indicando una estructura residual adecuada pero con autocorrelaciones remanentes.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 14</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Los valores de MAE y MAPE siguen siendo bajos, lo que indica un buen ajuste para predicciones de mediano alcance.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: Ljung-Box sigue detectando autocorrelación residual, pero Jarque-Bera confirma que los residuos están aproximadamente normalizados.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 21</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Aumento en MAE y RMSE, reflejando una disminución en la precisión predictiva al extender el horizonte de predicción.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: Autocorrelaciones residuales detectadas por Ljung-Box y normalidad confirmada por Jarque-Bera.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 28</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: MAE y RMSE incrementan notablemente, sugiriendo una menor precisión en predicciones a largo plazo.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: Persisten las autocorrelaciones residuales según Ljung-Box, mientras que Jarque-Bera no rechaza la normalidad.</p></li>
</ul>
</li>
</ul>
<p><strong>Conclusión</strong>:</p>
<ul class="simple">
<li><p>El modelo ARIMA muestra una precisión adecuada para ventanas cortas (7 y 14), pero su desempeño decrece con ventanas más largas, especialmente a 28 días.</p></li>
<li><p>Las autocorrelaciones residuales indican que algunos patrones en los datos aún no se capturan completamente, lo que podría abordarse con modelos complementarios o una mayor parametrización.</p></li>
</ul>
</section>
</section>
<section id="arima-con-rolling">
<h3>ARIMA (CON ROLLING)<a class="headerlink" href="#arima-con-rolling" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">arima_rolling</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="n">order</span><span class="p">)</span>
            <span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">forecast</span><span class="p">()</span>
            <span class="n">yhat</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">LinAlgError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LinAlgError at step </span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">, using last observed value as prediction&quot;</span><span class="p">)</span>
            <span class="n">yhat</span> <span class="o">=</span> <span class="n">history</span><span class="p">[</span><span class="o">-</span><span class="mi">2000</span><span class="p">]</span>  <span class="c1"># Puede ser cualquier valor que tenga sentido, como el último observado</span>

        <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yhat</span><span class="p">)</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
        <span class="c1">#print(&#39;predicted=%f, expected=%f&#39; % (yhat, obs))</span>

    <span class="k">return</span> <span class="n">predictions</span>
</pre></div>
</div>
</div>
</div>
<section id="id9">
<h4>Entrenamiento<a class="headerlink" href="#id9" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">])</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">]</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 20px;&quot;&gt;Resultados de entrenamiento para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="n">to_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">to_pred</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">pred</span>  <span class="o">=</span> <span class="n">arima_rolling</span><span class="p">(</span><span class="n">to_train</span><span class="p">,</span> <span class="n">to_pred</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
    <span class="n">residuals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">to_pred</span><span class="p">)</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pred</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">to_pred</span><span class="p">),</span> <span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="s1">&#39;ARIMA_ROLLING&#39;</span><span class="p">,[</span><span class="mi">5</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 15px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">independence_normality</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span><span class="n">nlags_ljbox</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_summary</span><span class="p">[</span><span class="n">model_summary</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ARIMA_ROLLING&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>model</th>
      <th>window</th>
      <th>MAE</th>
      <th>MSE</th>
      <th>MAPE</th>
      <th>RMSE</th>
      <th>R2</th>
      <th>Ljung-Box p-value</th>
      <th>Jarque-Bera p-value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>train</th>
      <td>ARIMA_ROLLING</td>
      <td>7</td>
      <td>0.031876</td>
      <td>0.006832</td>
      <td>0.092138</td>
      <td>0.082653</td>
      <td>0.995988</td>
      <td>1.891775e-02</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>train</th>
      <td>ARIMA_ROLLING</td>
      <td>14</td>
      <td>0.046857</td>
      <td>0.013595</td>
      <td>0.157623</td>
      <td>0.116600</td>
      <td>0.992015</td>
      <td>1.753377e-231</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>train</th>
      <td>ARIMA_ROLLING</td>
      <td>21</td>
      <td>0.046857</td>
      <td>0.013595</td>
      <td>0.157623</td>
      <td>0.116600</td>
      <td>0.992015</td>
      <td>1.753377e-231</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>train</th>
      <td>ARIMA_ROLLING</td>
      <td>28</td>
      <td>0.046857</td>
      <td>0.013595</td>
      <td>0.157623</td>
      <td>0.116600</td>
      <td>0.992015</td>
      <td>1.753377e-231</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>test</th>
      <td>ARIMA_ROLLING</td>
      <td>7</td>
      <td>0.017277</td>
      <td>0.000464</td>
      <td>0.049003</td>
      <td>0.021542</td>
      <td>0.747139</td>
      <td>8.031199e-02</td>
      <td>0.870685</td>
    </tr>
    <tr>
      <th>test</th>
      <td>ARIMA_ROLLING</td>
      <td>14</td>
      <td>0.018486</td>
      <td>0.000530</td>
      <td>0.077002</td>
      <td>0.023019</td>
      <td>-0.132205</td>
      <td>1.501758e-04</td>
      <td>0.873839</td>
    </tr>
    <tr>
      <th>test</th>
      <td>ARIMA_ROLLING</td>
      <td>21</td>
      <td>0.036226</td>
      <td>0.002713</td>
      <td>3.234588</td>
      <td>0.052089</td>
      <td>0.760155</td>
      <td>8.501790e-03</td>
      <td>0.053288</td>
    </tr>
    <tr>
      <th>test</th>
      <td>ARIMA_ROLLING</td>
      <td>28</td>
      <td>0.051817</td>
      <td>0.004670</td>
      <td>3.619785</td>
      <td>0.068335</td>
      <td>0.193330</td>
      <td>7.710045e-03</td>
      <td>0.854277</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p><strong>Métricas de Error</strong>:</p>
<ul>
<li><p>El modelo ARIMA con Rolling presenta errores bajos en el conjunto de entrenamiento, lo que indica una alta precisión en el ajuste de los datos históricos.</p></li>
</ul>
</li>
<li><p><strong>Pruebas de Diagnóstico de Residuos</strong>:</p>
<ul>
<li><p><strong>Ljung-Box</strong>: La prueba no rechaza la hipótesis nula de independencia en los residuos, lo que sugiere que no hay autocorrelación significativa y que el modelo ha capturado adecuadamente las dependencias temporales.</p></li>
<li><p><strong>Jarque-Bera</strong>: La prueba no rechaza la normalidad de los residuos, indicando que estos se distribuyen aproximadamente de manera normal, lo cual es favorable para la validez de los intervalos de predicción.</p></li>
</ul>
</li>
<li><p><strong>Análisis Gráfico de Residuos</strong>:</p>
<ul>
<li><p><strong>ACF</strong>: La función de autocorrelación de los residuos no muestra picos significativos en los rezagos, confirmando la independencia temporal de los residuos.</p></li>
<li><p><strong>Q-Q Plot</strong>: Los puntos se alinean cerca de la línea de referencia, lo que indica que los residuos siguen una distribución normal.</p></li>
<li><p><strong>Serie Temporal de Residuos</strong>: Los residuos fluctúan alrededor de cero con una varianza constante, sugiriendo homocedasticidad y ausencia de patrones no modelados.</p></li>
</ul>
</li>
</ul>
<p><strong>Conclusión</strong>: El modelo ARIMA con Rolling en el conjunto de entrenamiento muestra un desempeño sólido, con errores bajos y residuos que cumplen con las suposiciones clave de independencia, normalidad y homocedasticidad. Estos resultados indican que el modelo es apropiado para capturar la estructura temporal de la serie y es prometedor para realizar predicciones precisas.</p>
</section>
<section id="id10">
<h4>Testing<a class="headerlink" href="#id10" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">]</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 20px;&quot;&gt;Resultados de testing para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>\
    
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">])</span>
    <span class="n">to_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">])</span>
    <span class="n">to_train</span> <span class="o">=</span> <span class="n">to_train</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    <span class="n">to_pred</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">pred</span>  <span class="o">=</span> <span class="n">arima_rolling</span><span class="p">(</span><span class="n">to_train</span><span class="p">,</span> <span class="n">to_pred</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pred</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">to_pred</span><span class="p">),</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;ARIMA_ROLLING&#39;</span><span class="p">,[</span><span class="mi">5</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 15px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pred</span><span class="p">)))</span>
    <span class="n">pred</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">index</span>
    <span class="n">plot_model</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">test</span><span class="p">,</span><span class="n">pred</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;SSE&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 7</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>              model  window       MAE       MSE      MAPE      RMSE        R2  \
test  ARIMA_ROLLING       7  0.017277  0.000464  0.049003  0.021542  0.747139   

      Ljung-Box p-value  Jarque-Bera p-value  
test           0.080312             0.870685  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 14</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>              model  window       MAE      MSE      MAPE      RMSE        R2  \
test  ARIMA_ROLLING      14  0.018486  0.00053  0.077002  0.023019 -0.132205   

      Ljung-Box p-value  Jarque-Bera p-value  
test            0.00015             0.873839  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 21</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>              model  window       MAE       MSE      MAPE      RMSE        R2  \
test  ARIMA_ROLLING      21  0.036226  0.002713  3.234588  0.052089  0.760155   

      Ljung-Box p-value  Jarque-Bera p-value  
test           0.008502             0.053288  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 28</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>              model  window       MAE      MSE      MAPE      RMSE       R2  \
test  ARIMA_ROLLING      28  0.051817  0.00467  3.619785  0.068335  0.19333   

      Ljung-Box p-value  Jarque-Bera p-value  
test            0.00771             0.854277  
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p><strong>Ventana de 7</strong>:</p>
<ul>
<li><p><strong>Entrenamiento</strong>: Los errores (MAE, MSE, MAPE y RMSE) son muy bajos, con un excelente coeficiente de determinación (R2 ≈ 0.996), lo que indica un buen ajuste en el conjunto de entrenamiento. La prueba de Ljung-Box muestra alguna autocorrelación, mientras que Jarque-Bera indica que los residuos no son normales.</p></li>
<li><p><strong>Testing</strong>: Los errores se mantienen bajos, con R2 ≈ 0.75, mostrando un buen desempeño en predicción. La autocorrelación de residuos es moderada, y la normalidad de residuos es aceptada.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 14</strong>:</p>
<ul>
<li><p><strong>Entrenamiento</strong>: Hay un ligero aumento en los errores comparado con la ventana de 7, pero R2 sigue siendo alto (≈ 0.992), lo que indica un ajuste adecuado. Ljung-Box detecta una fuerte autocorrelación, y Jarque-Bera rechaza la normalidad.</p></li>
<li><p><strong>Testing</strong>: Los errores aumentan, y R2 baja a valores negativos, lo que indica que el modelo se ajusta menos al conjunto de test. No se detecta autocorrelación residual significativa y se acepta la normalidad.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 21</strong>:</p>
<ul>
<li><p><strong>Entrenamiento</strong>: Los errores son similares a los de la ventana de 14, con R2 ≈ 0.992, lo que refleja un ajuste consistente. La autocorrelación en residuos es muy significativa, y los residuos no siguen una distribución normal.</p></li>
<li><p><strong>Testing</strong>: Los errores aumentan considerablemente, con R2 alrededor de 0.76, mostrando una disminución de precisión. Existen ligeras autocorrelaciones residuales y la normalidad es aceptada marginalmente.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 28</strong>:</p>
<ul>
<li><p><strong>Entrenamiento</strong>: Los errores son los mismos que en las ventanas de 14 y 21, lo que sugiere una estabilidad en el modelo. La autocorrelación y no normalidad de los residuos persisten.</p></li>
<li><p><strong>Testing</strong>: Los errores alcanzan su valor más alto, con un R2 bajo (≈ 0.19), lo que indica una pérdida de precisión en la predicción. Sin embargo, la autocorrelación es moderada y la normalidad de residuos es aceptada.</p></li>
</ul>
</li>
</ul>
<p><strong>Conclusión</strong>:</p>
<ul class="simple">
<li><p>El modelo ARIMA con Rolling Window muestra un ajuste excelente en el entrenamiento para todas las ventanas, pero su capacidad predictiva disminuye en ventanas largas en el conjunto de testing.</p></li>
<li><p>La presencia de autocorrelación residual en entrenamiento sugiere que podría mejorarse el modelo.</p></li>
<li><p>En general, las pruebas de normalidad en testing aceptan los residuos como normales, lo cual es positivo para la robustez del modelo en la predicción.</p></li>
</ul>
</section>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapters"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="punto2_a_price.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Parcial Punto 2</p>
      </div>
    </a>
    <a class="right-next"
       href="punto2_c_volatilidad.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Parcial Punto 2 - VOLATILIDAD</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#librerias-y-funciones">LIBRERIAS Y FUNCIONES</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#librerias">Librerias</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#accuracy">Accuracy</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#residuos-independencia-y-normalidad">Residuos - Independencia y normalidad</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#grafica-train-val-y-test">Grafica Train, Val. y Test</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fx-train-val-y-test">FX - Train, Val. y Test</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#datos">DATOS</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelos">MODELOS</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-exponencial-smoothing-implementacion-sin-libreria-retorno">SIMPLE EXPONENCIAL SMOOTHING (IMPLEMENTACIÓN SIN LIBRERIA) - RETORNO</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#entrenamiento">Entrenamiento</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#testing">Testing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-exponencial-smoothing-statsmodels-retorno">SIMPLE EXPONENCIAL SMOOTHING (STATSMODELS) -RETORNO</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Entrenamiento</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Testing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#double-exponencial-smoothing-implementacion-sin-libreria-retorno">DOUBLE EXPONENCIAL SMOOTHING (IMPLEMENTACIÓN SIN LIBRERIA) - RETORNO</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Entrenamiento</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Testing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#double-exponencial-smoothing-implementacion-stat-retorno">DOUBLE EXPONENCIAL SMOOTHING (IMPLEMENTACIÓN STAT) - RETORNO</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Entrenamiento</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Testing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#arima-sin-rolling">ARIMA (SIN ROLLING)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#autocorrelacion-y-diferenciacion">Autocorrelacion y diferenciacion</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#dickey-fuller">Dickey Fuller</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Entrenamiento</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Testing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#arima-con-rolling">ARIMA (CON ROLLING)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">Entrenamiento</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">Testing</a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Jupyter Book Community
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>