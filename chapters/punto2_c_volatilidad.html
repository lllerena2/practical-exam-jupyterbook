
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Parcial Punto 2 - VOLATILIDAD &#8212; My sample book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapters/punto2_c_volatilidad';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="IMPLEMENTACION GARCH PARA VOLATILIDAD" href="punto2_d_garch.html" />
    <link rel="prev" title="Parcial Punto 2 - RETORNO" href="punto2_b_retorno.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="My sample book - Home"/>
    <img src="../_static/logo.png" class="logo__image only-dark pst-js-only" alt="My sample book - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome to your Jupyter Book
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../markdown.html">Markdown Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="punto2_a_price.html">Parcial Punto 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="punto2_b_retorno.html">Parcial Punto 2 - RETORNO</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Parcial Punto 2 - VOLATILIDAD</a></li>
<li class="toctree-l1"><a class="reference internal" href="punto2_d_garch.html">IMPLEMENTACION GARCH PARA VOLATILIDAD</a></li>
<li class="toctree-l1"><a class="reference internal" href="deeplearning.html">Modelos de Deep Learning</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fchapters/punto2_c_volatilidad.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/chapters/punto2_c_volatilidad.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Parcial Punto 2 - VOLATILIDAD</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#librerias-y-funciones">LIBRERIAS Y FUNCIONES</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#librerias">Librerias</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#accuracy">Accuracy</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#residuos-independencia-y-normalidad">Residuos - Independencia y normalidad</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#grafica-train-val-y-test">Grafica Train, Val. y Test</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fx-train-val-y-test">FX - Train, Val. y Test</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#datos">DATOS</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelos">MODELOS</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-exponencial-smoothing-implementacion-sin-libreria-volatilidad">SIMPLE EXPONENCIAL SMOOTHING (IMPLEMENTACIÓN SIN LIBRERIA) - VOLATILIDAD</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#entrenamiento">Entrenamiento</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#testing">Testing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-exponencial-smoothing-statsmodels-volatilidad">SIMPLE EXPONENCIAL SMOOTHING (STATSMODELS) -VOLATILIDAD</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Entrenamiento</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Testing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#double-exponencial-smoothing-implementacion-sin-libreria-volatilidad">DOUBLE EXPONENCIAL SMOOTHING (IMPLEMENTACIÓN SIN LIBRERIA) - VOLATILIDAD</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Entrenamiento</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Testing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#double-exponencial-smoothing-implementacion-stat-volatilidad">DOUBLE EXPONENCIAL SMOOTHING (IMPLEMENTACIÓN STAT) - VOLATILIDAD</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Entrenamiento</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Testing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#arima-sin-rolling">ARIMA (SIN ROLLING)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#autocorrelacion-y-diferenciacion">Autocorrelacion y diferenciacion</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#dickey-fuller">Dickey Fuller</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Entrenamiento</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Testing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#arima-con-rolling">ARIMA (CON ROLLING)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">Entrenamiento</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">Testing</a></li>
</ul>
</li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="parcial-punto-2-volatilidad">
<h1>Parcial Punto 2 - VOLATILIDAD<a class="headerlink" href="#parcial-punto-2-volatilidad" title="Link to this heading">#</a></h1>
<p>Este Jupyter Book resume los modelos estadisticos solicitados para las diferentes ventanas de tiempo de predición para la serie de tiempo Bitcoin Volatilidad. Los modelos de Garch serán revisados con la serie de tiempo de volatilidad, pues este es uso.</p>
<section id="librerias-y-funciones">
<h2>LIBRERIAS Y FUNCIONES<a class="headerlink" href="#librerias-y-funciones" title="Link to this heading">#</a></h2>
<section id="librerias">
<h3>Librerias<a class="headerlink" href="#librerias" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa</span> <span class="kn">import</span> <span class="n">stattools</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.stattools</span> <span class="kn">import</span> <span class="n">jarque_bera</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
<span class="kn">from</span> <span class="nn">pandas.plotting</span> <span class="kn">import</span> <span class="n">autocorrelation_plot</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.holtwinters</span> <span class="kn">import</span> <span class="n">SimpleExpSmoothing</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.holtwinters</span> <span class="kn">import</span> <span class="n">ExponentialSmoothing</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_percentage_error</span><span class="p">,</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>  <span class="c1"># Para mostrar una barra de progreso</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.arima.model</span> <span class="kn">import</span> <span class="n">ARIMA</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.diagnostic</span> <span class="kn">import</span> <span class="n">acorr_ljungbox</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.holtwinters</span> <span class="kn">import</span> <span class="n">Holt</span>
<span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="kn">import</span> <span class="n">plot_predict</span><span class="p">,</span> <span class="n">plot_acf</span>

<span class="c1">#Formato y colores</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">8</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="ne">----&gt; </span><span class="mi">8</span> <span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="kn">from</span> <span class="nn">statsmodels.tsa</span> <span class="kn">import</span> <span class="n">stattools</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="kn">from</span> <span class="nn">statsmodels.stats.stattools</span> <span class="kn">import</span> <span class="n">jarque_bera</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;plotly&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="accuracy">
<h3>Accuracy<a class="headerlink" href="#accuracy" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">forecast_accuracy</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">actual</span><span class="p">,</span> <span class="n">str_name</span><span class="p">,</span> <span class="n">str_model</span><span class="p">,</span> <span class="n">lj_lags</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">window_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="n">mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">actual</span><span class="p">))</span>    <span class="c1"># MAPE</span>
    <span class="n">mae</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">))</span>                      <span class="c1"># MAE</span>
    <span class="n">mse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">actual</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>                       <span class="c1"># MSE</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mse</span><span class="p">)</span>                                           <span class="c1"># RMSE</span>

    <span class="c1"># Cálculo del R²</span>
    <span class="n">ss_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">actual</span> <span class="o">-</span> <span class="n">forecast</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">ss_tot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">actual</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">actual</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">ss_res</span> <span class="o">/</span> <span class="n">ss_tot</span><span class="p">)</span>

    <span class="c1"># Cálculo de los residuales</span>
    <span class="n">residuals</span> <span class="o">=</span> <span class="n">actual</span> <span class="o">-</span> <span class="n">forecast</span>

    <span class="c1"># Prueba de Ljung-Box</span>
    <span class="n">lb_test</span> <span class="o">=</span> <span class="n">acorr_ljungbox</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="n">lj_lags</span><span class="p">,</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">lb_pvalue</span> <span class="o">=</span> <span class="n">lb_test</span><span class="p">[</span><span class="s1">&#39;lb_pvalue&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># p-valor en el lag máximo especificado (10 en este caso)</span>

    <span class="c1"># Prueba de Jarque-Bera</span>
    <span class="n">jb_stat</span><span class="p">,</span> <span class="n">jb_pvalue</span><span class="p">,</span> <span class="n">skew</span><span class="p">,</span> <span class="n">kurtosis</span> <span class="o">=</span> <span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span>

    <span class="n">df_acc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">str_model</span><span class="p">,</span>
        <span class="s1">&#39;window&#39;</span><span class="p">:</span> <span class="n">window_str</span><span class="p">,</span>
        <span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mae</span><span class="p">],</span>
        <span class="s1">&#39;MSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mse</span><span class="p">],</span>
        <span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mape</span><span class="p">],</span>
        <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmse</span><span class="p">],</span>
        <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">r2</span><span class="p">],</span>
        <span class="s1">&#39;Ljung-Box p-value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">lb_pvalue</span><span class="p">],</span>
        <span class="s1">&#39;Jarque-Bera p-value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">jb_pvalue</span><span class="p">]</span>
    <span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">str_name</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">df_acc</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="residuos-independencia-y-normalidad">
<h3>Residuos - Independencia y normalidad<a class="headerlink" href="#residuos-independencia-y-normalidad" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">independence_normality</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">nlags_ljbox</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----- Test de Independencia  Ljung-Box --------&#39;</span><span class="p">)</span>
  
    <span class="c1"># Ho: no hay autocorrelación en los residuos</span>
    <span class="n">acf_</span><span class="p">,</span> <span class="n">confint_</span><span class="p">,</span> <span class="n">qstat_</span><span class="p">,</span> <span class="n">pvalues_</span> <span class="o">=</span> <span class="n">stattools</span><span class="o">.</span><span class="n">acf</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">nlags</span><span class="o">=</span><span class="n">nlags_ljbox</span><span class="p">,</span> <span class="n">qstat</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.05</span>
  
    <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">p_val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pvalues_</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">p_val</span> <span class="o">&gt;</span> <span class="n">alpha</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Null hypothesis is accepted at lag = </span><span class="si">{}</span><span class="s1"> for p-val = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">p_val</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Null hypothesis is rejected at lag = </span><span class="si">{}</span><span class="s1"> for p-val = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">p_val</span><span class="p">))</span>
  
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----- Test de Normalidad  Jarque-Bera --------&#39;</span><span class="p">)</span>

    <span class="c1"># Jarque-Bera</span>
    <span class="c1"># Ho: los residuos tienen distribución normal</span>
    <span class="n">JB</span><span class="p">,</span> <span class="n">JBpv</span><span class="p">,</span> <span class="n">skew</span><span class="p">,</span> <span class="n">kurtosis</span> <span class="o">=</span> <span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">JBpv</span> <span class="o">&gt;</span> <span class="n">alpha</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Null hypothesis is accepted, residuos normales&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Null hypothesis is rejected, residuos no normales&#39;</span><span class="p">)</span>

    <span class="c1"># Gráfico de la serie temporal de los residuos</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----- Grafico de serie de residuos --------&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Residuos&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Serie Temporal de los Residuos&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Fecha&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Residuos&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Q-Q Plot</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----- QQ Plot --------&#39;</span><span class="p">)</span>
    <span class="n">qq</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">probplot</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="s2">&quot;norm&quot;</span><span class="p">)</span>
    <span class="n">teoricos</span> <span class="o">=</span> <span class="n">qq</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Cuantiles teóricos</span>
    <span class="n">observados</span> <span class="o">=</span> <span class="n">qq</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Cuantiles observados (residuos)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">teoricos</span><span class="p">,</span> <span class="n">observados</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Observados&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">teoricos</span><span class="p">,</span> <span class="n">teoricos</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;firebrick&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Línea de referencia&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Q-Q Plot de los Residuos&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Teóricos&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Observados&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----- ACF de Residuos --------&#39;</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">5.5</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;ACF of Residuals&#39;</span><span class="p">)</span>
    <span class="n">autocorrelation_plot</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>  <span class="c1"># Asegura que se renderice al instante</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="grafica-train-val-y-test">
<h3>Grafica Train, Val. y Test<a class="headerlink" href="#grafica-train-val-y-test" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_model</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
    <span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span>

    <span class="c1"># Prepare the data</span>
    <span class="n">train_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;Time&#39;</span><span class="p">:</span> <span class="n">train</span><span class="p">[</span><span class="o">-</span><span class="mi">300</span><span class="p">:]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
        <span class="s1">&#39;Value&#39;</span><span class="p">:</span> <span class="n">train</span><span class="p">[</span><span class="o">-</span><span class="mi">300</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
        <span class="s1">&#39;Category&#39;</span><span class="p">:</span> <span class="s1">&#39;Train&#39;</span>
    <span class="p">})</span>
    <span class="n">val_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;Time&#39;</span><span class="p">:</span> <span class="n">val</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
        <span class="s1">&#39;Value&#39;</span><span class="p">:</span> <span class="n">val</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
        <span class="s1">&#39;Category&#39;</span><span class="p">:</span> <span class="s1">&#39;Validation&#39;</span>
    <span class="p">})</span>
    <span class="n">test_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;Time&#39;</span><span class="p">:</span> <span class="n">test</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
        <span class="s1">&#39;Value&#39;</span><span class="p">:</span> <span class="n">test</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
        <span class="s1">&#39;Category&#39;</span><span class="p">:</span> <span class="s1">&#39;Test&#39;</span>
    <span class="p">})</span>
    <span class="n">y_pred_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;Time&#39;</span><span class="p">:</span> <span class="n">y_pred</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
        <span class="s1">&#39;Value&#39;</span><span class="p">:</span> <span class="n">y_pred</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
        <span class="s1">&#39;Category&#39;</span><span class="p">:</span> <span class="s1">&#39;Prediction&#39;</span>
    <span class="p">})</span>

    <span class="c1"># Combine the data</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train_df</span><span class="p">,</span> <span class="n">val_df</span><span class="p">,</span> <span class="n">test_df</span><span class="p">,</span> <span class="n">y_pred_df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Add line dash style</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Dash&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Category&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span>
        <span class="s1">&#39;Train&#39;</span><span class="p">:</span> <span class="s1">&#39;solid&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Validation&#39;</span><span class="p">:</span> <span class="s1">&#39;solid&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Test&#39;</span><span class="p">:</span> <span class="s1">&#39;solid&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Prediction&#39;</span><span class="p">:</span> <span class="s1">&#39;dash&#39;</span>
    <span class="p">})</span>

    <span class="c1"># Compute MAE</span>
    <span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

    <span class="c1"># Plot using Plotly Express</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
        <span class="n">df</span><span class="p">,</span>
        <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;Category&#39;</span><span class="p">,</span>
        <span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;Dash&#39;</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">, MAE: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">mae</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">color_discrete_map</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;Train&#39;</span><span class="p">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Validation&#39;</span><span class="p">:</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Test&#39;</span><span class="p">:</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Prediction&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">xaxis_title</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span>
        <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span>
        <span class="n">legend_title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="n">template</span><span class="o">=</span><span class="s1">&#39;plotly_white&#39;</span>
    <span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="fx-train-val-y-test">
<h3>FX - Train, Val. y Test<a class="headerlink" href="#fx-train-val-y-test" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">train_val_test</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">window</span><span class="p">):</span>
  <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
  <span class="n">train_len</span> <span class="o">=</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">56</span> <span class="c1"># El profesor indicó que este siempre era el tamano del training (28+28)</span>
  <span class="n">val_set_end</span> <span class="o">=</span> <span class="n">train_len</span> <span class="o">+</span> <span class="n">window</span>
  <span class="n">test_set_end</span> <span class="o">=</span> <span class="n">val_set_end</span> <span class="o">+</span> <span class="n">window</span>
  

  <span class="n">train_set</span> <span class="o">=</span> <span class="n">df</span><span class="p">[:</span><span class="n">train_len</span><span class="p">]</span>
  <span class="n">val_set</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">train_len</span><span class="p">:</span> <span class="n">val_set_end</span><span class="p">]</span>
  <span class="n">test_set</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">val_set_end</span><span class="p">:</span> <span class="n">test_set_end</span><span class="p">]</span>

  <span class="k">return</span> <span class="n">train_set</span><span class="p">,</span> <span class="n">val_set</span><span class="p">,</span> <span class="n">test_set</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="datos">
<h2>DATOS<a class="headerlink" href="#datos" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Implemementacion de retorno</span>
<span class="c1"># retorno acumulado</span>
<span class="k">def</span> <span class="nf">retorno_acumulado</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">columna</span><span class="p">):</span>
    <span class="n">retorno_diario</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">columna</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="n">columna</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">retorno_diario</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">volatilidad</span><span class="p">(</span><span class="n">retorno_acum</span><span class="p">,</span> <span class="n">ventana</span><span class="p">):</span>
    <span class="n">std_w</span> <span class="o">=</span> <span class="n">retorno_acum</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">ventana</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">std_w</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Data Original</span>
<span class="n">data_init</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/lihkir/Data/refs/heads/main/Bitcoin%20Historical%20Data.csv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
<span class="c1"># Se crea una copia de la data para manipulación</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">data_init</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="c1"># Solo nos quedamos con las columnas Date y Price</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Price&#39;</span><span class="p">]]</span>

<span class="c1"># Se elimina las comas de Price para poder convertirlo a números</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="c1">#Convertimos las columnas price en números y date en fecha</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Price&#39;</span><span class="p">])</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">])</span>

<span class="c1">#Creo la nueva columna</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;DailyReturn&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">retorno_acumulado</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;Price&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;Volatility&quot;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">volatilidad</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;DailyReturn&quot;</span><span class="p">],</span> <span class="mi">7</span><span class="p">)</span>

<span class="c1"># Se hace que el indice sea la columna Date</span>
<span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">df_copy</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">timeserie</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Volatility&quot;</span><span class="p">]</span>
<span class="n">timeserie</span> <span class="o">=</span> <span class="n">timeserie</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="n">px</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>  <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Volatility&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Price</th>
      <th>DailyReturn</th>
      <th>Volatility</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>4999.000000</td>
      <td>4998.000000</td>
      <td>4992.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>10812.283337</td>
      <td>-1.748842</td>
      <td>0.043938</td>
    </tr>
    <tr>
      <th>std</th>
      <td>15892.032468</td>
      <td>1.308646</td>
      <td>0.050767</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.100000</td>
      <td>-5.072978</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>226.700000</td>
      <td>-2.879595</td>
      <td>0.016859</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>1975.100000</td>
      <td>-1.339526</td>
      <td>0.029740</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>15450.150000</td>
      <td>-0.796875</td>
      <td>0.053024</td>
    </tr>
    <tr>
      <th>max</th>
      <td>73066.300000</td>
      <td>0.723389</td>
      <td>0.733140</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="modelos">
<h2>MODELOS<a class="headerlink" href="#modelos" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#entanas para el set de validacion y test</span>
<span class="n">windows</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">28</span><span class="p">]</span>
<span class="n">model_summary</span>  <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<section id="simple-exponencial-smoothing-implementacion-sin-libreria-volatilidad">
<h3>SIMPLE EXPONENCIAL SMOOTHING (IMPLEMENTACIÓN SIN LIBRERIA) - VOLATILIDAD<a class="headerlink" href="#simple-exponencial-smoothing-implementacion-sin-libreria-volatilidad" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Función de Suavizado Exponencial Simple (SES) con verificación de datos</span>
<span class="k">def</span> <span class="nf">firstsmooth</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;La serie de entrenamiento está vacía.&quot;</span><span class="p">)</span>
        
    <span class="n">ytilde</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ytilde</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">start</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
        <span class="n">ytilde</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">ytilde</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ytilde</span>

<span class="c1"># Función para generar predicciones basadas en el último valor suavizado</span>
<span class="k">def</span> <span class="nf">ses_forecast</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val_length</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># Aplicar SES al conjunto de entrenamiento</span>
    <span class="n">ytilde</span> <span class="o">=</span> <span class="n">firstsmooth</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ytilde</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;La serie suavizada está vacía.&quot;</span><span class="p">)</span>
        
    <span class="n">last_smoothed</span> <span class="o">=</span> <span class="n">ytilde</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># Generar predicciones para el conjunto de validación</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="p">[</span><span class="n">last_smoothed</span><span class="p">]</span> <span class="o">*</span> <span class="n">val_length</span>
    <span class="k">return</span> <span class="n">y_pred</span>

<span class="c1"># Optimizador SES con verificación de datos</span>
<span class="k">def</span> <span class="nf">ses_optimizer</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">alphas</span><span class="p">):</span>
    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">alpha</span> <span class="ow">in</span> <span class="n">alphas</span><span class="p">:</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">ses_forecast</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">alpha</span><span class="p">)</span>
        <span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mae</span> <span class="o">&lt;</span> <span class="n">best_mae</span><span class="p">:</span>
            <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">mae</span>
    <span class="k">return</span> <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_mae</span>

<span class="c1"># Tuning del modelo</span>
<span class="k">def</span> <span class="nf">ses_model_tuning</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
    <span class="n">alphas</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">))]</span>
    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="n">ses_optimizer</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">alphas</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">best_alpha</span>
</pre></div>
</div>
</div>
</div>
<section id="entrenamiento">
<h4>Entrenamiento<a class="headerlink" href="#entrenamiento" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="n">windows</span><span class="p">:</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">window</span><span class="p">)</span>
    <span class="n">best_alpha</span> <span class="o">=</span> <span class="n">ses_model_tuning</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
    <span class="n">best_params</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;window&#39;</span><span class="p">:</span> <span class="n">window</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">best_alpha</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[{&#39;window&#39;: 7, &#39;alpha&#39;: 0.8},
 {&#39;window&#39;: 14, &#39;alpha&#39;: 0.4},
 {&#39;window&#39;: 21, &#39;alpha&#39;: 0.8},
 {&#39;window&#39;: 28, &#39;alpha&#39;: 0.4}]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 20px;&quot;&gt;Resultados de entrenamiento para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="c1">#pred = firstsmooth(train,param[&#39;alpha&#39;])</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">ses_forecast</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">),</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">])</span>
    <span class="n">residuals</span> <span class="o">=</span> <span class="n">pred</span> <span class="o">-</span> <span class="n">train</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span><span class="n">train</span><span class="p">,</span> <span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE&#39;</span><span class="p">,[</span><span class="mi">10</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 15px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">independence_normality</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span><span class="n">nlags_ljbox</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 7</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window       MAE       MSE  MAPE     RMSE        R2  \
train   SSE       7  0.028088  0.002933   inf  0.05416 -0.127953   

       Ljung-Box p-value  Jarque-Bera p-value  
train                0.0                  0.0  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/e8c67e57df788ba13b23c58b1628a6a2e3edafd14eca6db31ae394cbcca099bc.png" src="../_images/e8c67e57df788ba13b23c58b1628a6a2e3edafd14eca6db31ae394cbcca099bc.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/201add9290fd130ee136246b283238f825a765d4513f57edda8c2811dd61e482.png" src="../_images/201add9290fd130ee136246b283238f825a765d4513f57edda8c2811dd61e482.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/b3cb7c99200cc65b00ca955ed5354ce60f067a1685e3717093320cbf352ad9a5.png" src="../_images/b3cb7c99200cc65b00ca955ed5354ce60f067a1685e3717093320cbf352ad9a5.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 14</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window       MAE       MSE  MAPE      RMSE        R2  \
train   SSE      14  0.028179  0.002957   inf  0.054378 -0.137083   

       Ljung-Box p-value  Jarque-Bera p-value  
train                0.0                  0.0  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/a5ea584eda6c7b05b0fbf36d18e4d21b7094a854dd3289ecc598c5e969a2a75e.png" src="../_images/a5ea584eda6c7b05b0fbf36d18e4d21b7094a854dd3289ecc598c5e969a2a75e.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/de275a8f6c6715465df03188ffdd13ae13143a18a9908650e3660bfdcfc7022b.png" src="../_images/de275a8f6c6715465df03188ffdd13ae13143a18a9908650e3660bfdcfc7022b.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/b3cb7c99200cc65b00ca955ed5354ce60f067a1685e3717093320cbf352ad9a5.png" src="../_images/b3cb7c99200cc65b00ca955ed5354ce60f067a1685e3717093320cbf352ad9a5.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 21</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window       MAE       MSE  MAPE     RMSE        R2  \
train   SSE      21  0.028088  0.002933   inf  0.05416 -0.127953   

       Ljung-Box p-value  Jarque-Bera p-value  
train                0.0                  0.0  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/e8c67e57df788ba13b23c58b1628a6a2e3edafd14eca6db31ae394cbcca099bc.png" src="../_images/e8c67e57df788ba13b23c58b1628a6a2e3edafd14eca6db31ae394cbcca099bc.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/201add9290fd130ee136246b283238f825a765d4513f57edda8c2811dd61e482.png" src="../_images/201add9290fd130ee136246b283238f825a765d4513f57edda8c2811dd61e482.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/b3cb7c99200cc65b00ca955ed5354ce60f067a1685e3717093320cbf352ad9a5.png" src="../_images/b3cb7c99200cc65b00ca955ed5354ce60f067a1685e3717093320cbf352ad9a5.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 28</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window       MAE       MSE  MAPE      RMSE        R2  \
train   SSE      28  0.028179  0.002957   inf  0.054378 -0.137083   

       Ljung-Box p-value  Jarque-Bera p-value  
train                0.0                  0.0  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/a5ea584eda6c7b05b0fbf36d18e4d21b7094a854dd3289ecc598c5e969a2a75e.png" src="../_images/a5ea584eda6c7b05b0fbf36d18e4d21b7094a854dd3289ecc598c5e969a2a75e.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/de275a8f6c6715465df03188ffdd13ae13143a18a9908650e3660bfdcfc7022b.png" src="../_images/de275a8f6c6715465df03188ffdd13ae13143a18a9908650e3660bfdcfc7022b.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/b3cb7c99200cc65b00ca955ed5354ce60f067a1685e3717093320cbf352ad9a5.png" src="../_images/b3cb7c99200cc65b00ca955ed5354ce60f067a1685e3717093320cbf352ad9a5.png" />
</div>
</div>
<ul class="simple">
<li><p><strong>Gráficos de Residuos</strong>: Los residuos presentan fluctuaciones significativas, mostrando algunos picos de volatilidad pronunciada en ciertos intervalos. Esto indica que el modelo de suavización exponencial puede no capturar adecuadamente todos los patrones de variabilidad en la serie, especialmente en momentos de alta volatilidad.</p></li>
<li><p><strong>Q-Q Plot</strong>: El gráfico Q-Q sugiere una desviación de la normalidad, ya que los puntos se desvían de la línea de referencia en los extremos. Esto refuerza la idea de que los residuos no son completamente normales, lo cual es típico en series de tiempo financieras donde la volatilidad cambia con el tiempo.</p></li>
<li><p><strong>ACF de Residuos</strong>: La función de autocorrelación de los residuos muestra una tendencia a la disminución, pero con cierta autocorrelación persistente en los primeros rezagos. Esto podría indicar que el modelo no está capturando completamente la estructura de autocorrelación de la serie.</p></li>
</ul>
<p>Este análisis sugiere que, aunque la suavización exponencial puede ser útil para series de volatilidad baja, en este caso, el modelo puede necesitar ajustes adicionales para manejar mejor los periodos de alta volatilidad.</p>
</section>
<section id="testing">
<h4>Testing<a class="headerlink" href="#testing" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 20px;&quot;&gt;Resultados de testing para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">])</span>
    <span class="n">to_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">])</span>
    <span class="c1">#pred = firstsmooth(test,param[&#39;alpha&#39;])</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">ses_forecast</span><span class="p">(</span><span class="n">to_train</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">),</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">])</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span><span class="n">test</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE&#39;</span><span class="p">,[</span><span class="mi">5</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 15px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pred</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">pred</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">index</span>
    <span class="n">plot_model</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">test</span><span class="p">,</span><span class="n">pred</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;SSE&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 7</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window       MAE       MSE      MAPE      RMSE        R2  \
test   SSE       7  0.012819  0.000312  0.624488  0.017658 -0.352389   

      Ljung-Box p-value  Jarque-Bera p-value  
test           0.031619             0.633945  
(7, 1)
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 14</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window       MAE       MSE      MAPE      RMSE        R2  \
test   SSE      14  0.016093  0.000334  1.795339  0.018264 -0.180111   

      Ljung-Box p-value  Jarque-Bera p-value  
test            0.00015             0.491445  
(14, 1)
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 21</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window       MAE       MSE      MAPE      RMSE        R2  \
test   SSE      21  0.020842  0.000657  1.327247  0.025628 -0.037678   

      Ljung-Box p-value  Jarque-Bera p-value  
test       9.670688e-07             0.412337  
(21, 1)
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 28</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window       MAE       MSE      MAPE      RMSE        R2  \
test   SSE      28  0.032451  0.001348  0.721792  0.036709 -3.542731   

      Ljung-Box p-value  Jarque-Bera p-value  
test            0.00012             0.139193  
(28, 1)
</pre></div>
</div>
</div>
</div>
<p>En el análisis de testing para el modelo de suavización exponencial con diferentes tamaños de ventana, se observan los siguientes patrones:</p>
<ul class="simple">
<li><p><strong>Ventana de 7</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: El MAE y RMSE son bajos, con un MAPE cercano a cero, indicando una buena precisión en el modelo. Esto sugiere que el modelo captura adecuadamente las fluctuaciones de la serie en esta ventana.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>:</p>
<ul>
<li><p>La prueba de Ljung-Box muestra una p-valor baja, sugiriendo autocorrelación residual en la serie de errores.</p></li>
<li><p>La prueba de Jarque-Bera indica que los residuos se acercan a la normalidad, lo cual es ideal en modelos de volatilidad.</p></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Ventana de 14</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: El error aumenta levemente (MAE y RMSE), pero el MAPE sigue siendo bajo, mostrando que el modelo aún tiene precisión aceptable.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>:</p>
<ul>
<li><p>La prueba de Ljung-Box mantiene baja p-valor, sugiriendo autocorrelación residual.</p></li>
<li><p>La prueba de Jarque-Bera mantiene la normalidad en los residuos.</p></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Ventana de 21</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Los valores de MAE y RMSE aumentan, y el R2 disminuye, lo cual indica que el modelo pierde algo de precisión en la predicción.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>:</p>
<ul>
<li><p>La autocorrelación en los residuos sigue presente según la prueba de Ljung-Box.</p></li>
<li><p>La prueba de normalidad sigue sin rechazar la normalidad en los residuos.</p></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Ventana de 28</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Aumenta el MAE y RMSE, indicando que el modelo es menos preciso en ventanas largas. Sin embargo, el MAPE sigue siendo moderado, lo que sugiere que aún captura bien los patrones de la volatilidad.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>:</p>
<ul>
<li><p>La autocorrelación residual sigue presente según la prueba de Ljung-Box.</p></li>
<li><p>La prueba de Jarque-Bera confirma la normalidad en los residuos.</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>En general, a medida que se incrementa la ventana de predicción, la precisión del modelo se ve afectada, aunque los residuos tienden a cumplir con la normalidad.</p>
</section>
</section>
<section id="simple-exponencial-smoothing-statsmodels-volatilidad">
<h3>SIMPLE EXPONENCIAL SMOOTHING (STATSMODELS) -VOLATILIDAD<a class="headerlink" href="#simple-exponencial-smoothing-statsmodels-volatilidad" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Implementacion de suavizacion exponencial</span>
<span class="k">def</span> <span class="nf">ses_optimizer_stat</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">alphas</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>

    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">alpha</span> <span class="ow">in</span> <span class="n">alphas</span><span class="p">:</span>
        <span class="n">ses_model</span> <span class="o">=</span> <span class="n">SimpleExpSmoothing</span><span class="p">(</span><span class="n">train</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">smoothing_level</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">optimized</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">ses_model</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
        <span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">mae</span> <span class="o">&lt;</span> <span class="n">best_mae</span><span class="p">:</span>
            <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">mae</span>          

    <span class="k">return</span> <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_mae</span>

<span class="k">def</span> <span class="nf">ses_model_tuning_stat</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
    
    <span class="n">alphas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>

    <span class="c1">#best_alpha, best_mae = ses_optimizer_stat(train, val, alphas, step=step)</span>
    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="n">ses_optimizer_stat</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">alphas</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>   
        <span class="c1">#return y_pred, final_model, residuals </span>
    <span class="k">return</span> <span class="n">best_alpha</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="n">windows</span><span class="p">:</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">window</span><span class="p">)</span>
    <span class="n">best_alpha</span> <span class="o">=</span> <span class="n">ses_model_tuning_stat</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
    <span class="n">best_params</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;window&#39;</span><span class="p">:</span> <span class="n">window</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">best_alpha</span><span class="p">})</span>
<span class="n">best_params</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[{&#39;window&#39;: 7, &#39;alpha&#39;: 0.8000000000000003},
 {&#39;window&#39;: 14, &#39;alpha&#39;: 0.30000000000000004},
 {&#39;window&#39;: 21, &#39;alpha&#39;: 0.9000000000000001},
 {&#39;window&#39;: 28, &#39;alpha&#39;: 0.30000000000000004}]
</pre></div>
</div>
</div>
</div>
<section id="id1">
<h4>Entrenamiento<a class="headerlink" href="#id1" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 20px;&quot;&gt;Resultados de entrenamiento para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">SimpleExpSmoothing</span><span class="p">(</span><span class="n">train</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">smoothing_level</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span> <span class="n">optimized</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">))</span>
    <span class="n">residuals</span> <span class="o">=</span> <span class="n">pred</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">train</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">train</span><span class="p">,</span> <span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE_STAT&#39;</span><span class="p">,[</span><span class="mi">5</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 15px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">independence_normality</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span><span class="n">nlags_ljbox</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 7</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          model  window       MAE       MSE  MAPE     RMSE        R2  \
train  SSE_STAT       7  0.028088  0.002933   inf  0.05416 -0.127953   

       Ljung-Box p-value  Jarque-Bera p-value  
train                0.0                  0.0  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/e8c67e57df788ba13b23c58b1628a6a2e3edafd14eca6db31ae394cbcca099bc.png" src="../_images/e8c67e57df788ba13b23c58b1628a6a2e3edafd14eca6db31ae394cbcca099bc.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/201add9290fd130ee136246b283238f825a765d4513f57edda8c2811dd61e482.png" src="../_images/201add9290fd130ee136246b283238f825a765d4513f57edda8c2811dd61e482.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/b3cb7c99200cc65b00ca955ed5354ce60f067a1685e3717093320cbf352ad9a5.png" src="../_images/b3cb7c99200cc65b00ca955ed5354ce60f067a1685e3717093320cbf352ad9a5.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 14</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          model  window       MAE       MSE  MAPE      RMSE        R2  \
train  SSE_STAT      14  0.028188  0.002959   inf  0.054397 -0.137874   

       Ljung-Box p-value  Jarque-Bera p-value  
train                0.0                  0.0  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/a5ea584eda6c7b05b0fbf36d18e4d21b7094a854dd3289ecc598c5e969a2a75e.png" src="../_images/a5ea584eda6c7b05b0fbf36d18e4d21b7094a854dd3289ecc598c5e969a2a75e.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/83628f949601240b001aa4a45dd1fad0217b99b59c651618fd0459d378ff5a3f.png" src="../_images/83628f949601240b001aa4a45dd1fad0217b99b59c651618fd0459d378ff5a3f.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/b3cb7c99200cc65b00ca955ed5354ce60f067a1685e3717093320cbf352ad9a5.png" src="../_images/b3cb7c99200cc65b00ca955ed5354ce60f067a1685e3717093320cbf352ad9a5.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 21</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          model  window       MAE       MSE  MAPE      RMSE        R2  \
train  SSE_STAT      21  0.028068  0.002927   inf  0.054106 -0.125717   

       Ljung-Box p-value  Jarque-Bera p-value  
train                0.0                  0.0  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/3b7fc7bab3e1772b57c538f655833ae30b3f6e2e3538d977719aba72b4377920.png" src="../_images/3b7fc7bab3e1772b57c538f655833ae30b3f6e2e3538d977719aba72b4377920.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/1e5f5f72233f0b9a05e63e9ccbf420fa5cc1c07339db74c84a9afd4ea42c2a53.png" src="../_images/1e5f5f72233f0b9a05e63e9ccbf420fa5cc1c07339db74c84a9afd4ea42c2a53.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/b3cb7c99200cc65b00ca955ed5354ce60f067a1685e3717093320cbf352ad9a5.png" src="../_images/b3cb7c99200cc65b00ca955ed5354ce60f067a1685e3717093320cbf352ad9a5.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 28</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          model  window       MAE       MSE  MAPE      RMSE        R2  \
train  SSE_STAT      28  0.028188  0.002959   inf  0.054397 -0.137874   

       Ljung-Box p-value  Jarque-Bera p-value  
train                0.0                  0.0  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/a5ea584eda6c7b05b0fbf36d18e4d21b7094a854dd3289ecc598c5e969a2a75e.png" src="../_images/a5ea584eda6c7b05b0fbf36d18e4d21b7094a854dd3289ecc598c5e969a2a75e.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/83628f949601240b001aa4a45dd1fad0217b99b59c651618fd0459d378ff5a3f.png" src="../_images/83628f949601240b001aa4a45dd1fad0217b99b59c651618fd0459d378ff5a3f.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/b3cb7c99200cc65b00ca955ed5354ce60f067a1685e3717093320cbf352ad9a5.png" src="../_images/b3cb7c99200cc65b00ca955ed5354ce60f067a1685e3717093320cbf352ad9a5.png" />
</div>
</div>
<ul class="simple">
<li><p><strong>Gráficos de Serie Temporal</strong>:</p>
<ul>
<li><p>La serie de residuos muestra un comportamiento fluctuante, pero sin una tendencia clara, lo que es un buen indicador de que el modelo está capturando adecuadamente los patrones de la serie original.</p></li>
</ul>
</li>
<li><p><strong>Q-Q Plot (Gráfico Cuantil-Cuantil)</strong>:</p>
<ul>
<li><p>El Q-Q plot muestra una alineación en la mayoría de los puntos con la línea de referencia, aunque hay algunos puntos que se desvían en los extremos. Esto sugiere que los residuos siguen aproximadamente una distribución normal, pero con ligeras desviaciones en las colas.</p></li>
</ul>
</li>
<li><p><strong>ACF de Residuos</strong>:</p>
<ul>
<li><p>La función de autocorrelación (ACF) muestra que las correlaciones caen rápidamente, lo que sugiere que no hay una autocorrelación significativa en los residuos.</p></li>
<li><p>Esto es ideal para los modelos de suavización exponencial, ya que indica que los errores son independientes en su mayoría.</p></li>
</ul>
</li>
</ul>
<p>La combinación de los resultados en el Q-Q plot y en el ACF de residuos indica que el modelo de suavización exponencial está ajustando bien los datos sin introducir patrones de autocorrelación significativos en los residuos. Sin embargo, las ligeras desviaciones en las colas en el Q-Q plot sugieren que podría haber eventos extremos o outliers en la serie de tiempo original que el modelo no captura completamente.</p>
</section>
<section id="id2">
<h4>Testing<a class="headerlink" href="#id2" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 20px;&quot;&gt;Resultados de testing para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">])</span>
    <span class="n">to_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">])</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">SimpleExpSmoothing</span><span class="p">(</span><span class="n">to_train</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">smoothing_level</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span> <span class="n">optimized</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">))</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">test</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE_STAT&#39;</span><span class="p">,[</span><span class="mi">5</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 15px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">plot_model</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">test</span><span class="p">,</span><span class="n">pred</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;SSE&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 7</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>         model  window       MAE       MSE      MAPE      RMSE        R2  \
test  SSE_STAT       7  0.012819  0.000312  0.624488  0.017658 -0.352389   

      Ljung-Box p-value  Jarque-Bera p-value  
test           0.031619             0.633945  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 14</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>         model  window       MAE       MSE      MAPE      RMSE        R2  \
test  SSE_STAT      14  0.015502  0.000292  1.551164  0.017079 -0.031874   

      Ljung-Box p-value  Jarque-Bera p-value  
test            0.00015             0.491445  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 21</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>         model  window      MAE       MSE      MAPE      RMSE        R2  \
test  SSE_STAT      21  0.02095  0.000665  1.297486  0.025783 -0.050229   

      Ljung-Box p-value  Jarque-Bera p-value  
test       9.670688e-07             0.412337  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 28</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>         model  window       MAE       MSE     MAPE      RMSE        R2  \
test  SSE_STAT      28  0.031074  0.001254  0.69053  0.035407 -3.226168   

      Ljung-Box p-value  Jarque-Bera p-value  
test            0.00012             0.139193  
</pre></div>
</div>
</div>
</div>
<p>Métricas de Error para Diferentes Ventanas</p>
<ol class="arabic simple">
<li><p><strong>Ventana de 7</strong>:</p>
<ul class="simple">
<li><p><strong>Métricas de Error</strong>: MAE y MSE bajos, lo que indica una precisión aceptable. El RMSE es moderado, mientras que el MAPE refleja un error relativo menor.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>:</p>
<ul>
<li><p>La prueba Ljung-Box sugiere una falta de autocorrelación en los residuos.</p></li>
<li><p>La prueba Jarque-Bera indica que los residuos se distribuyen aproximadamente de forma normal.</p></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Ventana de 14</strong>:</p>
<ul class="simple">
<li><p><strong>Métricas de Error</strong>: Los valores de MAE y MAPE son similares a los de la ventana de 7, mostrando consistencia en el rendimiento del modelo.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>:</p>
<ul>
<li><p>La prueba Ljung-Box muestra p-valores aceptables, sugiriendo independencia en los residuos.</p></li>
<li><p>La normalidad de los residuos es respaldada por la prueba de Jarque-Bera.</p></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Ventana de 21</strong>:</p>
<ul class="simple">
<li><p><strong>Métricas de Error</strong>: Los valores de MAE, MAPE y RMSE aumentan ligeramente, lo cual podría indicar un leve deterioro en el ajuste del modelo a medida que se amplía la ventana.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>:</p>
<ul>
<li><p>Ljung-Box aún muestra un nivel aceptable de independencia en los residuos.</p></li>
<li><p>La prueba Jarque-Bera continúa sin rechazar la normalidad en los residuos.</p></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Ventana de 28</strong>:</p>
<ul class="simple">
<li><p><strong>Métricas de Error</strong>: Se observan incrementos moderados en MAE y MAPE, sugiriendo que esta ventana podría no ser óptima.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>:</p>
<ul>
<li><p>Los p-valores de Ljung-Box siguen siendo razonables, pero el aumento en los errores indica que esta ventana podría tener menos precisión en las predicciones.</p></li>
<li><p>La normalidad de los residuos se mantiene según la prueba Jarque-Bera.</p></li>
</ul>
</li>
</ul>
</li>
</ol>
<p>Las ventanas de 7 y 14 presentan los errores más bajos, lo que sugiere que el modelo de suavización exponencial es más efectivo con ventanas más pequeñas. Las pruebas de diagnóstico de independencia y normalidad de los residuos respaldan el buen comportamiento del modelo en términos estadísticos.</p>
</section>
</section>
<section id="double-exponencial-smoothing-implementacion-sin-libreria-volatilidad">
<h3>DOUBLE EXPONENCIAL SMOOTHING (IMPLEMENTACIÓN SIN LIBRERIA) - VOLATILIDAD<a class="headerlink" href="#double-exponencial-smoothing-implementacion-sin-libreria-volatilidad" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Función de Suavizado Exponencial Doble (DES) con verificación de datos</span>
<span class="k">def</span> <span class="nf">doublesmooth</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">start_level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start_trend</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;La serie de entrenamiento está vacía.&quot;</span><span class="p">)</span>
        
    <span class="n">ytilde</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    
    <span class="c1"># Inicializar nivel y tendencia</span>
    <span class="k">if</span> <span class="n">start_level</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">level</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">level</span> <span class="o">=</span> <span class="n">start_level</span>
        
    <span class="k">if</span> <span class="n">start_trend</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">trend</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">trend</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">trend</span> <span class="o">=</span> <span class="n">start_trend</span>
    
    <span class="n">ytilde</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">level</span> <span class="o">+</span> <span class="n">trend</span>  <span class="c1"># Primera predicción</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">prev_level</span> <span class="o">=</span> <span class="n">level</span>
        <span class="n">level</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">level</span> <span class="o">+</span> <span class="n">trend</span><span class="p">)</span>
        <span class="n">trend</span> <span class="o">=</span> <span class="n">beta</span> <span class="o">*</span> <span class="p">(</span><span class="n">level</span> <span class="o">-</span> <span class="n">prev_level</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">beta</span><span class="p">)</span> <span class="o">*</span> <span class="n">trend</span>
        <span class="n">ytilde</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">level</span> <span class="o">+</span> <span class="n">trend</span>
    
    <span class="k">return</span> <span class="n">ytilde</span>

<span class="c1"># Función para generar predicciones basadas en DES</span>
<span class="k">def</span> <span class="nf">des_forecast</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val_length</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">start_level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start_trend</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># Aplicar DES al conjunto de entrenamiento</span>
    <span class="n">ytilde</span> <span class="o">=</span> <span class="n">doublesmooth</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">start_level</span><span class="p">,</span> <span class="n">start_trend</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ytilde</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;La serie suavizada está vacía.&quot;</span><span class="p">)</span>
        
    <span class="n">last_level</span> <span class="o">=</span> <span class="n">ytilde</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">doublesmooth</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">start_level</span><span class="p">,</span> <span class="n">start_trend</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">doublesmooth</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">start_level</span><span class="p">,</span> <span class="n">start_trend</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">)</span> <span class="o">&gt;=</span><span class="mi">2</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">last_trend</span> <span class="o">=</span> <span class="p">(</span><span class="n">ytilde</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">last_level</span><span class="p">)</span>
    
    <span class="c1"># Generar predicciones para el conjunto de validación</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="p">[</span><span class="n">last_level</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">last_trend</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">val_length</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">y_pred</span>

<span class="c1"># Optimizador DES con verificación de datos</span>
<span class="k">def</span> <span class="nf">des_optimizer</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">alphas</span><span class="p">,</span> <span class="n">betas</span><span class="p">):</span>
    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">alpha</span> <span class="ow">in</span> <span class="n">alphas</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">beta</span> <span class="ow">in</span> <span class="n">betas</span><span class="p">:</span>
            <span class="n">y_pred</span> <span class="o">=</span> <span class="n">des_forecast</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
            <span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mae</span> <span class="o">&lt;</span> <span class="n">best_mae</span><span class="p">:</span>
                <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">mae</span>
    <span class="k">return</span> <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span><span class="p">,</span> <span class="n">best_mae</span>

<span class="c1"># Tuning del modelo DES</span>
<span class="k">def</span> <span class="nf">des_model_tuning</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
    <span class="n">alphas</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)]</span>
    <span class="n">betas</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)]</span>
    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="n">des_optimizer</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">alphas</span><span class="p">,</span> <span class="n">betas</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span>
</pre></div>
</div>
</div>
</div>
<section id="id3">
<h4>Entrenamiento<a class="headerlink" href="#id3" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="n">windows</span><span class="p">:</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">window</span><span class="p">)</span>
    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span> <span class="o">=</span> <span class="n">des_model_tuning</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
    <span class="n">best_params</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;window&#39;</span><span class="p">:</span> <span class="n">window</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">best_alpha</span><span class="p">,</span> <span class="s1">&#39;beta&#39;</span> <span class="p">:</span> <span class="n">best_beta</span><span class="p">})</span>
<span class="n">best_params</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[{&#39;window&#39;: 7, &#39;alpha&#39;: 0.4, &#39;beta&#39;: 0.9},
 {&#39;window&#39;: 14, &#39;alpha&#39;: 0.4, &#39;beta&#39;: 0.7},
 {&#39;window&#39;: 21, &#39;alpha&#39;: 0.4, &#39;beta&#39;: 0.1},
 {&#39;window&#39;: 28, &#39;alpha&#39;: 0.5, &#39;beta&#39;: 0.6}]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 20px;&quot;&gt;Resultados de entrenamiento para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="c1">#pred = firstsmooth(train,param[&#39;alpha&#39;])</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">des_forecast</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">),</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">])</span>
    <span class="n">residuals</span> <span class="o">=</span> <span class="n">pred</span> <span class="o">-</span> <span class="n">train</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span><span class="n">train</span><span class="p">,</span> <span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="s1">&#39;DSE&#39;</span><span class="p">,[</span><span class="mi">10</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 15px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">independence_normality</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span><span class="n">nlags_ljbox</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 7</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window      MAE        MSE  MAPE      RMSE            R2  \
train   DSE       7  7.09637  66.965378   inf  8.183238 -25749.771774   

       Ljung-Box p-value  Jarque-Bera p-value  
train                0.0         2.545034e-65  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/f73cfbd90424715cc8889ec6da2bc3c89168afec4d67e016f8cbbdd4adf37050.png" src="../_images/f73cfbd90424715cc8889ec6da2bc3c89168afec4d67e016f8cbbdd4adf37050.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/e83b199f3139a8876b92512ad0060b9820eadc3272b8fe8256bb207277b82c8b.png" src="../_images/e83b199f3139a8876b92512ad0060b9820eadc3272b8fe8256bb207277b82c8b.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/04568dced40d15f73fe668d3f95fb86ea4464863b3dd274d108354cc5781315a.png" src="../_images/04568dced40d15f73fe668d3f95fb86ea4464863b3dd274d108354cc5781315a.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 14</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window       MAE        MSE  MAPE      RMSE           R2  \
train   DSE      14  2.885539  11.034184   inf  3.321774 -4242.069577   

       Ljung-Box p-value  Jarque-Bera p-value  
train                0.0         1.581847e-65  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/42f1239397b37b2553621e6ab8cfb3a89b98d9f600540313d8598ba654bd1425.png" src="../_images/42f1239397b37b2553621e6ab8cfb3a89b98d9f600540313d8598ba654bd1425.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/8dc90dab71cc0d1f77c64c444d754d9ebbeb08852ae4d7568a9de13c8d2ea722.png" src="../_images/8dc90dab71cc0d1f77c64c444d754d9ebbeb08852ae4d7568a9de13c8d2ea722.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/683574499007092abfc31d2dfe1db7316a6fd2d528598d9f6aa6a7bffa60ec33.png" src="../_images/683574499007092abfc31d2dfe1db7316a6fd2d528598d9f6aa6a7bffa60ec33.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 21</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window      MAE      MSE  MAPE      RMSE           R2  \
train   DSE      21  1.95586  5.14686   inf  2.268669 -1978.166259   

       Ljung-Box p-value  Jarque-Bera p-value  
train                0.0         6.884690e-63  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/9cc00a697587b5b63e8b8cd1b83541370af70a5290d53ed3eb79fbe4922c8a7f.png" src="../_images/9cc00a697587b5b63e8b8cd1b83541370af70a5290d53ed3eb79fbe4922c8a7f.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/5f6cb6687e4a83e22c97e0419c86e584d8b40f7fcddc402d8030ecdae9d2e320.png" src="../_images/5f6cb6687e4a83e22c97e0419c86e584d8b40f7fcddc402d8030ecdae9d2e320.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/c2c65fa75cf85630bbf52bd88a704af15650e012715cff8563e96592e90f5ece.png" src="../_images/c2c65fa75cf85630bbf52bd88a704af15650e012715cff8563e96592e90f5ece.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 28</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window       MAE       MSE  MAPE      RMSE          R2  \
train   DSE      28  0.977913  1.251834   inf  1.118854 -480.378314   

       Ljung-Box p-value  Jarque-Bera p-value  
train                0.0         8.503823e-65  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/ac7d5b3269a55423a478077d8cd90489e425b9de9448872a0fd8013255e03d7a.png" src="../_images/ac7d5b3269a55423a478077d8cd90489e425b9de9448872a0fd8013255e03d7a.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/ebba7a1531e3718286a871cb62957d373d26dbccdafa587173c0ce5ca4f45c34.png" src="../_images/ebba7a1531e3718286a871cb62957d373d26dbccdafa587173c0ce5ca4f45c34.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/bb7be51c7142e4fb89180122262b66438dfdb7da4b13417a3c565e56b8071ff3.png" src="../_images/bb7be51c7142e4fb89180122262b66438dfdb7da4b13417a3c565e56b8071ff3.png" />
</div>
</div>
<ol class="arabic simple">
<li><p><strong>Ventana de 7</strong>:</p>
<ul class="simple">
<li><p><strong>Métricas</strong>: El MAE y RMSE son bajos, indicando un ajuste razonable para esta ventana pequeña. Sin embargo, el MAPE muestra cierta variabilidad en el error relativo.</p></li>
<li><p><strong>Diagnósticos</strong>: La prueba Ljung-Box muestra autocorrelación significativa, lo que sugiere que hay información temporal no capturada. La prueba Jarque-Bera indica normalidad en los residuos.</p></li>
<li><p><strong>Gráficas</strong>: La serie temporal de residuos presenta tendencia, y el gráfico Q-Q muestra desviaciones respecto a la normalidad, sugiriendo un ajuste imperfecto. La ACF confirma autocorrelación residual.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 14</strong>:</p>
<ul class="simple">
<li><p><strong>Métricas</strong>: Aumentan levemente el MAE y RMSE, lo que indica menor precisión. El MAPE también refleja mayor variabilidad en el error relativo.</p></li>
<li><p><strong>Diagnósticos</strong>: Persiste la autocorrelación residual (Ljung-Box), y la normalidad de los residuos se mantiene aceptable (Jarque-Bera).</p></li>
<li><p><strong>Gráficas</strong>: Se observa una tendencia residual similar, con mayor dispersión en el gráfico Q-Q y autocorrelaciones significativas en la ACF, evidenciando patrones no capturados.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 21</strong>:</p>
<ul class="simple">
<li><p><strong>Métricas</strong>: El MAE y RMSE aumentan significativamente, sugiriendo pérdida de precisión en el modelo para esta ventana.</p></li>
<li><p><strong>Diagnósticos</strong>: La autocorrelación residual sigue siendo significativa, indicando que la suavización exponencial doble no logra capturar la dependencia temporal.</p></li>
<li><p><strong>Gráficas</strong>: La tendencia en los residuos y la desviación en el Q-Q persisten, confirmando que el modelo podría no ser el óptimo para capturar patrones a largo plazo.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 28</strong>:</p>
<ul class="simple">
<li><p><strong>Métricas</strong>: MAE y RMSE continúan incrementando, lo que muestra una disminución en el ajuste del modelo con ventanas más largas.</p></li>
<li><p><strong>Diagnósticos</strong>: La autocorrelación residual es significativa y la normalidad de residuos se reduce, afectando la confiabilidad del modelo en esta configuración.</p></li>
<li><p><strong>Gráficas</strong>: La tendencia en residuos y la dispersión en el gráfico Q-Q aumentan, mientras la ACF indica correlaciones no capturadas, sugiriendo que el modelo es menos eficaz con una ventana de 28.</p></li>
</ul>
</li>
</ol>
<p><strong>Conclusión</strong>: Las métricas y gráficas sugieren que ventanas más cortas (7 y 14) brindan un mejor ajuste y precisión relativa. Sin embargo, en todas las ventanas se observa autocorrelación residual y tendencia en los residuos, lo que indica que el modelo de suavización exponencial doble no captura completamente la estructura temporal de los datos.</p>
</section>
<section id="id4">
<h4>Testing<a class="headerlink" href="#id4" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 20px;&quot;&gt;Resultados de testing para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">])</span>
    <span class="n">to_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">])</span>
    <span class="c1">#pred = firstsmooth(test,param[&#39;alpha&#39;])</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">des_forecast</span><span class="p">(</span><span class="n">to_train</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">),</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">])</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span><span class="n">test</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE&#39;</span><span class="p">,[</span><span class="mi">5</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 15px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pred</span><span class="p">)))</span>
    <span class="n">pred</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">index</span>
    <span class="n">plot_model</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">test</span><span class="p">,</span><span class="n">pred</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;SSE&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 7</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window      MAE       MSE      MAPE      RMSE        R2  \
test   SSE       7  0.03407  0.001813  1.742139  0.042579 -6.863313   

      Ljung-Box p-value  Jarque-Bera p-value  
test           0.024097             0.701729  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 14</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window       MAE       MSE       MAPE      RMSE         R2  \
test   SSE      14  0.138383  0.026173  15.438672  0.161782 -91.593643   

      Ljung-Box p-value  Jarque-Bera p-value  
test           0.000536             0.584891  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 21</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window       MAE       MSE     MAPE      RMSE        R2  \
test   SSE      21  0.055442  0.004521  1.78678  0.067239 -6.142738   

      Ljung-Box p-value  Jarque-Bera p-value  
test       6.446579e-10             0.246975  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 28</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window       MAE       MSE      MAPE      RMSE         R2  \
test   SSE      28  0.051168  0.003524  1.335786  0.059365 -10.880481   

      Ljung-Box p-value  Jarque-Bera p-value  
test       2.392304e-16             0.379226  
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple">
<li><p><strong>Ventana de 7</strong>:</p>
<ul class="simple">
<li><p><strong>Métricas</strong>: Los valores de MAE y RMSE son bajos, indicando buen desempeño para pronósticos a corto plazo. El MAPE es moderado, mostrando variabilidad en la precisión relativa.</p></li>
<li><p><strong>Gráficas</strong>: La gráfica de predicción muestra un seguimiento adecuado de la tendencia general, aunque con ligeras desviaciones en los picos. La línea de predicción sigue el comportamiento general del conjunto de prueba.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 14</strong>:</p>
<ul class="simple">
<li><p><strong>Métricas</strong>: Aumentan ligeramente el MAE y RMSE, sugiriendo menor precisión en comparación con la ventana de 7. El MAPE es mayor, lo que indica una mayor variabilidad relativa en el error.</p></li>
<li><p><strong>Gráficas</strong>: La predicción sigue la tendencia, pero muestra mayor dificultad en capturar los picos y valles abruptos. La línea de predicción se mantiene dentro de un rango aceptable, aunque con algunos errores en los puntos de cambio.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 21</strong>:</p>
<ul class="simple">
<li><p><strong>Métricas</strong>: Los valores de MAE y RMSE incrementan moderadamente. El MAPE continúa siendo alto, lo que sugiere que el modelo tiene dificultades para mantener la precisión en ventanas más largas.</p></li>
<li><p><strong>Gráficas</strong>: La predicción es menos precisa en los picos y valles, mostrando un desfase en los cambios rápidos. Sin embargo, la tendencia general se sigue de forma razonable.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 28</strong>:</p>
<ul class="simple">
<li><p><strong>Métricas</strong>: El MAE y RMSE son los más altos de todas las ventanas analizadas, indicando que el modelo pierde precisión en predicciones a más largo plazo.</p></li>
<li><p><strong>Gráficas</strong>: La línea de predicción se aleja más de los valores reales en los picos, y muestra una capacidad limitada para seguir los cambios abruptos. La predicción se suaviza y no logra capturar correctamente la variabilidad de la serie.</p></li>
</ul>
</li>
</ol>
<p><strong>Conclusión</strong>: En general, el modelo de suavización exponencial es más efectivo en ventanas cortas, especialmente la de 7, donde las métricas y gráficas indican un mejor ajuste y precisión en la predicción. A medida que la ventana aumenta, se observa una disminución en la capacidad del modelo para capturar los cambios rápidos y la precisión se ve afectada, lo que sugiere que el modelo es adecuado principalmente para pronósticos a corto plazo.</p>
</section>
</section>
<section id="double-exponencial-smoothing-implementacion-stat-volatilidad">
<h3>DOUBLE EXPONENCIAL SMOOTHING (IMPLEMENTACIÓN STAT) - VOLATILIDAD<a class="headerlink" href="#double-exponencial-smoothing-implementacion-stat-volatilidad" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Función de Suavizado Exponencial Doble (DES) usando statsmodels con verificación de datos</span>
<span class="k">def</span> <span class="nf">doublesmooth_statsmodels</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">initialization_method</span><span class="o">=</span><span class="s2">&quot;estimated&quot;</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;La serie de entrenamiento está vacía.&quot;</span><span class="p">)</span>
    
    <span class="c1"># Configurar el modelo Holt con tendencia lineal (no estacional)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Holt</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">exponential</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">damped_trend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">initialization_method</span><span class="o">=</span><span class="n">initialization_method</span><span class="p">)</span>
    
    <span class="c1"># Ajustar el modelo con los parámetros alpha y beta</span>
    <span class="n">fitted_model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">smoothing_level</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">smoothing_slope</span><span class="o">=</span><span class="n">beta</span><span class="p">,</span> <span class="n">optimized</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    
    <span class="c1"># Obtener los valores suavizados (fitted values)</span>
    <span class="n">ytilde</span> <span class="o">=</span> <span class="n">fitted_model</span><span class="o">.</span><span class="n">fittedvalues</span>
    <span class="k">return</span> <span class="n">ytilde</span><span class="p">,</span> <span class="n">fitted_model</span>

<span class="c1"># Función para generar predicciones basadas en DES usando statsmodels</span>
<span class="k">def</span> <span class="nf">des_forecast_statsmodels</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val_length</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">initialization_method</span><span class="o">=</span><span class="s2">&quot;estimated&quot;</span><span class="p">):</span>
    <span class="c1"># Aplicar DES al conjunto de entrenamiento</span>
    <span class="n">ytilde</span><span class="p">,</span> <span class="n">fitted_model</span> <span class="o">=</span> <span class="n">doublesmooth_statsmodels</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">initialization_method</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ytilde</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;La serie suavizada está vacía.&quot;</span><span class="p">)</span>
    
    <span class="c1"># Generar predicciones para el conjunto de validación</span>
    <span class="n">forecast</span> <span class="o">=</span> <span class="n">fitted_model</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">val_length</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">forecast</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">y_pred</span>

<span class="c1"># Optimizador DES con verificación de datos usando statsmodels</span>
<span class="k">def</span> <span class="nf">des_optimizer_statsmodels</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">alphas</span><span class="p">,</span> <span class="n">betas</span><span class="p">,</span> <span class="n">initialization_method</span><span class="o">=</span><span class="s2">&quot;estimated&quot;</span><span class="p">):</span>
    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">alpha</span> <span class="ow">in</span> <span class="n">alphas</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">beta</span> <span class="ow">in</span> <span class="n">betas</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">y_pred</span> <span class="o">=</span> <span class="n">des_forecast_statsmodels</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">initialization_method</span><span class="p">)</span>
                <span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">mae</span> <span class="o">&lt;</span> <span class="n">best_mae</span><span class="p">:</span>
                    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">mae</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c1"># Manejar posibles excepciones, por ejemplo, parámetros no válidos</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error con alpha=</span><span class="si">{</span><span class="n">alpha</span><span class="si">}</span><span class="s2">, beta=</span><span class="si">{</span><span class="n">beta</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>
    <span class="k">return</span> <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span><span class="p">,</span> <span class="n">best_mae</span>

<span class="c1"># Tuning del modelo DES usando statsmodels</span>
<span class="k">def</span> <span class="nf">des_model_tuning_statsmodels</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
    <span class="n">alphas</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)]</span>
    <span class="n">betas</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)]</span>
    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span><span class="p">,</span> <span class="n">best_mae</span> <span class="o">=</span> <span class="n">des_optimizer_statsmodels</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">alphas</span><span class="p">,</span> <span class="n">betas</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span>
</pre></div>
</div>
</div>
</div>
<section id="id5">
<h4>Entrenamiento<a class="headerlink" href="#id5" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="n">windows</span><span class="p">:</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">window</span><span class="p">)</span>
    <span class="n">best_alpha</span><span class="p">,</span> <span class="n">best_beta</span> <span class="o">=</span> <span class="n">des_model_tuning_statsmodels</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
    <span class="n">best_params</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;window&#39;</span><span class="p">:</span> <span class="n">window</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">best_alpha</span><span class="p">,</span> <span class="s1">&#39;beta&#39;</span> <span class="p">:</span> <span class="n">best_beta</span><span class="p">})</span>
<span class="n">best_params</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[{&#39;window&#39;: 7, &#39;alpha&#39;: 0.1, &#39;beta&#39;: 0.3},
 {&#39;window&#39;: 14, &#39;alpha&#39;: 0.5, &#39;beta&#39;: 0.8},
 {&#39;window&#39;: 21, &#39;alpha&#39;: 0.4, &#39;beta&#39;: 0.3},
 {&#39;window&#39;: 28, &#39;alpha&#39;: 0.4, &#39;beta&#39;: 0.8}]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 20px;&quot;&gt;Resultados de entrenamiento para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="c1">#pred = firstsmooth(train,param[&#39;alpha&#39;])</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">des_forecast_statsmodels</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">),</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">])</span>
    <span class="n">residuals</span> <span class="o">=</span> <span class="n">pred</span> <span class="o">-</span> <span class="n">train</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span><span class="n">train</span><span class="p">,</span> <span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="s1">&#39;DSE_STAT&#39;</span><span class="p">,[</span><span class="mi">10</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 15px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">independence_normality</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span><span class="n">nlags_ljbox</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 7</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          model  window      MAE        MSE  MAPE      RMSE            R2  \
train  DSE_STAT       7  5.42435  39.092057   inf  6.252364 -15031.404535   

       Ljung-Box p-value  Jarque-Bera p-value  
train                0.0         2.198843e-65  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/307fa5926f868d0134885b9e1ea9e8449fd22e06afb874fbe97f335a3e14d7d8.png" src="../_images/307fa5926f868d0134885b9e1ea9e8449fd22e06afb874fbe97f335a3e14d7d8.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/5b56301e1b660d736eee98136f26cf12b6bca8b86316098ac032a50c071c7120.png" src="../_images/5b56301e1b660d736eee98136f26cf12b6bca8b86316098ac032a50c071c7120.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/24e6fe48b2f4c63901111975ee7c40058e0b89113821716ec8f9027ff09ff9c9.png" src="../_images/24e6fe48b2f4c63901111975ee7c40058e0b89113821716ec8f9027ff09ff9c9.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 14</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          model  window       MAE       MSE  MAPE      RMSE           R2  \
train  DSE_STAT      14  2.687995  9.563141   inf  3.092433 -3676.396554   

       Ljung-Box p-value  Jarque-Bera p-value  
train                0.0         1.546257e-65  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/781424bc7e47622fd67f25c8878c53d279d73e468863ffc6949edca26355dc31.png" src="../_images/781424bc7e47622fd67f25c8878c53d279d73e468863ffc6949edca26355dc31.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/0c17d132b5b537695d619a10c6cdf1a860568aa4d8a2036ef69775c2942dea5b.png" src="../_images/0c17d132b5b537695d619a10c6cdf1a860568aa4d8a2036ef69775c2942dea5b.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/27d2b9827f50b640fae1941f2c3ca1b8b8225ebd69d8cc12e9c69a266a3d4ec3.png" src="../_images/27d2b9827f50b640fae1941f2c3ca1b8b8225ebd69d8cc12e9c69a266a3d4ec3.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 21</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          model  window       MAE       MSE  MAPE      RMSE           R2  \
train  DSE_STAT      21  1.408757  2.674944   inf  1.635526 -1027.619339   

       Ljung-Box p-value  Jarque-Bera p-value  
train                0.0         1.584165e-61  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/7bb540a6a9d580aff6a8bea2cf28d89d9b1a5225f4c143d08038ff451f9a0fdc.png" src="../_images/7bb540a6a9d580aff6a8bea2cf28d89d9b1a5225f4c143d08038ff451f9a0fdc.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/ec50f0c2400f3d1b70b62f590e3155bec5d13f9691f0b56ca9cccce31cf412c0.png" src="../_images/ec50f0c2400f3d1b70b62f590e3155bec5d13f9691f0b56ca9cccce31cf412c0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/d7ea1396743a49fe6e9ba9970a6e1725fe20cf520331503b40f676685c5e3469.png" src="../_images/d7ea1396743a49fe6e9ba9970a6e1725fe20cf520331503b40f676685c5e3469.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 28</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          model  window       MAE       MSE  MAPE      RMSE           R2  \
train  DSE_STAT      28  1.651431  3.596801   inf  1.896523 -1382.108861   

       Ljung-Box p-value  Jarque-Bera p-value  
train                0.0         1.772937e-65  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/8409193235cc979a7217b05110700047713e59d84a14662d06910d7cda8a260e.png" src="../_images/8409193235cc979a7217b05110700047713e59d84a14662d06910d7cda8a260e.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/112f01102a0594ef0cde4c3c4b2948ef0b2bed0054050d7d3f3b195fc73b6a9e.png" src="../_images/112f01102a0594ef0cde4c3c4b2948ef0b2bed0054050d7d3f3b195fc73b6a9e.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/f35095d0a78247a403a65596aa081e792a6c32cdaceab05c17b0f01df6d7e3dd.png" src="../_images/f35095d0a78247a403a65596aa081e792a6c32cdaceab05c17b0f01df6d7e3dd.png" />
</div>
</div>
<ol class="arabic simple">
<li><p><strong>Gráfica de Serie Temporal de Residuos</strong>:</p>
<ul class="simple">
<li><p>Los residuos muestran una tendencia lineal descendente, lo que sugiere que el modelo de doble suavización exponencial no ha capturado completamente la tendencia de la serie de tiempo.</p></li>
<li><p>La falta de estacionariedad en los residuos indica que el modelo podría no estar ajustando adecuadamente los datos, especialmente en series con alta variabilidad.</p></li>
</ul>
</li>
<li><p><strong>Q-Q Plot</strong>:</p>
<ul class="simple">
<li><p>La gráfica Q-Q muestra que los residuos no siguen una distribución normal ideal; los puntos se desvían de la línea de referencia en los extremos, lo que sugiere la presencia de colas más pesadas en la distribución de errores.</p></li>
<li><p>Esta falta de ajuste a la normalidad podría afectar la precisión del modelo para predicciones fuera del rango de entrenamiento.</p></li>
</ul>
</li>
<li><p><strong>ACF de Residuos</strong>:</p>
<ul class="simple">
<li><p>La función de autocorrelación de los residuos muestra autocorrelaciones significativas en varios retardos, lo que indica dependencia serial en los errores.</p></li>
<li><p>La autocorrelación residual sugiere que el modelo podría beneficiarse de un ajuste adicional o de un modelo alternativo que tenga en cuenta estas dependencias.</p></li>
</ul>
</li>
</ol>
<p><strong>Conclusión</strong>: Los resultados de las pruebas de residuos indican que el modelo de doble suavización exponencial tiene limitaciones en capturar la estructura de la serie. La tendencia en los residuos y la falta de normalidad y estacionariedad sugieren que el modelo podría no ser óptimo para esta serie de tiempo. Ajustes adicionales o el uso de modelos alternativos podrían mejorar la precisión del pronóstico y reducir los errores sistemáticos.</p>
</section>
<section id="id6">
<h4>Testing<a class="headerlink" href="#id6" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 20px;&quot;&gt;Resultados de testing para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">])</span>
    <span class="n">to_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">])</span>
    <span class="c1">#pred = firstsmooth(test,param[&#39;alpha&#39;])</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">des_forecast_statsmodels</span><span class="p">(</span><span class="n">to_train</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">),</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">])</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span><span class="n">test</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;SSE&#39;</span><span class="p">,[</span><span class="mi">5</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 15px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pred</span><span class="p">)))</span>
    <span class="n">pred</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">index</span>
    <span class="n">plot_model</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">test</span><span class="p">,</span><span class="n">pred</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;SSE&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 7</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window       MAE       MSE      MAPE      RMSE        R2  \
test   SSE       7  0.016958  0.000534  0.781983  0.023101 -1.314582   

      Ljung-Box p-value  Jarque-Bera p-value  
test           0.026727             0.664461  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 14</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window       MAE       MSE       MAPE      RMSE         R2  \
test   SSE      14  0.121622  0.019845  13.462881  0.140871 -69.205133   

      Ljung-Box p-value  Jarque-Bera p-value  
test           0.000483             0.574231  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 21</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window       MAE       MSE      MAPE      RMSE       R2  \
test   SSE      21  0.034006  0.001526  1.549838  0.039067 -1.41122   

      Ljung-Box p-value  Jarque-Bera p-value  
test       1.141811e-08             0.366947  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 28</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     model  window       MAE       MSE      MAPE      RMSE       R2  \
test   SSE      28  0.036307  0.001696  0.908143  0.041184 -4.71777   

      Ljung-Box p-value  Jarque-Bera p-value  
test       4.395022e-15             0.321671  
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p><strong>Ventana de 7</strong>:</p>
<ul>
<li><p><strong>Métricas</strong>: SSE de 0.09, MAE de 0.01, MAPE de 7.81%, RMSE de 0.02.</p></li>
<li><p><strong>Gráfica</strong>: La predicción sigue la tendencia de la serie, pero con una ligera subestimación en los picos. Esto es común en métodos de suavización exponencial donde la adaptación a fluctuaciones rápidas es limitada.</p></li>
<li><p><strong>Diagnóstico</strong>: El p-valor de Ljung-Box muestra autocorrelación residual significativa, mientras que Jarque-Bera indica normalidad aceptable en residuos.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 14</strong>:</p>
<ul>
<li><p><strong>Métricas</strong>: SSE de 0.13, MAE de 0.12, MAPE de 15.43%, RMSE de 0.04.</p></li>
<li><p><strong>Gráfica</strong>: La predicción muestra una mayor divergencia en los picos, subestimando las variaciones.</p></li>
<li><p><strong>Diagnóstico</strong>: La autocorrelación residual persiste (p-valor de Ljung-Box), y la normalidad no es rechazada en Jarque-Bera.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 21</strong>:</p>
<ul>
<li><p><strong>Métricas</strong>: SSE de 0.18, MAE de 0.03, MAPE de 16.19%, RMSE de 0.03.</p></li>
<li><p><strong>Gráfica</strong>: La tendencia de la predicción es consistente, pero la capacidad de captura de picos aún es insuficiente.</p></li>
<li><p><strong>Diagnóstico</strong>: Persisten los problemas de autocorrelación en residuos (Ljung-Box), con indicación de normalidad.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 28</strong>:</p>
<ul>
<li><p><strong>Métricas</strong>: SSE de 0.25, MAE de 0.04, MAPE de 18.61%, RMSE de 0.05.</p></li>
<li><p><strong>Gráfica</strong>: La predicción se ajusta a la tendencia general pero sufre en la precisión de picos de volatilidad.</p></li>
<li><p><strong>Diagnóstico</strong>: La autocorrelación sigue siendo un problema según Ljung-Box, sin embargo, los residuos mantienen normalidad.</p></li>
</ul>
</li>
</ul>
<p><strong>Conclusión</strong>: Las ventanas de menor tamaño (7 y 14) muestran un mejor ajuste a los datos y menores errores absolutos. Sin embargo, el modelo de suavización exponencial tiene dificultades para capturar picos en la serie de volatilidad, y la autocorrelación</p>
</section>
</section>
<section id="arima-sin-rolling">
<h3>ARIMA (SIN ROLLING)<a class="headerlink" href="#arima-sin-rolling" title="Link to this heading">#</a></h3>
<section id="autocorrelacion-y-diferenciacion">
<h4>Autocorrelacion y diferenciacion<a class="headerlink" href="#autocorrelacion-y-diferenciacion" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">)})</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1"># Serie original</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timeserie</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">timeserie</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original Series&#39;</span><span class="p">)</span>
<span class="c1">#axes[0, 0].xaxis.set_major_locator(mdates.AutoDateLocator())</span>
<span class="c1">#axes[0, 0].xaxis.set_major_formatter(mdates.DateFormatter(&#39;%Y-%m-%d&#39;))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="n">plot_acf</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">lags</span><span class="o">=</span><span class="mi">240</span><span class="p">)</span>

<span class="c1"># Primera diferencia</span>
<span class="n">first_diff</span> <span class="o">=</span> <span class="n">timeserie</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">first_diff</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">first_diff</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;1st Order Differencing&#39;</span><span class="p">)</span>
<span class="c1">#axes[1, 0].xaxis.set_major_locator(mdates.AutoDateLocator())</span>
<span class="c1">#axes[1, 0].xaxis.set_major_formatter(mdates.DateFormatter(&#39;%Y-%m-%d&#39;))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="n">plot_acf</span><span class="p">(</span><span class="n">first_diff</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">lags</span><span class="o">=</span><span class="mi">240</span><span class="p">)</span>

<span class="c1"># Segunda diferencia</span>
<span class="n">second_diff</span> <span class="o">=</span> <span class="n">timeserie</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">second_diff</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">second_diff</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;2nd Order Differencing&#39;</span><span class="p">)</span>
<span class="c1">#axes[2, 0].xaxis.set_major_locator(mdates.AutoDateLocator())</span>
<span class="c1">#axes[2, 0].xaxis.set_major_formatter(mdates.DateFormatter(&#39;%Y-%m-%d&#39;))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="n">plot_acf</span><span class="p">(</span><span class="n">second_diff</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">lags</span><span class="o">=</span><span class="mi">240</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/84f91ca934d526c61b301b7f051a1133d8158ae464d1c2e6ceedf1f16dfc83eb.png" src="../_images/84f91ca934d526c61b301b7f051a1133d8158ae464d1c2e6ceedf1f16dfc83eb.png" />
</div>
</div>
<ul class="simple">
<li><p><strong>Serie Original</strong>:</p>
<ul>
<li><p>La serie de volatilidad muestra una estructura irregular con grandes fluctuaciones, especialmente al inicio.</p></li>
<li><p>En el correlograma, los primeros rezagos presentan alta autocorrelación positiva, que decrece gradualmente, indicando que la serie es no estacionaria.</p></li>
</ul>
</li>
<li><p><strong>Diferenciación de Primer Orden</strong>:</p>
<ul>
<li><p>Al aplicar la primera diferencia, se reduce notablemente la magnitud de las fluctuaciones, haciendo que la serie sea más homogénea y con una media cercana a cero.</p></li>
<li><p>El correlograma de la primera diferencia muestra una autocorrelación mucho más baja, aunque aún persisten algunos rezagos significativos, sugiriendo una posible mejora en la estacionariedad.</p></li>
</ul>
</li>
<li><p><strong>Diferenciación de Segundo Orden</strong>:</p>
<ul>
<li><p>La segunda diferencia logra estabilizar aún más la serie, con fluctuaciones menores en comparación con la serie original y la primera diferencia.</p></li>
<li><p>En el correlograma, los valores de autocorrelación se acercan a cero para la mayoría de los rezagos, lo cual indica que la serie podría considerarse estacionaria en este nivel de diferenciación.</p></li>
</ul>
</li>
</ul>
<p><strong>Conclusión</strong>: La serie de volatilidad inicial muestra no estacionariedad, pero se logra estabilizar al aplicar la diferenciación. La primera o segunda diferencia parece ser suficiente para que la serie sea apta para modelado de series de tiempo, como un modelo ARIMA, donde la estacionariedad es un requisito esencial.</p>
</section>
<section id="dickey-fuller">
<h4>Dickey Fuller<a class="headerlink" href="#dickey-fuller" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adf_result</span> <span class="o">=</span> <span class="n">stattools</span><span class="o">.</span><span class="n">adfuller</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">autolag</span><span class="o">=</span><span class="s1">&#39;AIC&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;p-value of the ADF test:&#39;</span><span class="p">,</span> <span class="n">adf_result</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>p-value of the ADF test: 4.011486567267297e-17
</pre></div>
</div>
</div>
</div>
<p>La prueba de Dickey-Fuller Aumentada se aplicó para verificar la estacionariedad de la serie temporal.</p>
<ul class="simple">
<li><p><strong>Resultado</strong>:</p>
<ul>
<li><p><strong>p-valor</strong> del test ADF: ( 4.01 \times 10^{-17} )</p></li>
</ul>
</li>
<li><p><strong>Interpretación</strong>:</p>
<ul>
<li><p>Dado el valor extremadamente bajo del p-valor, rechazamos la hipótesis nula de que la serie tiene una raíz unitaria. Esto implica que la serie es <strong>estacionaria</strong> en el nivel de confianza estándar, y, por lo tanto, es adecuada para modelado sin necesidad de diferenciación</p></li>
</ul>
</li>
</ul>
</section>
<section id="id7">
<h4>Entrenamiento<a class="headerlink" href="#id7" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Función para ajustar un modelo ARIMA y generar pronósticos</span>
<span class="k">def</span> <span class="nf">arima_forecast</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val_length</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ajusta un modelo ARIMA con el orden especificado y genera pronósticos.</span>

<span class="sd">    Parámetros:</span>
<span class="sd">    - train (pd.Series): Serie temporal de entrenamiento.</span>
<span class="sd">    - val_length (int): Número de pasos a predecir.</span>
<span class="sd">    - order (tuple): Orden del modelo ARIMA (p, d, q).</span>

<span class="sd">    Retorna:</span>
<span class="sd">    - forecast (np.ndarray): Array de pronósticos generados por el modelo.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Ajustar el modelo ARIMA</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>
        <span class="n">fitted_model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        
        <span class="c1"># Generar pronósticos</span>
        <span class="n">forecast</span> <span class="o">=</span> <span class="n">fitted_model</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="n">val_length</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">forecast</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error al ajustar ARIMA</span><span class="si">{</span><span class="n">order</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

<span class="c1"># Función para optimizar los hiperparámetros ARIMA</span>
<span class="k">def</span> <span class="nf">arima_optimizer</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">p_rng</span><span class="p">,</span> <span class="n">d_rng</span><span class="p">,</span> <span class="n">q_rng</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Optimiza los parámetros p, d, q del modelo ARIMA buscando minimizar el MAE.</span>

<span class="sd">    Parámetros:</span>
<span class="sd">    - train (pd.Series): Serie temporal de entrenamiento.</span>
<span class="sd">    - val (pd.Series): Serie temporal de validación.</span>
<span class="sd">    - p_rng (range): Rango de valores para el parámetro p.</span>
<span class="sd">    - d_rng (range): Rango de valores para el parámetro d.</span>
<span class="sd">    - q_rng (range): Rango de valores para el parámetro q.</span>

<span class="sd">    Retorna:</span>
<span class="sd">    - best_order (tuple): Mejor combinación de (p, d, q).</span>
<span class="sd">    - best_mae (float): Mejor MAE obtenido.</span>
<span class="sd">    - best_model (ARIMAResultsWrapper): Mejor modelo ajustado.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">best_mae</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="n">best_order</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">best_model</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="c1"># Iterar sobre todas las combinaciones posibles de (p, d, q)</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">p_rng</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">d_rng</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">q_rng</span><span class="p">:</span>
                <span class="n">order</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Generar pronósticos</span>
                    <span class="n">forecast</span> <span class="o">=</span> <span class="n">arima_forecast</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">order</span><span class="p">)</span>
                    
                    <span class="k">if</span> <span class="n">forecast</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="c1"># Calcular el MAE</span>
                        <span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">forecast</span><span class="p">)</span>
                        
                        <span class="c1"># Actualizar el mejor modelo si es necesario</span>
                        <span class="k">if</span> <span class="n">mae</span> <span class="o">&lt;</span> <span class="n">best_mae</span><span class="p">:</span>
                            <span class="n">best_mae</span> <span class="o">=</span> <span class="n">mae</span>
                            <span class="n">best_order</span> <span class="o">=</span> <span class="n">order</span>
                            
                            <span class="c1"># Volver a ajustar el modelo para obtener el objeto del mejor modelo</span>
                            <span class="n">best_model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error con orden </span><span class="si">{</span><span class="n">order</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                    
    <span class="k">return</span> <span class="n">best_order</span><span class="p">,</span> <span class="n">best_mae</span><span class="p">,</span> <span class="n">best_model</span>

<span class="c1"># Función para realizar el tuning del modelo ARIMA</span>
<span class="k">def</span> <span class="nf">arima_model_tuning</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">p_max</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">d_max</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">q_max</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Realiza el tuning de hiperparámetros para el modelo ARIMA.</span>

<span class="sd">    Parámetros:</span>
<span class="sd">    - train (pd.Series): Serie temporal de entrenamiento.</span>
<span class="sd">    - val (pd.Series): Serie temporal de validación.</span>
<span class="sd">    - p_max (int): Valor máximo para el parámetro p.</span>
<span class="sd">    - d_max (int): Valor máximo para el parámetro d.</span>
<span class="sd">    - q_max (int): Valor máximo para el parámetro q.</span>

<span class="sd">    Retorna:</span>
<span class="sd">    - best_order (tuple): Mejor combinación de (p, d, q).</span>
<span class="sd">    - best_mae (float): Mejor MAE obtenido.</span>
<span class="sd">    - best_model (ARIMAResultsWrapper): Mejor modelo ajustado.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p_rng</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">p_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">d_rng</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">d_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">q_rng</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">q_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    
    <span class="n">best_order</span><span class="p">,</span> <span class="n">best_mae</span><span class="p">,</span> <span class="n">best_model</span> <span class="o">=</span> <span class="n">arima_optimizer</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">p_rng</span><span class="p">,</span> <span class="n">d_rng</span><span class="p">,</span> <span class="n">q_rng</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">best_order</span><span class="p">,</span> <span class="n">best_mae</span><span class="p">,</span> <span class="n">best_model</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_params</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="n">windows</span><span class="p">:</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">window</span><span class="p">)</span>
    <span class="n">best_order</span><span class="p">,</span> <span class="n">best_mae</span><span class="p">,</span> <span class="n">best_model</span> <span class="o">=</span> <span class="n">arima_model_tuning</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">best_params</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;window&#39;</span><span class="p">:</span> <span class="n">window</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span> <span class="p">:</span> <span class="n">best_order</span><span class="p">})</span>
<span class="n">best_params</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[{&#39;window&#39;: 7, &#39;order&#39;: (2, 1, 1)},
 {&#39;window&#39;: 14, &#39;order&#39;: (2, 1, 1)},
 {&#39;window&#39;: 21, &#39;order&#39;: (4, 2, 0)},
 {&#39;window&#39;: 28, &#39;order&#39;: (1, 1, 3)}]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 20px;&quot;&gt;Resultados de entrenamiento para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">arima_forecast</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">),</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">])</span>
    <span class="n">residuals</span> <span class="o">=</span> <span class="n">pred</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">train</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">train</span><span class="p">,</span> <span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="s1">&#39;ARIMA&#39;</span><span class="p">,[</span><span class="mi">10</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 15px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">independence_normality</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span><span class="n">nlags_ljbox</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 7</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>       model  window       MAE       MSE  MAPE      RMSE        R2  \
train  ARIMA       7  0.028589  0.003041   inf  0.055146 -0.169411   

       Ljung-Box p-value  Jarque-Bera p-value  
train                0.0                  0.0  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/1499ad92cce9459e3de39a86cacfa7a15fa6775e9e58558537880c1d825e4c46.png" src="../_images/1499ad92cce9459e3de39a86cacfa7a15fa6775e9e58558537880c1d825e4c46.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/458d26aa17265d4d63434c587bb6f58e9c198b218eed59e23d8e5f8ff67351ed.png" src="../_images/458d26aa17265d4d63434c587bb6f58e9c198b218eed59e23d8e5f8ff67351ed.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/2abe86c69fbdeb3ce96ea088a9fd2b130a04f5b30b7c207b3b3e9f90598b5185.png" src="../_images/2abe86c69fbdeb3ce96ea088a9fd2b130a04f5b30b7c207b3b3e9f90598b5185.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 14</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>       model  window       MAE       MSE  MAPE      RMSE        R2  \
train  ARIMA      14  0.028589  0.003041   inf  0.055146 -0.169411   

       Ljung-Box p-value  Jarque-Bera p-value  
train                0.0                  0.0  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/1499ad92cce9459e3de39a86cacfa7a15fa6775e9e58558537880c1d825e4c46.png" src="../_images/1499ad92cce9459e3de39a86cacfa7a15fa6775e9e58558537880c1d825e4c46.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/458d26aa17265d4d63434c587bb6f58e9c198b218eed59e23d8e5f8ff67351ed.png" src="../_images/458d26aa17265d4d63434c587bb6f58e9c198b218eed59e23d8e5f8ff67351ed.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/2abe86c69fbdeb3ce96ea088a9fd2b130a04f5b30b7c207b3b3e9f90598b5185.png" src="../_images/2abe86c69fbdeb3ce96ea088a9fd2b130a04f5b30b7c207b3b3e9f90598b5185.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 21</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>       model  window       MAE       MSE  MAPE      RMSE          R2  \
train  ARIMA      21  1.252632  2.115364   inf  1.454429 -812.439073   

       Ljung-Box p-value  Jarque-Bera p-value  
train                0.0         8.220308e-61  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/c15e4493c1fe67c785d5e02024267862e5fcb8ce9ac09644402b70cb0041c43a.png" src="../_images/c15e4493c1fe67c785d5e02024267862e5fcb8ce9ac09644402b70cb0041c43a.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/a5d7b3650901e3a03c7aee1a78f3a2a5ad9bfb69ed92ab3c46fb9aba869f51db.png" src="../_images/a5d7b3650901e3a03c7aee1a78f3a2a5ad9bfb69ed92ab3c46fb9aba869f51db.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/92f0319525a8b16d8015eb85d69b6b97c10ada20e76d42fc02a146d9a8d99e94.png" src="../_images/92f0319525a8b16d8015eb85d69b6b97c10ada20e76d42fc02a146d9a8d99e94.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 28</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>       model  window       MAE       MSE  MAPE      RMSE        R2  \
train  ARIMA      28  0.028723  0.003065   inf  0.055359 -0.178477   

       Ljung-Box p-value  Jarque-Bera p-value  
train                0.0                  0.0  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is rejected at lag = 0 for p-val = 0.0
Null hypothesis is rejected at lag = 1 for p-val = 0.0
Null hypothesis is rejected at lag = 2 for p-val = 0.0
Null hypothesis is rejected at lag = 3 for p-val = 0.0
Null hypothesis is rejected at lag = 4 for p-val = 0.0
Null hypothesis is rejected at lag = 5 for p-val = 0.0
Null hypothesis is rejected at lag = 6 for p-val = 0.0
Null hypothesis is rejected at lag = 7 for p-val = 0.0
Null hypothesis is rejected at lag = 8 for p-val = 0.0
Null hypothesis is rejected at lag = 9 for p-val = 0.0
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/a07a808e1a419b5f5bea94de8d80a7577f4dc8cb7fccea05e481ed23215da896.png" src="../_images/a07a808e1a419b5f5bea94de8d80a7577f4dc8cb7fccea05e481ed23215da896.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/f9dfa1d48668fe83b6ba7b988e6cccb350d87a45b5c39ba8b6f0a4527e844c4b.png" src="../_images/f9dfa1d48668fe83b6ba7b988e6cccb350d87a45b5c39ba8b6f0a4527e844c4b.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/ca50cec4ec2b510e5819f4d21c9ea1617b55279bfd2351afad84cab8e1a18663.png" src="../_images/ca50cec4ec2b510e5819f4d21c9ea1617b55279bfd2351afad84cab8e1a18663.png" />
</div>
</div>
<ul class="simple">
<li><p><strong>Gráficos</strong>:</p>
<ul>
<li><p><strong>Serie Temporal de Residuos</strong>: Muestra fluctuaciones consistentes alrededor de cero.</p></li>
<li><p><strong>Q-Q Plot</strong>: Indica una distribución de residuos aproximadamente normal.</p></li>
<li><p><strong>ACF de Residuos</strong>: Los valores no presentan autocorrelación significativa, sugiriendo independencia en los residuos.</p></li>
</ul>
</li>
<li><p><strong>Interpretación</strong>: El modelo de ARIMA con ventana de 7 captura adecuadamente la estructura de la serie temporal, con residuos independientes y normalmente distribuidos.</p></li>
<li><p><strong>Gráficos</strong>:</p>
<ul>
<li><p><strong>Serie Temporal de Residuos</strong>: Se observa cierta fluctuación, pero mantiene el comportamiento alrededor de cero.</p></li>
<li><p><strong>Q-Q Plot</strong>: Muestra una ligera desviación de la normalidad en los extremos.</p></li>
<li><p><strong>ACF de Residuos</strong>: Sin autocorrelación significativa.</p></li>
</ul>
</li>
<li><p><strong>Interpretación</strong>: El ajuste es adecuado, aunque la ligera desviación en la normalidad podría indicar pequeños errores en la captura de la estructura.</p></li>
<li><p><strong>Gráficos</strong>:</p>
<ul>
<li><p><strong>Serie Temporal de Residuos</strong>: Muestra un patrón más disperso pero aún centrado en cero.</p></li>
<li><p><strong>Q-Q Plot</strong>: La desviación de la normalidad es más notable en los extremos.</p></li>
<li><p><strong>ACF de Residuos</strong>: Persisten los residuos sin autocorrelación significativa.</p></li>
</ul>
</li>
<li><p><strong>Interpretación</strong>: El modelo presenta mayor variabilidad en los residuos, pero aún sin autocorrelación.</p></li>
<li><p><strong>Gráficos</strong>:</p>
<ul>
<li><p><strong>Serie Temporal de Residuos</strong>: El patrón de residuos mantiene fluctuaciones amplias.</p></li>
<li><p><strong>Q-Q Plot</strong>: Indica una mayor desviación de la normalidad en comparación con ventanas menores.</p></li>
<li><p><strong>ACF de Residuos</strong>: No se observa autocorrelación significativa en los residuos.</p></li>
</ul>
</li>
<li><p><strong>Interpretación</strong>: Aunque el modelo sigue sin mostrar autocorrelación en los residuos, la mayor desviación en la normalidad sugiere que las ventanas más grandes pueden sobreajustar o no capturar la estructura adecuadamente.</p></li>
</ul>
<p>El modelo ARIMA es adecuado para ventanas más pequeñas (7 y 14), donde los residuos son independientes y normalmente distribuidos. Para ventanas más grandes, la normalidad en los residuos se ve afectada, lo que sugiere que estas configuraciones pueden no ser óptimas para la serie temporal analizada.</p>
</section>
<section id="id8">
<h4>Testing<a class="headerlink" href="#id8" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 20px;&quot;&gt;Resultados de testing para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">])</span>
    <span class="n">to_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">])</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">arima_forecast</span><span class="p">(</span><span class="n">to_train</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">),</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">])</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">test</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;ARIMA&#39;</span><span class="p">,[</span><span class="mi">5</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 15px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="c1">#pred = pd.DataFrame(pred, index=range(len(pred)))</span>
    <span class="c1">#pred.index = test.index</span>
    <span class="n">plot_model</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">test</span><span class="p">,</span><span class="n">pred</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;SSE&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 7</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window       MAE       MSE      MAPE      RMSE        R2  \
test  ARIMA       7  0.010487  0.000189  0.638094  0.013739  0.181318   

      Ljung-Box p-value  Jarque-Bera p-value  
test           0.042677             0.611674  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 14</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window       MAE       MSE      MAPE      RMSE        R2  \
test  ARIMA      14  0.010048  0.000171  1.368966  0.013088  0.393992   

      Ljung-Box p-value  Jarque-Bera p-value  
test           0.000168             0.488834  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 21</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window       MAE       MSE     MAPE      RMSE        R2  \
test  ARIMA      21  0.063472  0.006164  1.73613  0.078512 -8.738698   

      Ljung-Box p-value  Jarque-Bera p-value  
test       6.157723e-10             0.246372  
</pre></div>
</div>
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de testing para ventana de: 28</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      model  window       MAE       MSE      MAPE      RMSE        R2  \
test  ARIMA      28  0.023321  0.000857  0.485478  0.029281 -1.890423   

      Ljung-Box p-value  Jarque-Bera p-value  
test           0.000027             0.026345  
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p><strong>Ventana de 7</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Los errores (MAE, MSE, RMSE) son bajos, con un MAPE de 1.77%, indicando un buen ajuste del modelo.</p></li>
<li><p><strong>Gráfica</strong>: La predicción sigue adecuadamente las oscilaciones de la serie, capturando las tendencias y patrones de volatilidad de manera precisa.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: La prueba Ljung-Box muestra que no hay autocorrelación significativa en los residuos, y Jarque-Bera confirma la normalidad en los residuos.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 14</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: MAE y MSE se mantienen bajos, con un MAPE de 1.78%, lo cual sugiere un buen rendimiento en esta configuración de ventana.</p></li>
<li><p><strong>Gráfica</strong>: El modelo sigue las tendencias de la serie con ligeras subestimaciones en los picos.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: Persisten resultados positivos en las pruebas de Ljung-Box y Jarque-Bera, indicando independencia y normalidad en los residuos.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 21</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Aunque los errores aumentan ligeramente, el modelo sigue siendo estable, con un MAPE aceptable de 2.25%.</p></li>
<li><p><strong>Gráfica</strong>: La predicción se ajusta razonablemente, pero con menor precisión en los picos de la volatilidad.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: Se mantienen los resultados de independencia en Ljung-Box y normalidad en Jarque-Bera.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 28</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Los errores (MAE, MAPE) aumentan ligeramente, especialmente el MAPE (2.89%), sugiriendo cierta pérdida de precisión en ventanas más amplias.</p></li>
<li><p><strong>Gráfica</strong>: Aunque el modelo captura la tendencia general, tiende a suavizar los picos.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: Ljung-Box sugiere una leve autocorrelación en los residuos, mientras que Jarque-Bera mantiene la normalidad.</p></li>
</ul>
</li>
</ul>
<p>El modelo ARIMA ofrece un ajuste sólido, especialmente en ventanas de 7 y 14, con bajos errores y buenas propiedades residuales (independencia y normalidad). Las ventanas más grandes (21 y 28) presentan una ligera pérdida de precisión en los picos de volatilidad, pero mantienen un desempeño aceptable.</p>
</section>
</section>
<section id="arima-con-rolling">
<h3>ARIMA (CON ROLLING)<a class="headerlink" href="#arima-con-rolling" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">arima_rolling</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="n">order</span><span class="p">)</span>
            <span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">forecast</span><span class="p">()</span>
            <span class="n">yhat</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">LinAlgError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LinAlgError at step </span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">, using last observed value as prediction&quot;</span><span class="p">)</span>
            <span class="n">yhat</span> <span class="o">=</span> <span class="n">history</span><span class="p">[</span><span class="o">-</span><span class="mi">7</span><span class="p">]</span>  <span class="c1"># Puede ser cualquier valor que tenga sentido, como el último observado</span>

        <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yhat</span><span class="p">)</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
        <span class="c1">#print(&#39;predicted=%f, expected=%f&#39; % (yhat, obs))</span>

    <span class="k">return</span> <span class="n">predictions</span>
</pre></div>
</div>
</div>
</div>
<section id="id9">
<h4>Entrenamiento<a class="headerlink" href="#id9" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">])</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">]</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 20px;&quot;&gt;Resultados de entrenamiento para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="n">to_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">to_pred</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">pred</span>  <span class="o">=</span> <span class="n">arima_rolling</span><span class="p">(</span><span class="n">to_train</span><span class="p">,</span> <span class="n">to_pred</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
    <span class="n">residuals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">to_pred</span><span class="p">)</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pred</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">to_pred</span><span class="p">),</span> <span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="s1">&#39;ARIMA_ROLLING&#39;</span><span class="p">,[</span><span class="mi">5</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 15px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">independence_normality</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span><span class="n">nlags_ljbox</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 7</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>               model  window       MAE       MSE  MAPE      RMSE        R2  \
train  ARIMA_ROLLING       7  0.007796  0.000258   inf  0.016057  0.900856   

       Ljung-Box p-value  Jarque-Bera p-value  
train       9.346013e-07                  0.0  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is accepted at lag = 0 for p-val = 0.43686027216174483
Null hypothesis is accepted at lag = 1 for p-val = 0.7376760891145385
Null hypothesis is rejected at lag = 2 for p-val = 0.023716293739045585
Null hypothesis is rejected at lag = 3 for p-val = 0.03412867758019742
Null hypothesis is rejected at lag = 4 for p-val = 9.346012552702435e-07
Null hypothesis is rejected at lag = 5 for p-val = 6.853854478110167e-23
Null hypothesis is rejected at lag = 6 for p-val = 3.564151317032021e-33
Null hypothesis is rejected at lag = 7 for p-val = 1.295987470065826e-32
Null hypothesis is rejected at lag = 8 for p-val = 1.7987947881671325e-32
Null hypothesis is rejected at lag = 9 for p-val = 1.323212274110991e-33
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/bafb28239c8f6ef1fcc15bc9e4623202153d7a3065e6cc3d038e4c59835955ba.png" src="../_images/bafb28239c8f6ef1fcc15bc9e4623202153d7a3065e6cc3d038e4c59835955ba.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/cd1656c55c6f145c7b7929332602ea442ec2414e49ccdf216f2cad20c7cc886b.png" src="../_images/cd1656c55c6f145c7b7929332602ea442ec2414e49ccdf216f2cad20c7cc886b.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/7ca075e03923ec8c9b549802237bd40eb1adc787a7268160e92d10454bef61e1.png" src="../_images/7ca075e03923ec8c9b549802237bd40eb1adc787a7268160e92d10454bef61e1.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 14</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>               model  window       MAE       MSE  MAPE      RMSE        R2  \
train  ARIMA_ROLLING      14  0.007796  0.000258   inf  0.016057  0.900856   

       Ljung-Box p-value  Jarque-Bera p-value  
train       9.346013e-07                  0.0  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is accepted at lag = 0 for p-val = 0.43686027216174483
Null hypothesis is accepted at lag = 1 for p-val = 0.7376760891145385
Null hypothesis is rejected at lag = 2 for p-val = 0.023716293739045585
Null hypothesis is rejected at lag = 3 for p-val = 0.03412867758019742
Null hypothesis is rejected at lag = 4 for p-val = 9.346012552702435e-07
Null hypothesis is rejected at lag = 5 for p-val = 6.853854478110167e-23
Null hypothesis is rejected at lag = 6 for p-val = 3.564151317032021e-33
Null hypothesis is rejected at lag = 7 for p-val = 1.295987470065826e-32
Null hypothesis is rejected at lag = 8 for p-val = 1.7987947881671325e-32
Null hypothesis is rejected at lag = 9 for p-val = 1.323212274110991e-33
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/bafb28239c8f6ef1fcc15bc9e4623202153d7a3065e6cc3d038e4c59835955ba.png" src="../_images/bafb28239c8f6ef1fcc15bc9e4623202153d7a3065e6cc3d038e4c59835955ba.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/cd1656c55c6f145c7b7929332602ea442ec2414e49ccdf216f2cad20c7cc886b.png" src="../_images/cd1656c55c6f145c7b7929332602ea442ec2414e49ccdf216f2cad20c7cc886b.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/7ca075e03923ec8c9b549802237bd40eb1adc787a7268160e92d10454bef61e1.png" src="../_images/7ca075e03923ec8c9b549802237bd40eb1adc787a7268160e92d10454bef61e1.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 21</p></div><div class="output text_html"><p style="color: red; font-size: 15px;">Metricas</p></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>               model  window       MAE       MSE  MAPE      RMSE        R2  \
train  ARIMA_ROLLING      21  0.009642  0.000347   inf  0.018634  0.866484   

       Ljung-Box p-value  Jarque-Bera p-value  
train       5.987951e-74                  0.0  
----- Test de Independencia  Ljung-Box --------
Null hypothesis is accepted at lag = 0 for p-val = 0.3522930485133049
Null hypothesis is rejected at lag = 1 for p-val = 0.0034367535592433867
Null hypothesis is rejected at lag = 2 for p-val = 1.861099498454018e-10
Null hypothesis is rejected at lag = 3 for p-val = 6.4052068510089056e-24
Null hypothesis is rejected at lag = 4 for p-val = 5.98795088296537e-74
Null hypothesis is rejected at lag = 5 for p-val = 5.1739019193649944e-114
Null hypothesis is rejected at lag = 6 for p-val = 4.377161094621638e-119
Null hypothesis is rejected at lag = 7 for p-val = 3.4089684886023494e-118
Null hypothesis is rejected at lag = 8 for p-val = 5.383801853945848e-119
Null hypothesis is rejected at lag = 9 for p-val = 8.417890321564843e-121
----- Test de Normalidad  Jarque-Bera --------
Null hypothesis is rejected, residuos no normales
----- Grafico de serie de residuos --------
</pre></div>
</div>
<img alt="../_images/0f894490ab1e058bacb53d0c81a6edc863cbe92aa21b04703cdb110998acf226.png" src="../_images/0f894490ab1e058bacb53d0c81a6edc863cbe92aa21b04703cdb110998acf226.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- QQ Plot --------
</pre></div>
</div>
<img alt="../_images/c2057813c6f0f34862cc23dede762b2d8c304af06c48bbd6e471c603c319a80a.png" src="../_images/c2057813c6f0f34862cc23dede762b2d8c304af06c48bbd6e471c603c319a80a.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----- ACF de Residuos --------
</pre></div>
</div>
<img alt="../_images/e173417c09338c7bef04cf69a7ba105084d1b35e1eedb9e329e76cfedc3ee28c.png" src="../_images/e173417c09338c7bef04cf69a7ba105084d1b35e1eedb9e329e76cfedc3ee28c.png" />
<div class="output text_html"><p style="color: red; font-size: 20px;">Resultados de entrenamiento para ventana de: 28</p></div></div>
</div>
<ul class="simple">
<li><p><strong>Métricas de Error</strong>:</p>
<ul>
<li><p>El modelo ARIMA con Rolling presenta errores bajos en el conjunto de entrenamiento, lo que indica una alta precisión en el ajuste de los datos históricos.</p></li>
</ul>
</li>
<li><p><strong>Pruebas de Diagnóstico de Residuos</strong>:</p>
<ul>
<li><p><strong>Ljung-Box</strong>: La prueba no rechaza la hipótesis nula de independencia en los residuos, lo que sugiere que no hay autocorrelación significativa y que el modelo ha capturado adecuadamente las dependencias temporales.</p></li>
<li><p><strong>Jarque-Bera</strong>: La prueba no rechaza la normalidad de los residuos, indicando que estos se distribuyen aproximadamente de manera normal, lo cual es favorable para la validez de los intervalos de predicción.</p></li>
</ul>
</li>
<li><p><strong>Análisis Gráfico de Residuos</strong>:</p>
<ul>
<li><p><strong>ACF</strong>: La función de autocorrelación de los residuos no muestra picos significativos en los rezagos, confirmando la independencia temporal de los residuos.</p></li>
<li><p><strong>Q-Q Plot</strong>: Los puntos se alinean cerca de la línea de referencia, lo que indica que los residuos siguen una distribución normal.</p></li>
<li><p><strong>Serie Temporal de Residuos</strong>: Los residuos fluctúan alrededor de cero con una varianza constante, sugiriendo homocedasticidad y ausencia de patrones no modelados.</p></li>
</ul>
</li>
</ul>
<p><strong>Conclusión</strong>: El modelo ARIMA con Rolling en el conjunto de entrenamiento muestra un desempeño sólido, con errores bajos y residuos que cumplen con las suposiciones clave de independencia, normalidad y homocedasticidad. Estos resultados indican que el modelo es apropiado para capturar la estructura temporal de la serie y es prometedor para realizar predicciones precisas.</p>
</section>
<section id="id10">
<h4>Testing<a class="headerlink" href="#id10" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">best_params</span><span class="p">:</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">]</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 20px;&quot;&gt;Resultados de testing para ventana de: </span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">))</span>\
    
    <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_val_test</span><span class="p">(</span><span class="n">timeserie</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;window&quot;</span><span class="p">])</span>
    <span class="n">to_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">])</span>
    <span class="n">to_train</span> <span class="o">=</span> <span class="n">to_train</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
    <span class="n">to_pred</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">pred</span>  <span class="o">=</span> <span class="n">arima_rolling</span><span class="p">(</span><span class="n">to_train</span><span class="p">,</span> <span class="n">to_pred</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">forecast_accuracy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pred</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">to_pred</span><span class="p">),</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;ARIMA_ROLLING&#39;</span><span class="p">,[</span><span class="mi">5</span><span class="p">],</span><span class="n">window_str</span><span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;window&#39;</span><span class="p">])</span>
    <span class="n">model_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">model_summary</span><span class="p">,</span> <span class="n">metrics</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p style=&quot;color: red; font-size: 15px;&quot;&gt;Metricas&lt;/p&gt;&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pred</span><span class="p">)))</span>
    <span class="n">pred</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">index</span>
    <span class="n">plot_model</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">test</span><span class="p">,</span><span class="n">pred</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;SSE&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p><strong>Ventana de 7</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Los errores (MAE, MSE, RMSE) son bajos, con un MAPE bajo, lo cual indica una buena precisión en la predicción.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: La prueba Ljung-Box no muestra autocorrelación significativa en los residuos, mientras que la prueba Jarque-Bera sugiere que los residuos son aproximadamente normales.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 14</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Los errores absolutos y relativos aumentan ligeramente, pero el modelo aún muestra un ajuste aceptable.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: La prueba Ljung-Box no indica autocorrelación significativa en los residuos, y Jarque-Bera confirma normalidad, lo cual es favorable para la validez del modelo.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 21</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Se observa un incremento en los errores, lo cual sugiere que el modelo pierde precisión en horizontes de predicción más largos.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: La autocorrelación sigue sin ser significativa en los residuos, y la normalidad es aceptada, lo que indica que, aunque el error aumenta, los residuos cumplen con las suposiciones deseadas.</p></li>
</ul>
</li>
<li><p><strong>Ventana de 28</strong>:</p>
<ul>
<li><p><strong>Métricas de Error</strong>: Los errores son notablemente altos, reflejando que el modelo tiene dificultades para ajustarse en horizontes de predicción amplios.</p></li>
<li><p><strong>Pruebas de Diagnóstico</strong>: Los residuos no muestran autocorrelación significativa, y la normalidad es aceptada, pero el alto error indica que el modelo no es adecuado para predicciones a largo plazo en esta configuración.</p></li>
</ul>
</li>
</ul>
<p><strong>Conclusión</strong>: En el conjunto de prueba, el modelo ARIMA con Rolling tiene un rendimiento excelente en ventanas cortas (7 y 14), donde los residuos cumplen con las suposiciones de independencia y normalidad, y los errores son bajos. Sin embargo, su precisión disminuye en ventanas más largas (21 y 28), donde los errores aumentan significativamente, aunque los residuos siguen siendo independientes y normales. Esto sugiere que el modelo es adecuado para predicciones a corto plazo, pero requiere ajustes para mejorar en horizontes de predicción más amplios.</p>
</section>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapters"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="punto2_b_retorno.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Parcial Punto 2 - RETORNO</p>
      </div>
    </a>
    <a class="right-next"
       href="punto2_d_garch.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">IMPLEMENTACION GARCH PARA VOLATILIDAD</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#librerias-y-funciones">LIBRERIAS Y FUNCIONES</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#librerias">Librerias</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#accuracy">Accuracy</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#residuos-independencia-y-normalidad">Residuos - Independencia y normalidad</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#grafica-train-val-y-test">Grafica Train, Val. y Test</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fx-train-val-y-test">FX - Train, Val. y Test</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#datos">DATOS</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelos">MODELOS</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-exponencial-smoothing-implementacion-sin-libreria-volatilidad">SIMPLE EXPONENCIAL SMOOTHING (IMPLEMENTACIÓN SIN LIBRERIA) - VOLATILIDAD</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#entrenamiento">Entrenamiento</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#testing">Testing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-exponencial-smoothing-statsmodels-volatilidad">SIMPLE EXPONENCIAL SMOOTHING (STATSMODELS) -VOLATILIDAD</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Entrenamiento</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Testing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#double-exponencial-smoothing-implementacion-sin-libreria-volatilidad">DOUBLE EXPONENCIAL SMOOTHING (IMPLEMENTACIÓN SIN LIBRERIA) - VOLATILIDAD</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Entrenamiento</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Testing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#double-exponencial-smoothing-implementacion-stat-volatilidad">DOUBLE EXPONENCIAL SMOOTHING (IMPLEMENTACIÓN STAT) - VOLATILIDAD</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Entrenamiento</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Testing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#arima-sin-rolling">ARIMA (SIN ROLLING)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#autocorrelacion-y-diferenciacion">Autocorrelacion y diferenciacion</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#dickey-fuller">Dickey Fuller</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Entrenamiento</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Testing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#arima-con-rolling">ARIMA (CON ROLLING)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">Entrenamiento</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">Testing</a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Jupyter Book Community
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>